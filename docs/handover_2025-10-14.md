# 정화의 서재 — 인수인계서 (2025-10-14 전역 UI 정교화)

## 0) 목적
- 내일 카드/버튼(CTA/필터/태그/배지/서비스 링크 포함) 전역 디자인을 상용화 수준으로 정교화.
- 가독성·간격·정렬·명도 대비·포커스 가시성 강화, 상태 애니메이션 톤 다운(무광/동화 톤), 모바일 폴드(390) 조작성 개선.
- CSS 우선, 색/문구/구조 유지, 서버 재시작 금지.

## 1) 오늘 반영 요약(전역 토큰/톤 조정)
- 전역 토큰 추가: `--btn-padding-y`, `--btn-padding-x`, `--icon-gap-left`, `--icon-gap-right`(아이콘 간격/패딩 통일 기반).
- 카테고리 컨트롤(`.btn-filter/.btn-teen-tab/.btn-age/.chip/.badge/.service-link`): line-height 1.15, padding 통일, nowrap + max-height: 56px, 상태 섀도우 10–20% 감쇠.
- 카드 계열: 호버 이동/섀도우 톤 다운(무광), 3D 각도 완화.
- 글로벌 버튼 정렬: `.btn/.btn-hero/.btn-modern/.service-link` → inline-flex + baseline 정렬, 아이콘 간격 좌 8px/우 6px.
- SassC 불호환 CSS `max()` 제거(연속 선언으로 토큰 우선 적용).
 - 버튼 룩앤필 전환: 검정 기본 제거 → 브랜드 프라이머리 `#5B64E3` 통일, outline 대비 완화(`rgba(91,100,227,0.35)`), hover/active 변화 ≤15%, 무광 톤. 대상: `minimal_buttons.scss`, `modern_design.scss`, `premium_design_system.scss`.

### 추가 반영(10/13 오후)
- 탭 아이콘 보강: `.length-tab/.level-tab`에 `::before` + 버튼 배경 아이콘 fallback(UA가 의사요소 무시해도 표시).
- 썸네일 16:9 통일: 전역 썸네일 컨테이너(`.content-thumbnail/.collection-thumb/...`)와 상세 헤더(`.book-cover/.book-cover.lg`)를 3:4/고정높이 → `aspect-ratio: 16/9`로 변경. 잘림 현상 제거.
- 상세 썸네일 로딩 경로 정리: `courses/show.html.erb`에서 자산 파이프라인 경로만 사용하도록 통일, 비디오 `poster`도 동일 경로 사용.
- 상세 미디어 시연: 전자동화책(🦁 사자왕), 구연동화(🎭 백설공주) 데모 영상 연결(실제 파일 투입 시 즉시 교체 가능).
- 푸터 사업자 정보 삽입(법정 고지): 대표/사업자등록번호/통신판매업/주소.

## 2) 남은 문제(내일 1순위)
- 버튼 시각 언어가 검정 단색/강한 아웃라인 성격 → Win97 느낌(현행 `minimal_buttons.scss`의 black 기본, outline 대비 과다, 일부 gradient 혼재).
- 칩/배지 박스감(보더 대비 과다, 내부 여백 미세 차) 및 군집 밀도.
- 상태 변화(hover/active) 감쇠 폭/속도 불균질.
- 카드 헤더/바디/푸터 수직 리듬(8/16/24) 편차.
- 모바일(390)에서 필터군 터치 타깃 간격/군집 밀도.

## 3) 내일 작업 목표 & AC(수용 기준)
- 버튼(전역)
  - AC-1: min-height ≥48px, padding Y 12–14px, 아이콘 간격 좌8/우6, baseline 정렬.
  - AC-2: 색상 토큰화(Primary `#5B64E3` 또는 브랜드), Neutral은 gray-100/200 축, 1px pure black 보더 금지.
  - AC-3: hover/active 대비 변화 8–15% 이내, box-shadow 무광 유지, focus ring 2px(contrast ≥3:1).
- 칩/배지/필터
  - AC-4: 높이 48±2px, line-height 1.15–1.2, nowrap 유지(또는 max-height 56px 선택 적용 후 일관화).
- 카드
  - AC-5: 헤더/바디/푸터 수직 리듬 8/16/24px 정규화, hover 이동 ≤1px, shadow md 이하.
- 모바일(390)
  - AC-6: 모든 탭/칩/버튼 tap target ≥48px, 군집 간 세로 간격 ≥8px, 폴드 내 주요 CTA 가시.

---

# MVP(빨간글씨 제외) 대비 갭 분석 및 우선순위 백로그(사용자 여정 중심)

아래 항목은 첨부 MVP 표의 기본(흑색 항목)만 반영하여, 현재 구현과의 차이를 사용자 여정 순으로 정리했습니다.

## P0 — 즉시(핵심 경험)
1) 전자동화책 뷰어(Reader) 구축
- 현황: 상세/목록에 썸네일·데모 영상은 표시되나, "읽기" 실행 시 전용 뷰어 부재.
- 해야 할 일:
  - 라우트/화면: `GET /courses/:id/read` → `Courses::ReadersController#show`(또는 `CoursesController#read`).
  - 뷰어 UI: 페이지 넘김(이전/다음, 썸네일 시크), 확대/축소, 전체화면, 진행률, 책갈피, 내레이션 토글(선택) 기본.
  - 데이터: `public/ebooks/:course_id/pages/page_001.jpg` 형태의 페이지 이미지(MVP는 로컬 파일/정적 경로)와(옵션) 페이지별 오디오.
  - 접근성: 키보드 화살표/스와이프, 포커스 링, 48px 타깃.
- AC:
  - 16:9/세로 화면 모두 프레임 내 표시, 100페이지 기준 전/후/점프 정상 동작.
  - 5분 내 테스트 독서 시 스크롤/줌/페이지 전환에 끊김·로딩 오류 없음.

2) 구연동화 전용 플레이어 정돈(현재 watch 페이지 고도화)
- 현황: `courses/watch`에 커스텀 컨트롤 존재. 실제 영상 연결과 이어보기/속도/키보드 제어 대부분 탑재.
- 해야 할 일:
  - 소스 연결 정책: HLS(m3u8) 우선, 없으면 mp4. 코스별 video_url 필드 또는 `public/videos/:id` 루트.
  - 이어보기(재방문 시 마지막 위치): localStorage `watch:course_id:position`.
  - 자막(WebVTT) 지원(있을 시 자동 노출).
- AC:
  - 30분 영상 재생 시 진행바/속도/자막/키보드 단축키 동작, 2회 재방문 후 이어보기 정상.

3) 코스-미디어 연결 구조(관리자/작가 업로드의 최소 경로)
- 현황: 썸네일은 자산 파이프라인에서 매칭, 영상·페이지는 데모 파일.
- 해야 할 일(간소화):
  - 코스 편집 폼에 텍스트 경로 필드 추가: `ebook_pages_root`, `video_url`(Active Storage 미도입 시 임시).
  - 서버 재시작 없이 반영 가능한 범위로(개발): 폼 → DB 저장 → 뷰어/플레이어가 경로 사용.
- AC:
  - 관리자에서 경로 저장 후 즉시 상세/뷰어/플레이어에 반영.

## P1 — 결제/권한/온보딩
4) 수강 권한/게이팅(로그인/구매 전용 구간 분리)
- 현황: 장바구니·수강(enroll) 로직은 존재, 실제 결제는 미도입.
- 해야 할 일:
  - 비로그인: 상세에서 `로그인 후 수강` 버튼 노출, 뷰어/플레이어 접근 시 로그인/수강 체크.
  - 수강 여부: `Enrollment` 기반 접근 제어(미수강자는 프리뷰 10%만 허용).
- AC: 비로그인·미수강·수강 3상태에서 버튼/접근 분기와 안내 문구 정상.

5) 결제(모의 결제 또는 링크아웃 결제)
- 현황: 결제 PG 미연동.
- 해야 할 일(빨간 항목 제외 원칙에 맞춘 MVP 간소화):
  - "모의 결제" 라우트/폼으로 결제 성공 상태만 생성 → `Enrollment` 발급.
  - 추후 PG 연동 시 동일 인터페이스 유지.
- AC: 모의 결제 성공 시 바로 수강 상태로 전환, 실패/취소 플로우도 반환.

## P2 — 탐색/검색/SEO/운영
6) 검색/필터 고도화(홈 필터 탭과 검색페이지 정합)
- 해야 할 일: 홈의 연령/주제/목표/길이/난이도 탭 클릭 → `/courses` 검색 파라미터로 연결, 검색페이지에서 동일 필터 적용.
- AC: 동일 파라미터로 홈/검색 결과가 일치(아이템 수 ±1 이내).

7) SEO/OG 스키마
- 해야 할 일: 코스 상세에 `og:title/description/image`, `ld+json` Course/VideoObject(구연동화) 삽입.
- AC: 공유 시 썸네일/제목 정상, 구조화 데이터 검사 통과.

8) 운영 페이지 최소 세트
- 해야 할 일: 코스 생성/편집에서 썸네일·페이지 루트·비디오 URL 텍스트 입력, 공개/비공개 토글.
- AC: 생성/수정/삭제 동작, 목록 정렬/검색 기본.

각 항목 공통 실측 루틴
- 성능: LCP ≤ 2.5s(캐시 이후), 동영상 첫 프레임 ≤ 2s(로컬/샘플 기준).
- 접근성: 키보드 탭 순서/포커스 링, 모바일 터치 타깃 ≥48px 유지.

리스크/완화
- 대용량 영상 로딩 지연 → HLS/비트레이트 계단, 포스터 우선 노출.
- 리더 데이터 준비(페이지 이미지) → 최초 MVP는 10~20p 샘플 콘텐츠로 시작.

---

## 4) 수정 파일 범위(고정)
- `app/assets/stylesheets/premium_design_system.scss`(전역 유틸·상태)
- `app/assets/stylesheets/modern_design.scss`(필요 시 톤 조정)
- `app/assets/stylesheets/minimal_buttons.scss`(충돌/오버라이드 보정)
- `app/assets/stylesheets/tokens.scss`(토큰 추가 시)
- 마크업 변경 금지

## 5) 상세 액션 플랜(나노·메타 단위)
1) 버튼 리디자인(look & feel)
   - `.btn` 기본색을 브랜드 프라이머리(예: `#5B64E3`)로 전환, black 기본 제거(secondary는 gray-700/600 수준). 
   - `.btn-outline-*`: 보더 `rgba(91,100,227,0.35)`로 완화, hover 채움 강도 8–12%.
   - `.btn-modern`: gradient 글로스 축소, 반경 `var(--btn-radius-neo)`, 텍스트 자간 0.25–0.5px 수준.
   - 크기 변형 통일: sm(40–44px), md(48–52px), lg(56–60px) 라인하이트·패딩 세트화.
   - 상태: hover translateY ≤1px, shadow 강도 md→약화, active는 translateY 0, brightness 0.98.
2) 칩/배지/필터
   - paddingX 16–20px, paddingY 10–12px, 보더 대비 5–8%p 완화(gray-200 전후).
   - 활성/선택: box-shadow 대신 1px 하이라이트 + 미세 틴트 배경.
   - 그룹 wrap 시 행 간격 8–12px.
3) 카드
   - `.card-premium` shadow 채도 10–15% 감쇠, 이동 0–1px. 
   - 헤더/본문/푸터 여백 8/16/24 프리셋 도입(페이지별 선택 적용).
4) 접근성/포커스
   - `:focus-visible::after` 2px ring 유지, outline-offset 동등 효과 확보, 고대비 모드 검사.
5) 모바일 390
   - 필터/칩 밀도 완화(행 간격 8–12px), 터치 타깃 ≥48px 보장, 폴드 내 CTA 우선 노출.
6) 토큰/테마
   - `tokens.scss`에 Brand/Neutral/State 토큰 정리(Primary, Primary-600/700, Gray-100/200/300, Success/Danger 등)와 Elevation shadow 스케일 도입.
7) 캐스케이드/충돌 방지
   - `minimal_buttons.scss`의 `.btn` 오버라이드와 Bootstrap 계열 충돌 지점 점검: 전역 클래스 우선순위·!important 최소화.

## 6) 브라우저 실측 루틴(복제 가능)
- 뷰포트: 1440/1280/1024/768/390.
- 경로: `/`, `/courses`, `/teen_content`.
- 수집: `.btn, .btn-hero, .btn-modern, .btn-filter, .btn-teen-tab, .btn-age, .chip, .badge, .service-link, [class*='card-'], .card, .card-premium`.
- 항목: height, line-height, paddingY/X, align-items, vertical-align, display, min-height.
- 산출: 각 셀렉터별 min/max/avg + 불일치 리스트.

## 7) 리스크/롤백
- black→brand 변환 시 인지도 이슈: Primary 계열/중립 배경으로 보강.
- 밀도 완화로 1열 wrap 증가: 핵심 CTA 우선순위/접이식 처리로 상쇄.
 - 즉시 롤백 절차: `minimal_buttons.scss`의 `.btn`/`.btn-minimal-*` 블록에서 `#5B64E3` → `#000` 복귀, `btn-outline-*` 보더를 `2px solid #000`로 복구. `premium_design_system.scss`의 `--color-primary`/`--color-primary-dark` 토큰을 변경 전 값으로 복구.

## 8) 산출물 체크리스트(종료 시)
- [ ] 전/후 실측표(min/max/avg)
- [ ] 스크린샷 최소 2장(홈/코스 또는 홈/청소년 1440)
- [ ] 변경 셀렉터/스니펫 목록
- [ ] 배지 상한 정책(white-space 또는 max-height) 최종 사유 기록

---

# 내일 실행용 원샷 프롬프트

```text
역할: 풀스택(뷰/컨트롤러/정적자산) 엔지니어. 내일 MVP 기능 개발(P0 우선). 서버 재시작 없음(개발 자동 리로드 가정).
대상: /Users/l2dogyu/KICDA/ruby/kicda-jh

목표(순서 고정):
1) 전자동화책 리더(Reader) 추가
   - 라우트: `get '/courses/:id/read' => 'courses/readers#show'`
   - 뷰: `app/views/courses/readers/show.html.erb`(페이지 이미지 뷰어, 이전/다음/썸네일 시크, 확대/축소, 진행률, 책갈피)
   - 자산: `public/ebooks/:id/pages/page_###.jpg` 샘플 10p 구성(없으면 플레이스홀더)
   - 접근 제어: 미수강자는 첫 10%만 열람

2) 구연동화 플레이어 보강
   - 코스별 `video_url`(mp4/hls) 필드 또는 설정 파일로 연결
   - 이어보기 localStorage, 자막(vtt) 있으면 노출

3) 코스-미디어 경로 관리(간이)
   - 코스 편집폼에 `ebook_pages_root`, `video_url` 텍스트 입력 추가 → 상세/뷰어/플레이어 반영

4) 홈 필터 → /courses 파라미터 연동(연령/주제/목표/길이/난이도)

5) SEO/OG/구조화데이터(코스 상세)

AC 공통:
- 16:9 레이아웃 유지, 모바일 390에서 주요 버튼 ≥48px
- 미디어 없으면 안전한 플레이스홀더/안내 노출
- 로그인/수강 분기 명확(프리뷰 10% 정책)
```

---

## 부록: 권장 톤(참고)
- Primary: `#5B64E3`(focus ring와 일관)
- Neutral: gray-50~300 위계, 보더 gray-200 전후(검정보더 금지)
- 반경: 12px 기본(8/16 변형 허용)
- 애니메이션: 150–250ms, translateY ≤1px, shadow 변화 미세화
