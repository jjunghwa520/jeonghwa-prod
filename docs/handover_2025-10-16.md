### 정화의 서재 - 인수인계서 (2025-10-16)

- 프로젝트 경로: `/Users/l2dogyu/KICDA/ruby/kicda-jh`
- 서버: 이미 구동 중(재시작 금지). 변경 후 브라우저로 즉시 검증.
- 권장 뷰포트: 1440 / 1024 / 390

---

### 어제(2025-10-15) 작업 요약
- PageFlip 로컬 번들화 완료: `public/vendor/page-flip.browser.js`, `public/vendor/page-flip.css`, 뷰 로컬 우선 + CDN 폴백
- 리더 캡션/TTS: 캡션 바 + Web Speech API(ko-KR), 페이지 전환 시 TTS 자동 중지/갱신
- 이미지 프리로드/메모리: ±2 인접 페이지만 프리로드, 멀리 떨어진 페이지 언로드
- 접근성/키보드: Home/End/PageUp/PageDown, 캡션 aria-live
- 플레이어 폴리싱: 포스터=썸네일, 이어보기 복원, 자막 첫 트랙 default
- 홈↔목록 QA: 카테고리 링크 정상, 1440/390 레이아웃 OK, 콘솔 에러 0(경고 1건: CSS preload)

변경 파일(핵심)
- `app/views/courses/readers/show.html.erb`
- `app/views/courses/watch.html.erb`
- `public/vendor/page-flip.browser.js`, `public/vendor/page-flip.css`

브라우저 검증
- `/courses/1/read`, `/courses/1/watch`에서 1440/390 확인, 콘솔 에러 0, preload 경고 1

---

### 오늘(2025-10-16) 작업 방향(P0)
핵심 목표: "페이지의 모든 기능을 최대치로 체험"하기 위한 300% 테스트/목업 데이터 주입 및 장시간 시나리오 안정성 점검. 이후 관리자페이지(어드민) 생성·연동까지.

P0. 대용량/과다 케이스 테스트 데이터 준비(300% 이상)
- 전자책(ebook)
  - 페이지 수: 100~200p급 2종(이미지 해상도 2K/4K 혼합), 12p 샘플 대비 10~15배 규모
  - 캡션 텍스트: `page_XXX.txt` 50% 이상 커버, 긴 문장(300~600자) 포함
  - 경로: `public/ebooks/:id/pages/page_001..XXX.(jpg|png|webp)` + `.txt`
- 영상(storytelling)
  - 1~2시간급 MP4/HLS 각각 1종(720p/1080p), 파일 크기 수 GB급 목업(로컬 테스트용)
  - 자막 트랙 2개 이상(ko, en), 챕터/긴 자막 라인 혼재
  - 경로: `public/videos/:id/{main.mp4|index.m3u8}`, `public/videos/:id/*.vtt`

체크리스트(장시간/최대치)
- 리더: 빠른 연속 넘김, 랜덤 점프, ±2 프리로드 유지, 메모리 증가 추적, TTS 연속 동작
- 플레이어: 1~2시간 재생, 이어보기 정확도(±1초 이내), 10% 게이트 재현, 자막 토글 지연 없음
- 네트워크: 오프라인 모드에서 리더 정상(로컬 PageFlip), HLS 시나리오 제외
- 콘솔: 에러 0, 워닝 최소화(특히 preload 경고 제거 옵션)

P0. 관리자페이지(어드민) 1차 스캐폴딩
- 목적: 홈페이지 메뉴/게시/관리 항목을 직관적으로 한 곳에서 관리
- 라우팅: `/admin` 네임스페이스
- MVP 기능(읽기/쓰기)
  - Courses: 생성/수정/삭제, `video_url`, `ebook_pages_root`, `thumbnail`
  - Uploads: ebook 페이지/캡션 일괄 업로드(폴더 업로드 지원), 영상/자막 업로드
  - Reviews: 삭제/비활성화
  - Users: 권한(관리자/강사/학생) 표시, 검색
- 접근 제어: 관리자만 접근(기존 `require_login` + `current_user.admin?` 가드)

P0. 관리자페이지 기반 E2E 검증
- 어드민에서 테스트/목업 데이터 등록/수정/삭제 후, 프론트(홈/목록/상세/읽기/시청)에서 즉시 반영되는지 확인
- 케이스: 대용량 ebook 교체, 장시간 영상 교체, 자막 추가/교체, 캡션 추가/수정, 썸네일 교체
- 문제 발견 시: 관리자페이지에서 재수정 → 프론트에서 재검증(건바이건)

---

### 구현 지시(내일 작업 순서)
1) 테스트/목업 데이터 등록(로컬)
   - `public/ebooks/1001/pages/page_001..150.jpg` + `.txt` 일부
   - `public/videos/1001/main.mp4`(≥ 60분) + `ko.vtt`/`en.vtt`
   - `public/videos/1002/index.m3u8`(HLS) + 트랙들

2) 관리자페이지 생성(초안)
   - 라우트: `namespace :admin do resources :courses, :uploads, :reviews, :users end`
   - 컨트롤러/뷰: CRUD + 단순 폼
   - 인증/인가: `before_action :require_admin`

3) 관리자페이지-프론트 연동 검증
   - 코스 생성→홈/목록 반영, ebook 경로/영상 URL 지정→리더/플레이어 반영
   - 파일 업로드→경로 매핑 확인(자산 접근 가능)

4) 장시간/최대치 시나리오 테스팅
   - 리더: 15분 이상 연속 넘김 + TTS 조작 반복
   - 플레이어: 60~120분 연속 재생, 이어보기 복원, 자막 토글 반복

5) 워닝 정리(선택)
   - `application.css` preload 경고 제거(프리로드 삭제 또는 `as="style"`/onload 기법 적용)

AC(승인 기준)
- 대용량 데이터에서도 리더/플레이어 에러 0, UX 지연 최소
- 어드민 CRUD 반영이 프론트에 즉시 반영(새로고침 기준)
- 테스트 데이터 등록/수정/삭제 전 과정이 관리자페이지에서만 가능

---

### 참고 경로
- 리더: `app/controllers/courses/readers_controller.rb`, `app/views/courses/readers/show.html.erb`
- 플레이어: `app/controllers/courses_controller.rb#watch`, `app/views/courses/watch.html.erb`
- 상세/SEO: `app/views/courses/show.html.erb`, 레이아웃: `app/views/layouts/application.html.erb`

---

### 위험 요소 & 완화
- 대용량 자산로딩으로 로컬 개발환경 성능 저하 → 케이스별 개별 테스트, 이미지 일부 webp
- HLS 테스트는 Safari/크롬 환경 차이 → HLS.js 폴백 포함(현 구현)
- 파일 시스템 경로 오류/권한 이슈 → public 하위 경로 고정, 업로드 후 존재 확인


