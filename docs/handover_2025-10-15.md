### 정화의 서재 - 인수인계서 (2025-10-15)

- 프로젝트 경로: `/Users/l2dogyu/KICDA/ruby/kicda-jh`
- 서버: 이미 구동 중(재시작 금지). 변경 후 브라우저로 즉시 검증.
- 권장 뷰포트: 1440 / 1024 / 390

---

### 오늘까지 반영된 핵심
1) 전자동화책 리더(Reader)
- StPageFlip(페이지 플립) 엔진 도입(CDN) → 자연스러운 3D 넘김/덮임, 그림자/두께, 표지(showCover)
- 흐름: 표지(1p) → (1,2) → (3,4) …, 드래그/클릭/키보드/스와이프 지원
- 관리자 계정은 프리뷰 무제한, 미수강자는 10% 기준 + 최소 3p 보장
- 파일: `app/controllers/courses/readers_controller.rb`, `app/views/courses/readers/show.html.erb`

2) 구연동화 플레이어(Watch)
- 이어보기(localStorage), 자막 자동 삽입(`/public/videos/:id/*.vtt`), 10% 프리뷰 오버레이
- 소스 미지정 시 데모 MP4 폴백
- 파일: `app/views/courses/watch.html.erb`, `app/controllers/courses_controller.rb#watch`

3) 코스–미디어 경로/폼
- 마이그레이션: `video_url`, `ebook_pages_root`
- 폼 반영: `new.html.erb`, `edit.html.erb`

4) SEO/OG/구조화데이터
- 상세(`courses/show.html.erb`)에 OG 메타/JSON-LD 삽입, 레이아웃에 `yield :meta`

5) 샘플 자산
- 전자책 페이지 12p: 코스 id 1(사자왕), 2(요정), 11(백설공주)
- 경로: `public/ebooks/:id/pages/page_001..012.(jpg|png)`
- 플레이어: `video_url`에 샘플 MP4, 자막 `public/videos/:id/ko.vtt`

---

### 검증 경로
- 목록: `/courses?category=ebook`, `/courses?category=storytelling`
- 상세: `/courses/:id`
- 리더: `/courses/:id/read` (넘김/표지/썸네일/줌/전체화면/프리뷰 로직)
- 플레이어: `/courses/:id/watch` (재생/이어보기/자막/10% 게이트)

---

### 변경 파일(핵심)
- 리더: `app/controllers/courses/readers_controller.rb`, `app/views/courses/readers/show.html.erb`
- 플레이어: `app/controllers/courses_controller.rb`, `app/views/courses/watch.html.erb`
- 상세/SEO: `app/views/courses/show.html.erb`, `app/views/layouts/application.html.erb`
- 폼/마이그레이션: `app/views/courses/new.html.erb`, `app/views/courses/edit.html.erb`, `db/migrate/20251013100000_add_media_fields_to_courses.rb`

---

### 리스크 & 대응
- CDN 차단/지연으로 PageFlip 로딩 실패 가능 → 로컬 번들화 필요(P0)
- 특정 페이지 이미지 404 → `public/ebooks/:id/pages` 누락 파일 채움
- 모바일 성능(이미지 용량) → 인접 페이지 프리로드/해상도 최적화(P1)

---

### 내일(2025-10-15) 작업 계획
P0. PageFlip 로컬 번들화
- `vendor/javascript/page-flip.browser.min.js`, `vendor/styles/page-flip.css` 추가
- `show.html.erb`에서 로컬 우선, CDN 폴백 구조로 로드
- AC: 네트워크 오프라인에서도 리더 정상 구동, 콘솔 에러 0

P0. 리더 캡션/읽어주기(TTS)
- 페이지 하단 캡션 바 + `speechSynthesis` 버튼(ko-KR)
- 캡션 소스: `public/ebooks/:id/pages/page_XXX.txt`(존재 시)
- 페이지 전환 시 TTS 자동 중지/갱신
- AC: `/courses/1/read`에서 캡션/TTS 동작, 전환 싱크 OK

P1. 이미지 프리로드/메모리 관리
- 현재·이전·다음 2세트(최대 6p) 프리로드, 멀리 떨어진 페이지 언로드
- AC: 빠른 넘김에도 로딩 지연 체감 최소화

P1. 접근성/키보드
- Home/End(처음/끝), PageUp/Down(스프레드 단위) 지원
- 캡션 aria-live, 버튼 aria-label
- AC: Lighthouse A11y ≥ 90

P1. 플레이어 폴리싱
- 포스터=코스 썸네일, `video_url` 없으면 데모 MP4
- 게이트 오버레이 문구/CTA 정돈

P2. 홈↔목록 파라미터 QA
- 홈 탭 → `/courses` 결과 일치(±1 이내), 스크린샷 수집(6장 이상)

---

### 체크리스트(AC)
- 리더: 로컬/폴백 로드 OK, 표지→스프레드, 관리자 무제한, 미수강 10%+3p, 캡션/TTS 동작
- 플레이어: 재생/자막/이어보기/10% 게이트 OK
- SEO/OG/JSON-LD: 구조화 데이터 테스트 통과, SNS 미리보기 정상

---

### 참고 규칙
- 서버 재시작 금지, 변경 후 브라우저로 즉시 검증
- 콘솔 에러/워닝 최소화, 들여쓰기/스타일 기존 유지

