### 정화의서재 상용 E2E 자동화 요청 및 실행 절차 (2025-11-01)

#### 목적
- 상용 도메인(`정화의서재.kr`)을 대상으로 게스트 → 회원가입 → 로그인 → 유료 결제 → 결제 이후 접근까지 전 구간을 반복 가능하게 검증합니다.
- 결제 단계는 대금 결제·환불 등 실거래 요소가 포함되므로 전면 자동화가 제한됩니다. 아래 항목을 제공해주시면 최대한 자동화·반자동화로 전환하겠습니다.

---

### 1) 우리가 즉시 수행할 작업(자동화/반자동화)
- 게스트 UX: 홈/목록/상세/프리뷰(10%) 접근 확인 — 프로덕션 대상, 스냅샷 캡처 자동화
- 회원가입 UX: 성인 플로우 폼 제출/오류/성공 플로우 — 버튼 로딩/약관 체크/유효성 검사 자동화 확인
- 로그인 UX: 정상/오류 메시지, 세션 유지 — 스냅샷/콘솔 로그 수집
- 체크아웃 진입 UX: 금액/약관/토스 위젯 로드 — 위젯 초기 로드까지 자동화
- 결제 이후 UX: 성공/실패 리다이렉트 처리 및 “내 동화책” 반영 — 성공 콜백 이후 화면/DB 상태 점검(반자동)

도구: Playwright + 브라우저 원격 시나리오(상용 도메인 대상), 결과 스크린샷/Har 로그 보관

---

### 2) 완전자동화를 위해 사용자님이 제공/수행해야 할 항목
- 결제 관련(필수)
  - 실거래 최소 금액 테스트 상품(예: 100원) 1개 — 테스트 후 즉시 환불 가능 정책 합의
  - 테스트용 실결제 카드(3DS/ARS 인증 포함) 또는 결제대행사 제공 테스트 상점키·테스트 카드(상용 도메인 허용 시)
  - 실패/취소 시나리오 재현용 가이드(특정 BIN/금액 조합 등)

- 접근 권한/환경(권장)
  - 운영 배포 권한 또는 CI 파이프라인 트리거 권한(본 커밋을 상용에 반영하기 위함)
  - 운영 로그 접근(애플리케이션/웹서버/웹훅 수신 로그) — 최소 `UsersController#create`, `PaymentsController#checkout/confirm/fail`, `/payments/webhook`
  - 관리자 계정 또는 테스트 계정 생성 권한(테스트 데이터 정리 목적)

- 데이터 정리(권장)
  - 테스트 사용자/주문/결제 레코드 삭제 또는 “테스트” 태그 부여 규칙 정의
  - 환불 처리 절차(수동/자동) 및 회계 영향 범위 확인

---

### 3) 이번 커밋으로 반영된 개선(배포 필요)
- 전자동화책 프리뷰: 게스트도 `/courses/:id/read` 프리뷰 10% 접근 가능(구매 전 체험 경로 강화)
- 코스 상세 프리뷰 링크 안정화: `data-turbo="false"` 적용으로 링크 클릭 무반응 사례 해소
- 회원가입 제출 UX: Turbo 호환 초기화, 약관 체크 실시간 버튼 활성화, 제출 시 로딩/중복방지

배포 후 상용 도메인에서 재검증 예정 항목
- 프리뷰 게스트/회원 모두 링크 정상 이동
- 회원가입 성공 시 홈 리다이렉트 및 헤더 로그인 상태 반영
- 체크아웃 위젯 로드 및 성공/실패 콜백 처리 확인

---

### 4) 운영 배포 체크리스트
1. 애플리케이션 배포(서버 재시작 불필요 지침 준수)
2. 데이터베이스 마이그레이션(필요 시):
   - `rails db:migrate RAILS_ENV=production`
3. 환경 변수/시크릿 재확인(결제 키, 콜백 URL)
4. CSP/도메인 허용 목록 최종 점검(토스 `api/widget`, 폰트/CDN)
5. 빠른 롤백 경로 확인

---

### 5) 상용 결제 테스트 절차(제공 항목 확보 시)
1. 테스트 상품(100원) 상세 → 체크아웃 진입
2. 약관 3종 체크 후 결제 시작 → 카드사 인증(3DS/ARS)
3. 성공 콜백(`/payments/confirm`) 도달 확인 → 코스 수강 권한/“내 동화책” 반영
4. 실패/취소 플로우 각각 재현 → 적절한 사용자 메시지/복귀 경로 확인
5. 웹훅 수신 로그에서 상태 동기화(완료/환불/실패) 검증
6. 환불 처리 및 데이터 정리

---

### 6) 산출물
- 테스트 리포트 업데이트: `docs/UX_E2E_상용_테스트_보고서_2025-11-01.md`
- 스크린샷/Har/콘솔 로그(필요 시)
- 이 문서(사용자 요청/절차) 최신화

---

### 7) 타임라인 제안
- D+0: 코드 배포 → 게스트/회원가입/프리뷰 재검증
- D+1: 결제 성공/실패/취소 3가지 시나리오 실사용 테스트(제공 항목 확보 시)
- D+2: 웹훅/DB/권한 반영 로그 취합 → 최종 보고서/심사 패키지 정리


