namespace :characters do
  desc "Generate character poses for sprite animation"
  task generate_poses: :environment do
    require 'net/http'
    require 'json'
    require 'base64'
    require 'fileutils'

    # Vertex AI ì„¤ì •
    api_key = ENV['GEMINI_API_KEY']
    if api_key.nil?
      puts "âŒ GEMINI_API_KEY í™˜ê²½ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."
      exit 1
    end

    # ìºë¦­í„°ë³„ í¬ì¦ˆ ì •ì˜
    character_poses = {
      'jeonghwa' => {
        base_description: "í•œêµ­ì¸ 40ëŒ€ ì—¬ì„± êµìœ¡ì, ì§§ì€ ê³±ìŠ¬ë¨¸ë¦¬, íŒŒë€ ì¹´ë””ê±´, ì§„ì£¼ ëª©ê±¸ì´, ê²€ì€ ì¹˜ë§ˆ",
        poses: {
          # ì‹¤ì œ ê±·ê¸° ì‚¬ì´í´ - 8í”„ë ˆì„ ê±·ê¸° ì• ë‹ˆë©”ì´ì…˜
          'walk_cycle_1' => "ê±·ê¸° í”„ë ˆì„ 1: ì˜¤ë¥¸ë°œì´ ë’¤ë¡œ, ì™¼ë°œì´ ì•ìœ¼ë¡œ, ì˜¤ë¥¸íŒ”ì´ ì•ìœ¼ë¡œ ìŠ¤ìœ™, ìì—°ìŠ¤ëŸ¬ìš´ ê±¸ìŒê±¸ì´",
          'walk_cycle_2' => "ê±·ê¸° í”„ë ˆì„ 2: ì˜¤ë¥¸ë°œì´ ì§€ë©´ì— ë‹¿ê¸° ì‹œì‘, ì™¼ë°œì´ ë“¤ë ¤ìˆìŒ, íŒ”ì˜ ì¤‘ê°„ ìŠ¤ìœ™",
          'walk_cycle_3' => "ê±·ê¸° í”„ë ˆì„ 3: ì–‘ë°œì´ ì§€ë©´ì— ë‹¿ì•„ìˆìŒ, ëª¸ì˜ ì¤‘ì‹¬ì´ ì´ë™í•˜ëŠ” ìˆœê°„",
          'walk_cycle_4' => "ê±·ê¸° í”„ë ˆì„ 4: ì™¼ë°œì´ ë’¤ë¡œ, ì˜¤ë¥¸ë°œì´ ì•ìœ¼ë¡œ, ì™¼íŒ”ì´ ì•ìœ¼ë¡œ ìŠ¤ìœ™",
          'walk_cycle_5' => "ê±·ê¸° í”„ë ˆì„ 5: ì™¼ë°œì´ ì§€ë©´ì—ì„œ ë–¨ì–´ì§€ê¸° ì‹œì‘, ì˜¤ë¥¸ë°œì´ ì•ìœ¼ë¡œ ë‚˜ì•„ê°",
          'walk_cycle_6' => "ê±·ê¸° í”„ë ˆì„ 6: ì™¼ë°œì´ ì™„ì „íˆ ë“¤ë ¤ìˆìŒ, ì˜¤ë¥¸ë°œì— ì²´ì¤‘ì´ ì‹¤ë¦¼",
          'walk_cycle_7' => "ê±·ê¸° í”„ë ˆì„ 7: ì–‘ë°œì´ ë‹¤ì‹œ ì§€ë©´ì— ë‹¿ìœ¼ë ¤ëŠ” ìˆœê°„, ë°˜ëŒ€ ë°©í–¥ ìŠ¤ìœ™",
          'walk_cycle_8' => "ê±·ê¸° í”„ë ˆì„ 8: ì‚¬ì´í´ ì™„ì„±, ë‹¤ì‹œ ì²« ë²ˆì§¸ í”„ë ˆì„ìœ¼ë¡œ ì—°ê²°ë˜ëŠ” ìì„¸",
          
          # ë°©í–¥ ì „í™˜ ì• ë‹ˆë©”ì´ì…˜ - ì˜†ëª¨ìŠµì—ì„œ ì •ë©´ìœ¼ë¡œ
          'turn_side_to_front_1' => "ì˜†ëª¨ìŠµì—ì„œ ì‹œì‘, ì™„ì „íˆ ì¸¡ë©´ì„ ë°”ë¼ë³´ê³  ìˆìŒ",
          'turn_side_to_front_2' => "15ë„ íšŒì „, ì•½ê°„ ì •ë©´ ìª½ìœ¼ë¡œ ëª¸ì„ ëŒë¦¬ê¸° ì‹œì‘",
          'turn_side_to_front_3' => "30ë„ íšŒì „, ì–¼êµ´ì´ ë°˜ì¸¡ë©´ì„ ë³´ì´ê¸° ì‹œì‘",
          'turn_side_to_front_4' => "45ë„ íšŒì „, ì–¼êµ´ì˜ ì ˆë°˜ì´ ë³´ì´ëŠ” ê°ë„",
          'turn_side_to_front_5' => "60ë„ íšŒì „, ì–¼êµ´ì´ ë” ë§ì´ ë³´ì´ê¸° ì‹œì‘",
          'turn_side_to_front_6' => "75ë„ íšŒì „, ê±°ì˜ ì •ë©´ì— ê°€ê¹Œìš´ ê°ë„",
          'turn_side_to_front_7' => "90ë„ íšŒì „ ì™„ì„±, ì™„ì „í•œ ì •ë©´ì„ ë°”ë¼ë³´ëŠ” ìì„¸",
          
          # ì œìŠ¤ì²˜ ì• ë‹ˆë©”ì´ì…˜ - íŒ”ì˜ ì‹¤ì œ ì›€ì§ì„
          'gesture_start' => "íŒ”ì„ ëª¸ ì˜†ì— ìì—°ìŠ¤ëŸ½ê²Œ ë‘ê³  ìˆëŠ” ì‹œì‘ ìì„¸",
          'gesture_lift_1' => "ì˜¤ë¥¸íŒ”ì„ ì²œì²œíˆ ë“¤ì–´ì˜¬ë¦¬ê¸° ì‹œì‘, ì–´ê¹¨ê°€ ì•½ê°„ ì˜¬ë¼ê°",
          'gesture_lift_2' => "íŒ”ì´ í—ˆë¦¬ ë†’ì´ê¹Œì§€ ì˜¬ë¼ì˜¨ ìƒíƒœ, ì†ëª©ì´ ì•½ê°„ êº¾ì„",
          'gesture_point' => "ì™„ì „íˆ íŒ”ì„ ë»—ì–´ ê°€ë¦¬í‚¤ëŠ” ìì„¸, ì†ê°€ë½ìœ¼ë¡œ í¬ì¸íŒ…",
          'gesture_emphasize' => "í¬ì¸íŒ…í•˜ë©´ì„œ ì•½ê°„ ì•ìœ¼ë¡œ ëª¸ì„ ê¸°ìš¸ì—¬ ê°•ì¡°í•˜ëŠ” ëª¨ìŠµ",
          
          # ìŠ¬ë¼ì´ë“œ 2: êµìœ¡ í”„ë¡œê·¸ë¨ ì†Œê°œ  
          'approach_teaching' => "êµìœ¡ìë¡œì„œ ë‹¤ê°€ê°€ëŠ” ëª¨ìŠµ, ìì‹ ê° ìˆëŠ” í‘œì •ê³¼ ìì„¸",
          'teaching_gesture_1' => "ì–‘ì†ì„ ì‚¬ìš©í•´ ì„¤ëª…í•˜ëŠ” ëª¨ìŠµ, ì „ë¬¸ê°€ë‹¤ìš´ ì œìŠ¤ì²˜",
          'teaching_gesture_2' => "í•œ ì†ì„ ë“¤ì–´ í¬ì¸íŠ¸ë¥¼ ê°•ì¡°í•˜ëŠ” ëª¨ìŠµ, ì§‘ì¤‘ëœ í‘œì •",
          'professional_pose' => "ì „ë¬¸ê°€ë‹¤ìš´ ìì„¸ë¡œ ì„œìˆëŠ” ëª¨ìŠµ, ìì‹ ê° ìˆëŠ” í‘œì •",
          
          # ìŠ¬ë¼ì´ë“œ 3: ì„±ê³µ ì‚¬ë¡€ ì†Œê°œ
          'proud_presentation_1' => "ìë‘ìŠ¤ëŸ½ê²Œ ë°œí‘œí•˜ëŠ” ëª¨ìŠµ, ì–‘ì†ì„ ë²Œë¦¬ë©° ì„±ê³¼ë¥¼ ë³´ì—¬ì¤Œ",
          'proud_presentation_2' => "ë¿Œë“¯í•œ í‘œì •ìœ¼ë¡œ ê²°ê³¼ë¥¼ ì œì‹œí•˜ëŠ” ëª¨ìŠµ, ë§Œì¡±ìŠ¤ëŸ¬ìš´ ë¯¸ì†Œ",
          'achievement_gesture' => "ì„±ê³¼ë¥¼ ë³´ì—¬ì£¼ëŠ” ì œìŠ¤ì²˜, í•œ ì†ì„ ìœ„ë¡œ ì˜¬ë¦¬ë©° ì„±ê³µì„ í‘œí˜„",
          'confident_pose' => "ìì‹ ê° ë„˜ì¹˜ëŠ” í¬ì¦ˆ, ì–´ê¹¨ë¥¼ í´ê³  ë‹¹ë‹¹í•œ ìì„¸"
        }
      },
      
      'bear' => {
        base_description: "ê·€ì—¬ìš´ ê°ˆìƒ‰ ê³° ìºë¦­í„°, ë‘¥ê·¼ ê·€, ì‘ì€ ëˆˆ, ë¶€ë“œëŸ¬ìš´ í„¸, ì¹œê·¼í•œ í‘œì •",
        poses: {
          # ê³°ì˜ ì‹¤ì œ ë’¤ëš±ê±°ë¦¬ë©° ê±·ê¸° ì‚¬ì´í´ - 6í”„ë ˆì„
          'waddle_cycle_1' => "ë’¤ëš±ê±°ë¦¬ë©° ê±·ê¸° 1: ì™¼ë°œì— ì²´ì¤‘ì„ ì‹¤ì–´ ì™¼ìª½ìœ¼ë¡œ ê¸°ìš¸ì–´ì§, ì˜¤ë¥¸ë°œì´ ì‚´ì§ ë“¤ë¦¼",
          'waddle_cycle_2' => "ë’¤ëš±ê±°ë¦¬ë©° ê±·ê¸° 2: ì˜¤ë¥¸ë°œì„ ì•ìœ¼ë¡œ ë‚´ë”›ëŠ” ì¤‘, ëª¸ì˜ ê· í˜•ì„ ì¡ìœ¼ë ¤ í•¨",
          'waddle_cycle_3' => "ë’¤ëš±ê±°ë¦¬ë©° ê±·ê¸° 3: ì˜¤ë¥¸ë°œì— ì²´ì¤‘ì´ ì‹¤ë ¤ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ê¸°ìš¸ì–´ì§, ì™¼ë°œì´ ë’¤ì—",
          'waddle_cycle_4' => "ë’¤ëš±ê±°ë¦¬ë©° ê±·ê¸° 4: ì™¼ë°œì„ ì•ìœ¼ë¡œ ë‚´ë”›ëŠ” ì¤‘, ëª¸ì´ ì¤‘ì•™ìœ¼ë¡œ ëŒì•„ì˜´",
          'waddle_cycle_5' => "ë’¤ëš±ê±°ë¦¬ë©° ê±·ê¸° 5: ë‹¤ì‹œ ì™¼ë°œì— ì²´ì¤‘ì´ ì‹¤ë ¤ ì™¼ìª½ìœ¼ë¡œ ê¸°ìš¸ì–´ì§",
          'waddle_cycle_6' => "ë’¤ëš±ê±°ë¦¬ë©° ê±·ê¸° 6: ì‚¬ì´í´ ì™„ì„±, ë‹¤ìŒ ê±¸ìŒ ì¤€ë¹„ ìì„¸",
          
          # ê³°ì˜ ë°©í–¥ ì „í™˜ - ì˜†ëª¨ìŠµì—ì„œ ì •ë©´ìœ¼ë¡œ
          'bear_turn_1' => "ì™„ì „í•œ ì˜†ëª¨ìŠµ, ì¸¡ë©´ í”„ë¡œí•„ë¡œ ì•ì„ ë°”ë¼ë´„",
          'bear_turn_2' => "ì•½ê°„ ì •ë©´ ìª½ìœ¼ë¡œ ê³ ê°œë¥¼ ëŒë¦¬ê¸° ì‹œì‘, ê·€ì˜ ê°ë„ ë³€í™”",
          'bear_turn_3' => "ë°˜ì¸¡ë©´, í•œìª½ ëˆˆì´ ë³´ì´ê¸° ì‹œì‘í•˜ëŠ” ê°ë„",
          'bear_turn_4' => "3/4 ê°ë„, ì–¼êµ´ì˜ ëŒ€ë¶€ë¶„ì´ ë³´ì´ëŠ” ìƒíƒœ",
          'bear_turn_5' => "ê±°ì˜ ì •ë©´, ì–‘ìª½ ê·€ê°€ ëª¨ë‘ ë³´ì´ê¸° ì‹œì‘",
          'bear_turn_6' => "ì™„ì „í•œ ì •ë©´, ë‘¥ê·¼ ì–¼êµ´ì´ ì •ë©´ì„ ë°”ë¼ë´„",
          
          # ê³°ì˜ í˜¸ê¸°ì‹¬ í‘œí˜„ - ì‹¤ì œ ëª©ê³¼ ë¨¸ë¦¬ ì›€ì§ì„
          'curious_start' => "í‰ë²”í•œ ì •ë©´ ìì„¸, ì¤‘ë¦½ì ì¸ í‘œì •",
          'curious_lean_forward' => "ëª©ì„ ì•ìœ¼ë¡œ ë‚´ë°€ë©° í˜¸ê¸°ì‹¬ì„ ë³´ì´ëŠ” ìì„¸",
          'curious_tilt_left' => "ê³ ê°œë¥¼ ì™¼ìª½ìœ¼ë¡œ ê¸°ìš¸ì´ë©° ìì„¸íˆ ë³´ë ¤ëŠ” ëª¨ìŠµ",
          'curious_tilt_right' => "ê³ ê°œë¥¼ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ê¸°ìš¸ì´ë©° ë‹¤ë¥¸ ê°ë„ë¡œ ê´€ì°°",
          'curious_eyes_wide' => "ëˆˆì„ í¬ê²Œ ëœ¨ê³  ê´€ì‹¬ì„ ë³´ì´ëŠ” í‘œì •",
          
          # ìŠ¬ë¼ì´ë“œ 2
          'study_walking' => "ì±…ì„ ë“¤ê³  ê±¸ì–´ê°€ëŠ” ëª¨ìŠµ, ì§‘ì¤‘í•˜ë©° ê³µë¶€í•˜ëŠ” ìì„¸",
          'focused_front' => "ì •ë©´ì—ì„œ ì§‘ì¤‘í•˜ëŠ” ëª¨ìŠµ, ì§„ì§€í•œ í‘œì •ìœ¼ë¡œ í•™ìŠµì— ëª°ë‘",
          'reading_pose' => "ì±…ì„ ì½ê³  ìˆëŠ” ìì„¸, ê³ ê°œë¥¼ ì•½ê°„ ìˆ™ì´ê³  ì§‘ì¤‘",
          'thinking_pose' => "ìƒê°í•˜ëŠ” ìì„¸, í•œ ì†ì„ í„±ì— ëŒ€ê³  ê³ ë¯¼í•˜ëŠ” ëª¨ìŠµ",
          
          # ìŠ¬ë¼ì´ë“œ 3  
          'march_1' => "í–‰ì§„í•˜ëŠ” ëª¨ìŠµ, ì™¼ë°œì„ ë†’ì´ ë“¤ì–´ ë‹¹ë‹¹í•˜ê²Œ ê±·ê¸°",
          'march_2' => "í–‰ì§„í•˜ëŠ” ëª¨ìŠµ, ì˜¤ë¥¸ë°œì„ ë†’ì´ ë“¤ì–´ ë‹¹ë‹¹í•˜ê²Œ ê±·ê¸°",
          'celebration_1' => "ì¶•í•˜í•˜ëŠ” ë™ì‘, ì–‘íŒ”ì„ ìœ„ë¡œ ì˜¬ë¦¬ë©° ê¸°ë»í•˜ëŠ” ëª¨ìŠµ",
          'celebration_2' => "ì¶•í•˜í•˜ëŠ” ë™ì‘, ì í”„í•˜ë“¯ ê¸°ë»í•˜ëŠ” ëª¨ìŠµ",
          'success_pose' => "ì„±ê³µì„ í‘œí˜„í•˜ëŠ” í¬ì¦ˆ, ê°€ìŠ´ì„ í´ê³  ìë‘ìŠ¤ëŸ¬ìš´ í‘œì •"
        }
      },
      
      'rabbit' => {
        base_description: "ê·€ì—¬ìš´ í°ìƒ‰ í† ë¼ ìºë¦­í„°, ê¸´ ê·€, ë‘¥ê·¼ ê¼¬ë¦¬, í™œë°œí•œ í‘œì •, ì—ë„ˆì§€ ë„˜ì¹˜ëŠ” ëª¨ìŠµ",
        poses: {
          # í† ë¼ì˜ ì‹¤ì œ ê¹¡ì´ê¹¡ì´ ë›°ê¸° ì‚¬ì´í´ - 8í”„ë ˆì„
          'hop_cycle_1' => "ì í”„ ì¤€ë¹„: ë’·ë‹¤ë¦¬ë¥¼ ê¹Šê²Œ êµ¬ë¶€ë¦¬ê³  ì•ë‹¤ë¦¬ë¥¼ ë°”ë‹¥ì— ëŒ„ ì±„ ëª¸ì„ ë‚®ì¶¤",
          'hop_cycle_2' => "ì í”„ ì‹œì‘: ë’·ë‹¤ë¦¬ë¡œ ê°•í•˜ê²Œ ë°€ì–´ ì˜¬ë¦¬ë©° ëª¸ì´ ì§€ë©´ì—ì„œ ë–¨ì–´ì§€ê¸° ì‹œì‘",
          'hop_cycle_3' => "ê³µì¤‘ ìƒìŠ¹: ëª¨ë“  ë‹¤ë¦¬ê°€ ëª¸ ì•„ë˜ë¡œ ëª¨ì—¬ìˆê³  ê·€ê°€ ë’¤ë¡œ ë‚ ë¦¼",
          'hop_cycle_4' => "ìµœê³ ì : ëª¸ì´ ê°€ì¥ ë†’ì´ ì˜¬ë¼ê°„ ìƒíƒœ, ë‹¤ë¦¬ê°€ ìì—°ìŠ¤ëŸ½ê²Œ í¼ì³ì§",
          'hop_cycle_5' => "í•˜ê°• ì‹œì‘: ì¤‘ë ¥ì— ì˜í•´ ë‚´ë ¤ì˜¤ê¸° ì‹œì‘, ì•ë‹¤ë¦¬ê°€ ì°©ì§€ ì¤€ë¹„",
          'hop_cycle_6' => "ì°©ì§€ ì¤€ë¹„: ì•ë‹¤ë¦¬ê°€ ë¨¼ì € ì§€ë©´ì— ë‹¿ì„ ì¤€ë¹„, ë’·ë‹¤ë¦¬ëŠ” ì•„ì§ ê³µì¤‘",
          'hop_cycle_7' => "ì°©ì§€ ì™„ë£Œ: ì•ë‹¤ë¦¬ê°€ ì§€ë©´ì— ë‹¿ê³  ë’·ë‹¤ë¦¬ê°€ ë”°ë¼ì„œ ì°©ì§€",
          'hop_cycle_8' => "ì°©ì§€ ì•ˆì •í™”: ëª¨ë“  ë‹¤ë¦¬ê°€ ì§€ë©´ì— ì•ˆì •ì ìœ¼ë¡œ ë‹¿ì€ ìƒíƒœ, ë‹¤ìŒ ì í”„ ì¤€ë¹„",
          
          # í† ë¼ì˜ ë°©í–¥ ì „í™˜ - ì˜†ëª¨ìŠµì—ì„œ ì •ë©´ìœ¼ë¡œ (ê·€ì˜ ì›€ì§ì„ í¬í•¨)
          'rabbit_turn_1' => "ì™„ì „í•œ ì˜†ëª¨ìŠµ, ê¸´ ê·€ê°€ ì¸¡ë©´ìœ¼ë¡œ ë³´ì„",
          'rabbit_turn_2' => "15ë„ íšŒì „, ê·€ í•˜ë‚˜ê°€ ì•½ê°„ ì•ìª½ìœ¼ë¡œ í–¥í•¨",
          'rabbit_turn_3' => "30ë„ íšŒì „, ê·€ì˜ ê°ë„ê°€ ë³€í•˜ë©° í•œìª½ ëˆˆì´ ë³´ì´ê¸° ì‹œì‘",
          'rabbit_turn_4' => "45ë„ íšŒì „, ë°˜ì¸¡ë©´ì—ì„œ ê·€ê°€ Vì ëª¨ì–‘ì„ ë§Œë“¦",
          'rabbit_turn_5' => "60ë„ íšŒì „, ì–¼êµ´ì´ ë§ì´ ë³´ì´ë©° ì–‘ìª½ ê·€ì˜ ê°ë„ ì°¨ì´",
          'rabbit_turn_6' => "75ë„ íšŒì „, ê±°ì˜ ì •ë©´ì— ê°€ê¹Œì›Œì§",
          'rabbit_turn_7' => "90ë„ ì™„ì„±, ì™„ì „í•œ ì •ë©´ì—ì„œ ì–‘ìª½ ê·€ê°€ ëŒ€ì¹­ì ìœ¼ë¡œ ë³´ì„",
          
          # í† ë¼ì˜ í¥ë¶„ í‘œí˜„ - ì‹¤ì œ ê·€ì™€ ê¼¬ë¦¬ ì›€ì§ì„
          'excited_start' => "í‰ë²”í•œ ìì„¸, ê·€ê°€ ìì—°ìŠ¤ëŸ½ê²Œ ì„œìˆìŒ",
          'excited_ears_up' => "í¥ë¶„í•˜ì—¬ ê·€ê°€ ì«‘ê¸‹ ì™„ì „íˆ ì„¸ì›Œì§„ ìƒíƒœ",
          'excited_bounce_prep' => "ì‘ì€ ì í”„ ì¤€ë¹„, ëª¸ì„ ì‚´ì§ ë‚®ì¶”ë©° ì—ë„ˆì§€ ì¶©ì „",
          'excited_small_hop' => "ì‘ì€ í¥ë¶„ ì í”„, ë„¤ ë‹¤ë¦¬ê°€ ëª¨ë‘ ì§€ë©´ì—ì„œ ì‚´ì§ ë–¨ì–´ì§",
          'excited_point_gesture' => "ì•ë‹¤ë¦¬ í•˜ë‚˜ë¥¼ ë“¤ì–´ ê°€ë¦¬í‚¤ëŠ” ì œìŠ¤ì²˜, ê·€ê°€ ì•ìª½ìœ¼ë¡œ í–¥í•¨",
          'excited_tail_twitch' => "ê¼¬ë¦¬ê°€ í¥ë¶„ìœ¼ë¡œ íŒŒë¥´ë¥´ ë–¨ë¦¬ëŠ” ëª¨ìŠµ, ì˜¨ëª¸ìœ¼ë¡œ ê¸°ì¨ í‘œí˜„",
          
          # ìŠ¬ë¼ì´ë“œ 2
          'eager_approach' => "ì—´ì‹¬íˆ ë‹¤ê°€ì˜¤ëŠ” ëª¨ìŠµ, ë¹ ë¥¸ ê±¸ìŒìœ¼ë¡œ ì—ë„ˆì§€ ë„˜ì¹˜ê²Œ",
          'hand_raise_1' => "ì†ì„ ë“¤ê¸° ì‹œì‘í•˜ëŠ” ëª¨ìŠµ, ì ê·¹ì ìœ¼ë¡œ ì°¸ì—¬í•˜ë ¤ëŠ” ìì„¸",
          'hand_raise_2' => "ì†ì„ ë†’ì´ ë“  ëª¨ìŠµ, ì—´ì •ì ìœ¼ë¡œ ë°œí‘œí•˜ê³  ì‹¶ì–´í•˜ëŠ” í‘œì •",
          'enthusiastic_front' => "ì—´ì •ì ì¸ ì •ë©´ ëª¨ìŠµ, ëˆˆì„ ë°˜ì§ì´ë©° ê¸°ëŒ€í•˜ëŠ” í‘œì •",
          
          # ìŠ¬ë¼ì´ë“œ 3
          'victory_jump_1' => "ìŠ¹ë¦¬ì˜ ì í”„ ì¤€ë¹„, ê¸°ì¨ì„ í‘œí˜„í•˜ë©° ë›¸ ì¤€ë¹„",
          'victory_jump_2' => "ìŠ¹ë¦¬ì˜ ì í”„ ìµœê³ ì , ì–‘íŒ”ì„ ë²Œë¦¬ë©° ìµœê³ ë¡œ ë†’ì´ ë›°ê¸°",
          'victory_jump_3' => "ìŠ¹ë¦¬ì˜ ì í”„ ì°©ì§€, ê¸°ì¨ì„ ìœ ì§€í•˜ë©° ë¶€ë“œëŸ½ê²Œ ì°©ì§€",
          'dance_1' => "ì¶¤ ë™ì‘ 1, ì™¼ìª½ìœ¼ë¡œ ëª¸ì„ ê¸°ìš¸ì´ë©° ë¦¬ë“¬ê° ìˆê²Œ",
          'dance_2' => "ì¶¤ ë™ì‘ 2, ì˜¤ë¥¸ìª½ìœ¼ë¡œ ëª¸ì„ ê¸°ìš¸ì´ë©° ë¦¬ë“¬ê° ìˆê²Œ", 
          'celebration_spin' => "ì¶•í•˜í•˜ë©° ëŒê¸°, ë¹™ê¸€ë¹™ê¸€ ëŒë©° ê¸°ë»í•˜ëŠ” ëª¨ìŠµ"
        }
      }
    }

    # ê° ìºë¦­í„°ë³„ë¡œ í¬ì¦ˆ ì´ë¯¸ì§€ ìƒì„±
    character_poses.each do |character_name, character_data|
      puts "\nğŸ­ #{character_name.upcase} ìºë¦­í„° í¬ì¦ˆ ìƒì„± ì‹œì‘..."
      
      # ë””ë ‰í† ë¦¬ ìƒì„±
      poses_dir = Rails.root.join('public', 'images', character_name, 'poses')
      FileUtils.mkdir_p(poses_dir)
      
      character_data[:poses].each do |pose_name, pose_description|
        puts "  ğŸ“¸ #{pose_name} í¬ì¦ˆ ìƒì„± ì¤‘..."
        
        # ì´ë¯¸ì§€ íŒŒì¼ ê²½ë¡œ
        image_path = poses_dir.join("#{pose_name}.png")
        
        # ì´ë¯¸ íŒŒì¼ì´ ì¡´ì¬í•˜ë©´ ìŠ¤í‚µ
        if File.exist?(image_path)
          puts "    â­ï¸  ì´ë¯¸ ì¡´ì¬í•¨: #{pose_name}"
          next
        end
        
        # í”„ë¡¬í”„íŠ¸ ìƒì„±
        prompt = build_character_prompt(character_data[:base_description], pose_description)
        
        # Vertex AIë¡œ ì´ë¯¸ì§€ ìƒì„±
        begin
          image_data = generate_image_with_vertex_ai(prompt, api_key)
          
          if image_data
            # ì´ë¯¸ì§€ ì €ì¥
            File.open(image_path, 'wb') do |file|
              file.write(Base64.decode64(image_data))
            end
            puts "    âœ… ìƒì„± ì™„ë£Œ: #{pose_name}"
            
            # API í˜¸ì¶œ ì œí•œì„ ìœ„í•œ ëŒ€ê¸°
            sleep(2)
          else
            puts "    âŒ ìƒì„± ì‹¤íŒ¨: #{pose_name}"
          end
          
        rescue => e
          puts "    âŒ ì˜¤ë¥˜ ë°œìƒ: #{pose_name} - #{e.message}"
          next
        end
      end
    end
    
    puts "\nğŸ‰ ëª¨ë“  ìºë¦­í„° í¬ì¦ˆ ìƒì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!"
    puts "ğŸ“ ìƒì„±ëœ ì´ë¯¸ì§€ëŠ” public/images/[ìºë¦­í„°ëª…]/poses/ í´ë”ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤."
  end

  private

  def build_character_prompt(base_description, pose_description)
    "Educational illustration of #{base_description}, #{pose_description}, 3D cartoon style similar to Pixar animation, isolated on transparent background, high-quality character design for children's educational platform, friendly and approachable appearance, professional illustration quality"
  end

  def generate_image_with_vertex_ai(prompt, api_key)
    uri = URI('https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-001:generateImage')
    
    http = Net::HTTP.new(uri.host, uri.port)
    http.use_ssl = true
    http.read_timeout = 60
    
    request = Net::HTTP::Post.new(uri)
    request['Content-Type'] = 'application/json'
    request['x-goog-api-key'] = api_key
    
    request.body = {
      prompt: prompt,
      config: {
        aspectRatio: "1:1",
        safetyFilterLevel: "block_some",
        personGeneration: "allow_adult"
      }
    }.to_json
    
    response = http.request(request)
    
    if response.code == '200'
      result = JSON.parse(response.body)
      if result['image'] && result['image']['data']
        return result['image']['data']
      end
    else
      puts "    âš ï¸  API ì˜¤ë¥˜: #{response.code} - #{response.body}"
    end
    
    nil
  rescue => e
    puts "    âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: #{e.message}"
    nil
  end
end
