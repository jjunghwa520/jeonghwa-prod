<div class="container-fluid py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1>ğŸ›ï¸ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>
      <p class="text-muted mb-0">
        <i class="bi bi-clock"></i> <%= Time.current.strftime('%Yë…„ %mì›” %dì¼ %H:%M') %>
        <span class="ms-3">
          <i class="bi bi-person-badge"></i> <%= current_user.name %>
        </span>
      </p>
    </div>
    <div>
      <%= link_to 'ğŸ  ì‚¬ì´íŠ¸ë¡œ ì´ë™', root_path, class: 'btn btn-outline-primary', target: '_blank' %>
    </div>
  </div>
  
  <!-- ë¹ ë¥¸ ì‘ì—… ì¹´ë“œ -->
  <div class="row g-3 mb-4">
    <div class="col-md-3">
      <%= link_to new_admin_course_path, class: 'text-decoration-none' do %>
        <div class="card border-primary quick-action-card">
          <div class="card-body text-center">
            <div class="icon-lg mb-2">ğŸ“š</div>
            <h5>ì‹ ê·œ ì½˜í…ì¸  ë“±ë¡</h5>
            <p class="text-muted mb-0">ì „ìë™í™”ì±… / êµ¬ì—°ë™í™”</p>
          </div>
        </div>
      <% end %>
    </div>
    <div class="col-md-3">
      <%= link_to admin_content_generator_index_path, class: 'text-decoration-none' do %>
        <div class="card border-success quick-action-card">
          <div class="card-body text-center">
            <div class="icon-lg mb-2">ğŸ¨</div>
            <h5>AI ì½˜í…ì¸  ìƒì„±</h5>
            <p class="text-muted mb-0">ì¸ë„¤ì¼ / ì´ë¯¸ì§€ ìë™ ìƒì„±</p>
          </div>
        </div>
      <% end %>
    </div>
    <div class="col-md-3">
      <%= link_to admin_courses_path, class: 'text-decoration-none' do %>
        <div class="card border-info quick-action-card">
          <div class="card-body text-center">
            <div class="icon-lg mb-2">ğŸ“</div>
            <h5>ì½”ìŠ¤ ê´€ë¦¬</h5>
            <p class="text-muted mb-0">ìˆ˜ì • / ì‚­ì œ / ìƒíƒœ ë³€ê²½</p>
          </div>
        </div>
      <% end %>
    </div>
    <div class="col-md-3">
      <%= link_to admin_authors_path, class: 'text-decoration-none' do %>
        <div class="card border-warning quick-action-card">
          <div class="card-body text-center">
            <div class="icon-lg mb-2">ğŸ‘¥</div>
            <h5>ì‘ê°€ ê´€ë¦¬</h5>
            <p class="text-muted mb-0">ì‘ê°€ / ì„±ìš° / ì¼ëŸ¬ìŠ¤íŠ¸ë ˆì´í„°</p>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <!-- ì£¼ìš” í†µê³„ -->
  <div class="row g-3 mb-4">
    <div class="col-md-3">
      <div class="card stat-card bg-primary text-white">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="mb-1">ì „ì²´ ì½”ìŠ¤</h6>
              <h2 class="mb-0"><%= @courses_count %></h2>
            </div>
            <div class="stat-icon">ğŸ“š</div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card stat-card bg-success text-white">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="mb-1">ê°€ì… íšŒì›</h6>
              <h2 class="mb-0"><%= @users_count %></h2>
            </div>
            <div class="stat-icon">ğŸ‘¥</div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card stat-card bg-info text-white">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="mb-1">ìˆ˜ê°• ë“±ë¡</h6>
              <h2 class="mb-0"><%= @enrollments_count %></h2>
            </div>
            <div class="stat-icon">ğŸ“–</div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card stat-card bg-warning text-dark">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="mb-1">ì‘ì„± ë¦¬ë·°</h6>
              <h2 class="mb-0"><%= @reviews_count %></h2>
            </div>
            <div class="stat-icon">â­</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ì½˜í…ì¸  í˜„í™© -->
  <div class="row g-3 mb-4">
    <!-- ì „ìë™í™”ì±… í˜„í™© -->
    <div class="col-lg-6">
      <div class="card h-100">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
          <h5 class="mb-0">ğŸ“š ì „ìë™í™”ì±… í˜„í™©</h5>
          <%= link_to 'ì „ì²´ë³´ê¸°', admin_courses_path(category: 'ì „ìë™í™”ì±…'), class: 'btn btn-sm btn-light' %>
        </div>
        <div class="card-body">
          <!-- ì§„í–‰ë¥  ë°” -->
          <% complete_percentage = (@content_stats[:ebook_complete].to_f / @content_stats[:ebook_total] * 100).round %>
          <div class="mb-3">
            <div class="d-flex justify-content-between mb-1">
              <span>ì™„ì„±ë„</span>
              <span><strong><%= complete_percentage %>%</strong></span>
            </div>
            <div class="progress" style="height: 20px;">
              <div class="progress-bar bg-success" style="width: <%= complete_percentage %>%">
                <%= @content_stats[:ebook_complete] %>/<%= @content_stats[:ebook_total] %>
              </div>
            </div>
          </div>

          <!-- ìƒì„¸ í†µê³„ -->
          <div class="row text-center">
            <div class="col-4">
              <div class="stat-box">
                <h3 class="text-success"><%= @content_stats[:ebook_complete] %></h3>
                <p class="text-muted mb-0">âœ… ì™„ì„±</p>
              </div>
            </div>
            <div class="col-4">
              <div class="stat-box">
                <h3 class="text-warning"><%= @content_stats[:ebook_partial] %></h3>
                <p class="text-muted mb-0">âš ï¸ ë¶€ë¶„</p>
              </div>
            </div>
            <div class="col-4">
              <div class="stat-box">
                <h3 class="text-danger"><%= @content_stats[:ebook_missing] %></h3>
                <p class="text-muted mb-0">âŒ ì—†ìŒ</p>
              </div>
            </div>
          </div>

          <!-- ì•¡ì…˜ ë²„íŠ¼ -->
          <div class="mt-3">
            <%= link_to 'ğŸ¨ AIë¡œ ìƒì„±í•˜ê¸°', admin_content_generator_index_path, class: 'btn btn-success w-100' %>
          </div>
        </div>
      </div>
    </div>
    
    <!-- êµ¬ì—°ë™í™” í˜„í™© -->
    <div class="col-lg-6">
      <div class="card h-100">
        <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
          <h5 class="mb-0">ğŸ¬ êµ¬ì—°ë™í™” í˜„í™©</h5>
          <%= link_to 'ì „ì²´ë³´ê¸°', admin_courses_path(category: 'êµ¬ì—°ë™í™”'), class: 'btn btn-sm btn-light' %>
        </div>
        <div class="card-body">
          <!-- ì§„í–‰ë¥  ë°” -->
          <% video_percentage = (@content_stats[:video_complete].to_f / @content_stats[:video_total] * 100).round %>
          <div class="mb-3">
            <div class="d-flex justify-content-between mb-1">
              <span>ì™„ì„±ë„</span>
              <span><strong><%= video_percentage %>%</strong></span>
            </div>
            <div class="progress" style="height: 20px;">
              <div class="progress-bar bg-info" style="width: <%= video_percentage %>%">
                <%= @content_stats[:video_complete] %>/<%= @content_stats[:video_total] %>
              </div>
            </div>
          </div>

          <!-- ìƒì„¸ í†µê³„ -->
          <div class="row text-center">
            <div class="col-6">
              <div class="stat-box">
                <h3 class="text-success"><%= @content_stats[:video_complete] %></h3>
                <p class="text-muted mb-0">âœ… ë¹„ë””ì˜¤ ìˆìŒ</p>
              </div>
            </div>
            <div class="col-6">
              <div class="stat-box">
                <h3 class="text-danger"><%= @content_stats[:video_missing] %></h3>
                <p class="text-muted mb-0">âŒ ë¹„ë””ì˜¤ ì—†ìŒ</p>
              </div>
            </div>
          </div>

          <!-- ì•¡ì…˜ ë²„íŠ¼ -->
          <div class="mt-3">
            <%= link_to 'ğŸ“¤ ì—…ë¡œë“œí•˜ê¸°', new_admin_upload_path, class: 'btn btn-primary w-100' %>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ì¸ê¸° ì½”ìŠ¤ & ìµœê·¼ í™œë™ -->
  <div class="row g-3 mb-4">
    <!-- ì¸ê¸° ì½”ìŠ¤ -->
    <div class="col-lg-6">
      <div class="card">
        <div class="card-header bg-light">
          <h5 class="mb-0">ğŸ”¥ ì¸ê¸° ì½”ìŠ¤ Top 5</h5>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover mb-0">
              <thead class="table-light">
                <tr>
                  <th width="50">ìˆœìœ„</th>
                  <th>ì œëª©</th>
                  <th width="100">ì¹´í…Œê³ ë¦¬</th>
                  <th width="80" class="text-end">ìˆ˜ê°•ìƒ</th>
                </tr>
              </thead>
              <tbody>
                <% @popular_courses.each_with_index do |course, idx| %>
                  <tr>
                    <td class="text-center">
                      <% medal = idx == 0 ? 'ğŸ¥‡' : idx == 1 ? 'ğŸ¥ˆ' : idx == 2 ? 'ğŸ¥‰' : (idx + 1).to_s %>
                      <%= medal %>
                    </td>
                    <td>
                      <%= link_to course.title, admin_course_path(course), class: 'text-decoration-none' %>
                    </td>
                    <td>
                      <span class="badge bg-secondary"><%= course.category %></span>
                    </td>
                    <td class="text-end">
                      <strong><%= course.enrollment_count %></strong>ëª…
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- ìµœê·¼ í™œë™ -->
    <div class="col-lg-6">
      <div class="card">
        <div class="card-header bg-light">
          <h5 class="mb-0">ğŸ“Š ìµœê·¼ í™œë™</h5>
        </div>
        <div class="card-body">
          <ul class="nav nav-tabs mb-3" role="tablist">
            <li class="nav-item">
              <a class="nav-link active" data-bs-toggle="tab" href="#recent-enrollments">ìˆ˜ê°• ë“±ë¡</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" data-bs-toggle="tab" href="#recent-reviews">ë¦¬ë·°</a>
            </li>
          </ul>

          <div class="tab-content">
            <!-- ìµœê·¼ ìˆ˜ê°• ë“±ë¡ -->
            <div class="tab-pane fade show active" id="recent-enrollments">
              <div class="activity-list">
                <% @recent_enrollments.each do |enrollment| %>
                  <div class="activity-item">
                    <div class="activity-time">
                      <%= enrollment.created_at.strftime('%m/%d %H:%M') %>
                    </div>
                    <div class="activity-content">
                      <strong><%= enrollment.user.name %></strong>ë‹˜ì´
                      <span class="text-primary"><%= enrollment.course.title %></span>ì„(ë¥¼) ìˆ˜ê°• ë“±ë¡í–ˆìŠµë‹ˆë‹¤
                    </div>
                  </div>
                <% end %>
              </div>
            </div>

            <!-- ìµœê·¼ ë¦¬ë·° -->
            <div class="tab-pane fade" id="recent-reviews">
              <div class="activity-list">
                <% @recent_reviews.each do |review| %>
                  <div class="activity-item">
                    <div class="activity-time">
                      <%= review.created_at.strftime('%m/%d %H:%M') %>
                    </div>
                    <div class="activity-content">
                      <strong><%= review.user.name %></strong>
                      <span class="text-warning"><%= 'â­' * review.rating %></span>
                      <br>
                      <small class="text-muted"><%= review.content.truncate(50) %></small>
                    </div>
                  </div>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ì¶”ê°€ ê´€ë¦¬ ë©”ë‰´ -->
  <div class="row g-3">
    <div class="col-md-4">
      <div class="card">
        <div class="card-header">
          <h6 class="mb-0">ğŸ’¬ ë¦¬ë·° ê´€ë¦¬</h6>
        </div>
        <div class="card-body">
          <p class="text-muted mb-3">ì‚¬ìš©ì ë¦¬ë·°ë¥¼ ê´€ë¦¬í•˜ê³  ë¶€ì ì ˆí•œ ë‚´ìš©ì„ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
          <%= link_to 'ë¦¬ë·° ê´€ë¦¬', admin_reviews_path, class: 'btn btn-outline-primary w-100' %>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card">
        <div class="card-header">
          <h6 class="mb-0">ğŸ‘¥ ì‚¬ìš©ì ê´€ë¦¬</h6>
        </div>
        <div class="card-body">
          <p class="text-muted mb-3">íšŒì› ì •ë³´ë¥¼ í™•ì¸í•˜ê³  ê¶Œí•œì„ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
          <%= link_to 'ì‚¬ìš©ì ê´€ë¦¬', admin_users_path, class: 'btn btn-outline-success w-100' %>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card">
        <div class="card-header">
          <h6 class="mb-0">ğŸ“¤ íŒŒì¼ ì—…ë¡œë“œ</h6>
        </div>
        <div class="card-body">
          <p class="text-muted mb-3">ê¸°ì¡´ ë°©ì‹ìœ¼ë¡œ íŒŒì¼ì„ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
          <%= link_to 'íŒŒì¼ ì—…ë¡œë“œ', new_admin_upload_path, class: 'btn btn-outline-secondary w-100' %>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.quick-action-card {
  transition: all 0.3s;
  cursor: pointer;
}

.quick-action-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.icon-lg {
  font-size: 3rem;
}

.stat-card {
  transition: transform 0.2s;
}

.stat-card:hover {
  transform: scale(1.05);
}

.stat-icon {
  font-size: 3rem;
  opacity: 0.5;
}

.stat-box {
  padding: 1rem;
  border-radius: 0.5rem;
  background-color: #f8f9fa;
}

.stat-box h3 {
  margin-bottom: 0.5rem;
}

.activity-list {
  max-height: 300px;
  overflow-y: auto;
}

.activity-item {
  padding: 0.75rem;
  border-left: 3px solid #0d6efd;
  margin-bottom: 0.75rem;
  background-color: #f8f9fa;
  border-radius: 0.25rem;
}

.activity-time {
  font-size: 0.75rem;
  color: #6c757d;
  margin-bottom: 0.25rem;
}

.activity-content {
  font-size: 0.9rem;
}

/* ë°˜ì‘í˜• */
@media (max-width: 768px) {
  .quick-action-card h5 {
    font-size: 1rem;
  }
  
  .icon-lg {
    font-size: 2rem;
  }
  
  .stat-icon {
    font-size: 2rem;
  }
}
</style>
