<div class="container-fluid py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1>ğŸ“ ì½”ìŠ¤ ìˆ˜ì •</h1>
      <h4 class="text-muted"><%= @course.title %></h4>
    </div>
    <div class="d-flex gap-2">
      <%= link_to "â† ëª©ë¡", admin_courses_path, class: "btn btn-outline-secondary" %>
      <%= link_to "ğŸ‘ï¸ ë¯¸ë¦¬ë³´ê¸°", course_path(@course), class: "btn btn-info", target: "_blank" %>
      <%= link_to "ğŸ“ ìƒì„¸ë³´ê¸°", admin_course_path(@course), class: "btn btn-outline-primary" %>
    </div>
  </div>

  <!-- ì½˜í…ì¸  í˜„í™© -->
  <div class="row mb-4">
    <div class="col-md-6">
      <div class="card">
        <div class="card-header bg-primary text-white">
          <h6 class="mb-0">ğŸ“Š ì½˜í…ì¸  í˜„í™©</h6>
        </div>
        <div class="card-body">
          <% if @course.category.to_s.match?(/ì „ìë™í™”ì±…|ebook|ë™í™”ì±…/) %>
            <p class="mb-2">
              <strong>í˜ì´ì§€ ì´ë¯¸ì§€:</strong> 
              <span class="badge bg-<%= @content_status[:page_count] >= 10 ? 'success' : 'warning' %>">
                <%= @content_status[:page_count] %>ê°œ
              </span>
            </p>
            <p class="mb-0">
              <strong>ìº¡ì…˜:</strong>
              <span class="badge bg-<%= @content_status[:caption_count] >= 10 ? 'success' : 'secondary' %>">
                <%= @content_status[:caption_count] %>ê°œ
              </span>
            </p>
          <% else %>
            <p class="mb-0">
              <strong>ë¹„ë””ì˜¤:</strong>
              <span class="badge bg-<%= @content_status[:has_video] ? 'success' : 'danger' %>">
                <%= @content_status[:has_video] ? 'ìˆìŒ' : 'ì—†ìŒ' %>
              </span>
            </p>
          <% end %>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card">
        <div class="card-header bg-info text-white">
          <h6 class="mb-0">â„¹ï¸ ì½”ìŠ¤ ì •ë³´</h6>
        </div>
        <div class="card-body">
          <p class="mb-1"><strong>ID:</strong> <%= @course.id %></p>
          <p class="mb-1"><strong>ì¹´í…Œê³ ë¦¬:</strong> <%= @course.category %></p>
          <p class="mb-1"><strong>ìƒíƒœ:</strong> <%= @course.status %></p>
          <p class="mb-0"><strong>ë“±ë¡ì¼:</strong> <%= @course.created_at.strftime('%Y-%m-%d') %></p>
        </div>
      </div>
    </div>
  </div>

  <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
  <ul class="nav nav-tabs mb-4" role="tablist">
    <li class="nav-item">
      <a class="nav-link active" data-bs-toggle="tab" href="#basic-info">ê¸°ë³¸ ì •ë³´</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" data-bs-toggle="tab" href="#files">íŒŒì¼ ê´€ë¦¬</a>
    </li>
  </ul>

  <div class="tab-content">
    <!-- ê¸°ë³¸ ì •ë³´ íƒ­ -->
    <div class="tab-pane fade show active" id="basic-info">
      <%= form_with model: [:admin, @course], html: { class: 'needs-validation' } do |f| %>
        <div class="row g-3">
          <!-- ì œëª© & ë¶€ì œëª© -->
          <div class="col-md-8">
            <%= f.label :title, 'ì œëª© *', class: 'form-label' %>
            <%= f.text_field :title, class: 'form-control', required: true %>
          </div>
          <div class="col-md-4">
            <%= f.label :subtitle, 'ë¶€ì œëª©', class: 'form-label' %>
            <%= f.text_field :subtitle, class: 'form-control' %>
          </div>

          <!-- ì‹œë¦¬ì¦ˆ -->
          <div class="col-md-8">
            <%= f.label :series_name, 'ì‹œë¦¬ì¦ˆ', class: 'form-label' %>
            <%= f.text_field :series_name, class: 'form-control', list: 'series-list' %>
            <datalist id="series-list">
              <% Course.distinct.pluck(:series_name).compact.each do |series| %>
                <option value="<%= series %>">
              <% end %>
            </datalist>
          </div>
          <div class="col-md-4">
            <%= f.label :series_order, 'ìˆœì„œ', class: 'form-label' %>
            <%= f.number_field :series_order, class: 'form-control', min: 1 %>
          </div>

          <!-- ì¹´í…Œê³ ë¦¬ & ì—°ë ¹ -->
          <div class="col-md-4">
            <%= f.label :category, 'ì¹´í…Œê³ ë¦¬ *', class: 'form-label' %>
            <%= f.select :category,
              options_for_select([
                ['ì „ë˜ë™í™”', 'ì „ë˜ë™í™”'],
                ['ëª…ì‘ë™í™”', 'ëª…ì‘ë™í™”'],
                ['ì°½ì‘ë™í™”', 'ì°½ì‘ë™í™”'],
                ['ì „ìë™í™”ì±…', 'ì „ìë™í™”ì±…'],
                ['êµ¬ì—°ë™í™”', 'êµ¬ì—°ë™í™”'],
                ['êµìœ¡ìë£Œ', 'êµìœ¡ìë£Œ']
              ], @course.category),
              {},
              class: 'form-select',
              required: true
            %>
          </div>
          <div class="col-md-4">
            <%= f.label :age, 'ì—°ë ¹ *', class: 'form-label' %>
            <%= f.select :age,
              options_for_select([
                ['ì•„ê¸° (0-2ì„¸)', 'baby'],
                ['ìœ ì•„ (3-5ì„¸)', 'toddler'],
                ['ì´ˆë“± (6-13ì„¸)', 'elementary'],
                ['ì²­ì†Œë…„ (14-16ì„¸)', 'teen']
              ], @course.age),
              {},
              class: 'form-select',
              required: true
            %>
          </div>
          <div class="col-md-4">
            <%= f.label :difficulty, 'ë‚œì´ë„', class: 'form-label' %>
            <div class="difficulty-selector">
              <% (1..5).each do |level| %>
                <%= f.radio_button :difficulty, level, id: "difficulty_#{level}", checked: (@course.difficulty == level) %>
                <label for="difficulty_<%= level %>">â­</label>
              <% end %>
            </div>
          </div>

          <!-- ê°€ê²© & í• ì¸ -->
          <div class="col-md-4">
            <%= f.label :price, 'ê°€ê²© (ì›) *', class: 'form-label' %>
            <%= f.number_field :price, class: 'form-control', step: '100', required: true %>
          </div>
          <div class="col-md-4">
            <%= f.label :discount_percentage, 'í• ì¸ìœ¨ (%)', class: 'form-label' %>
            <%= f.number_field :discount_percentage, class: 'form-control', min: 0, max: 100 %>
          </div>
          <div class="col-md-4">
            <%= f.label :level, 'ë ˆë²¨ *', class: 'form-label' %>
            <%= f.select :level,
              options_for_select([
                ['ì´ˆê¸‰', 'beginner'],
                ['ì¤‘ê¸‰', 'intermediate'],
                ['ê³ ê¸‰', 'advanced']
              ], @course.level),
              {},
              class: 'form-select',
              required: true
            %>
          </div>

          <!-- ì†Œìš”ì‹œê°„ & ì œì‘ì¼ -->
          <div class="col-md-6">
            <%= f.label :duration, 'ì†Œìš”ì‹œê°„ (ë¶„) *', class: 'form-label' %>
            <%= f.number_field :duration, class: 'form-control', required: true %>
          </div>
          <div class="col-md-6">
            <%= f.label :production_date, 'ì œì‘ì¼', class: 'form-label' %>
            <%= f.date_field :production_date, class: 'form-control' %>
          </div>

          <!-- íƒœê·¸ -->
          <div class="col-12">
            <%= f.label :tags, 'íƒœê·¸', class: 'form-label' %>
            <%= f.text_field :tags, class: 'form-control', placeholder: '#ë™ë¬¼, #ìš°ì •, #êµí›ˆ' %>
            <small class="form-text text-muted">ì‰¼í‘œë¡œ êµ¬ë¶„</small>
          </div>

          <!-- ì„¤ëª… -->
          <div class="col-12">
            <%= f.label :description, 'ì„¤ëª… *', class: 'form-label' %>
            <%= f.text_area :description, rows: 5, class: 'form-control', required: true %>
          </div>

          <!-- ì œì‘ì§„ -->
          <div class="col-12">
            <h5 class="mt-3">ğŸ‘¥ ì œì‘ì§„</h5>
          </div>
          <div class="col-md-4">
            <label class="form-label">ì‘ê°€</label>
            <%= select_tag 'course[writer_id]',
              options_from_collection_for_select(@authors.writers, :id, :name, @course.writer&.id),
              { include_blank: 'ì„ íƒí•˜ì„¸ìš”', class: 'form-select' }
            %>
          </div>
          <div class="col-md-4">
            <label class="form-label">ì¼ëŸ¬ìŠ¤íŠ¸ë ˆì´í„°</label>
            <%= select_tag 'course[illustrator_id]',
              options_from_collection_for_select(@authors.illustrators, :id, :name, @course.illustrator&.id),
              { include_blank: 'ì„ íƒí•˜ì„¸ìš”', class: 'form-select' }
            %>
          </div>
          <div class="col-md-4">
            <label class="form-label">ì„±ìš°</label>
            <%= select_tag 'course[narrator_id]',
              options_from_collection_for_select(@authors.narrators, :id, :name, @course.narrator&.id),
              { include_blank: 'ì„ íƒí•˜ì„¸ìš”', class: 'form-select' }
            %>
          </div>

          <!-- ì¸ë„¤ì¼ & ìƒíƒœ -->
          <div class="col-md-8">
            <%= f.label :thumbnail, 'ì¸ë„¤ì¼ URL', class: 'form-label' %>
            <%= f.url_field :thumbnail, class: 'form-control' %>
          </div>
          <div class="col-md-4">
            <%= f.label :status, 'ìƒíƒœ', class: 'form-label' %>
            <%= f.select :status,
              options_for_select([
                ['ë°œí–‰ë¨', 'published'],
                ['ì„ì‹œì €ì¥', 'draft'],
                ['ë³´ê´€ë¨', 'archived']
              ], @course.status),
              {},
              class: 'form-select'
            %>
          </div>

          <!-- ì œì¶œ -->
          <div class="col-12 mt-4">
            <%= f.submit "ğŸ’¾ ì €ì¥", class: "btn btn-primary btn-lg" %>
            <%= link_to "ì·¨ì†Œ", admin_course_path(@course), class: "btn btn-outline-secondary btn-lg" %>
          </div>
        </div>
      <% end %>
    </div>

    <!-- íŒŒì¼ ê´€ë¦¬ íƒ­ -->
    <div class="tab-pane fade" id="files">
      <div class="row">
        <!-- ê¸°ì¡´ íŒŒì¼ ëª©ë¡ -->
        <div class="col-md-6">
          <div class="card mb-4">
            <div class="card-header bg-success text-white">
              <h6 class="mb-0">ğŸ“ ê¸°ì¡´ íŒŒì¼</h6>
            </div>
            <div class="card-body">
              <% if @course.category.to_s.match?(/ì „ìë™í™”ì±…|ebook|ë™í™”ì±…/) %>
                <!-- ì´ë¯¸ì§€ íŒŒì¼ -->
                <h6 class="mt-2">í˜ì´ì§€ ì´ë¯¸ì§€ (<%= @existing_files[:images].count %>ê°œ)</h6>
                <div class="list-group mb-3">
                  <% @existing_files[:images].each do |file| %>
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                      <div>
                        <i class="bi bi-file-image"></i>
                        <%= file[:name] %>
                        <small class="text-muted">(<%= number_to_human_size(file[:size]) %>)</small>
                      </div>
                      <button class="btn btn-sm btn-outline-danger" onclick="deleteFile('<%= file[:path] %>')">
                        ğŸ—‘ï¸
                      </button>
                    </div>
                  <% end %>
                </div>

                <!-- ìº¡ì…˜ íŒŒì¼ -->
                <h6 class="mt-3">ìº¡ì…˜ (<%= @existing_files[:captions].count %>ê°œ)</h6>
                <div class="list-group">
                  <% @existing_files[:captions].each do |file| %>
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                      <div>
                        <i class="bi bi-file-text"></i>
                        <%= file[:name] %>
                        <small class="text-muted">(<%= number_to_human_size(file[:size]) %>)</small>
                      </div>
                      <button class="btn btn-sm btn-outline-danger" onclick="deleteFile('<%= file[:path] %>')">
                        ğŸ—‘ï¸
                      </button>
                    </div>
                  <% end %>
                </div>
              <% else %>
                <!-- ë¹„ë””ì˜¤ íŒŒì¼ -->
                <h6>ë¹„ë””ì˜¤ íŒŒì¼ (<%= @existing_files[:videos].count %>ê°œ)</h6>
                <div class="list-group mb-3">
                  <% @existing_files[:videos].each do |file| %>
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                      <div>
                        <i class="bi bi-file-play"></i>
                        <%= file[:name] %>
                        <small class="text-muted">(<%= number_to_human_size(file[:size]) %>)</small>
                      </div>
                      <button class="btn btn-sm btn-outline-danger" onclick="deleteFile('<%= file[:path] %>')">
                        ğŸ—‘ï¸
                      </button>
                    </div>
                  <% end %>
                </div>

                <!-- ìë§‰ íŒŒì¼ -->
                <h6 class="mt-3">ìë§‰ (<%= @existing_files[:subtitles].count %>ê°œ)</h6>
                <div class="list-group">
                  <% @existing_files[:subtitles].each do |file| %>
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                      <div>
                        <i class="bi bi-file-earmark-text"></i>
                        <%= file[:name] %>
                        <small class="text-muted">(<%= number_to_human_size(file[:size]) %>)</small>
                      </div>
                      <button class="btn btn-sm btn-outline-danger" onclick="deleteFile('<%= file[:path] %>')">
                        ğŸ—‘ï¸
                      </button>
                    </div>
                  <% end %>
                </div>
              <% end %>
            </div>
          </div>
        </div>

        <!-- íŒŒì¼ ì¶”ê°€ -->
        <div class="col-md-6">
          <div class="card">
            <div class="card-header bg-primary text-white">
              <h6 class="mb-0">â• íŒŒì¼ ì¶”ê°€</h6>
            </div>
            <div class="card-body">
              <form id="file-upload-form" enctype="multipart/form-data">
                <div class="mb-3">
                  <label class="form-label">íŒŒì¼ ì¢…ë¥˜</label>
                  <select id="content-type-select" class="form-select">
                    <% if @course.category.to_s.match?(/ì „ìë™í™”ì±…|ebook|ë™í™”ì±…/) %>
                      <option value="ebook_images">í˜ì´ì§€ ì´ë¯¸ì§€ (.jpg, .png)</option>
                      <option value="captions">ìº¡ì…˜ (.txt)</option>
                    <% else %>
                      <option value="video">ë¹„ë””ì˜¤ (.mp4, .webm)</option>
                      <option value="subtitle">ìë§‰ (.vtt, .srt)</option>
                      <option value="hls">HLS (.ts, .m3u8)</option>
                    <% end %>
                  </select>
                </div>

                <div class="file-upload-dropzone" id="edit-file-dropzone">
                  <div class="text-center">
                    <i class="bi bi-cloud-upload display-4 text-muted"></i>
                    <p class="mt-3">íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì„ íƒ</p>
                    <input type="file" id="edit-file-input" multiple style="display: none;">
                    <button type="button" class="btn btn-primary" onclick="document.getElementById('edit-file-input').click()">
                      íŒŒì¼ ì„ íƒ
                    </button>
                  </div>
                  <div id="edit-file-list" class="mt-3" style="display: none;"></div>
                </div>

                <button type="button" id="upload-files-btn" class="btn btn-success w-100 mt-3" disabled>
                  ğŸ“¤ ì—…ë¡œë“œ
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// íŒŒì¼ ì‚­ì œ
async function deleteFile(path) {
  if (!confirm('ì´ íŒŒì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

  try {
    const response = await fetch(`/admin/courses/<%= @course.id %>/delete_file`, {
      method: 'DELETE',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').content
      },
      body: JSON.stringify({ file_path: path })
    });

    if (response.ok) {
      alert('íŒŒì¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
      location.reload();
    } else {
      alert('íŒŒì¼ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
    }
  } catch (error) {
    console.error('Error:', error);
    alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
  }
}

// íŒŒì¼ ì—…ë¡œë“œ (ìˆ˜ì • í˜ì´ì§€ìš©)
document.addEventListener('DOMContentLoaded', function() {
  const dropzone = document.getElementById('edit-file-dropzone');
  const fileInput = document.getElementById('edit-file-input');
  const fileList = document.getElementById('edit-file-list');
  const uploadBtn = document.getElementById('upload-files-btn');
  const contentTypeSelect = document.getElementById('content-type-select');
  let selectedFiles = [];

  if (!dropzone) return;

  dropzone.addEventListener('click', function(e) {
    if (e.target.tagName !== 'BUTTON') {
      fileInput.click();
    }
  });

  dropzone.addEventListener('dragover', (e) => {
    e.preventDefault();
    dropzone.classList.add('dragover');
  });

  dropzone.addEventListener('dragleave', () => {
    dropzone.classList.remove('dragover');
  });

  dropzone.addEventListener('drop', (e) => {
    e.preventDefault();
    dropzone.classList.remove('dragover');
    selectedFiles = Array.from(e.dataTransfer.files);
    displayFiles();
  });

  fileInput.addEventListener('change', (e) => {
    selectedFiles = Array.from(e.target.files);
    displayFiles();
  });

  function displayFiles() {
    if (selectedFiles.length === 0) {
      fileList.style.display = 'none';
      uploadBtn.disabled = true;
      return;
    }

    fileList.style.display = 'block';
    fileList.innerHTML = '<h6>ì„ íƒëœ íŒŒì¼:</h6>';
    
    const listGroup = document.createElement('div');
    listGroup.className = 'list-group';
    
    selectedFiles.forEach(file => {
      const item = document.createElement('div');
      item.className = 'list-group-item';
      item.textContent = `${file.name} (${(file.size / 1024).toFixed(1)} KB)`;
      listGroup.appendChild(item);
    });
    
    fileList.appendChild(listGroup);
    uploadBtn.disabled = false;
  }

  uploadBtn.addEventListener('click', async function() {
    const formData = new FormData();
    formData.append('content_type', contentTypeSelect.value);
    selectedFiles.forEach(file => {
      formData.append('files[]', file);
    });

    uploadBtn.disabled = true;
    uploadBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>ì—…ë¡œë“œ ì¤‘...';
    
    // ì§„í–‰ë¥  í‘œì‹œ
    const progressDiv = document.createElement('div');
    progressDiv.className = 'mt-3';
    progressDiv.innerHTML = `
      <div class="progress">
        <div id="upload-progress" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%">0%</div>
      </div>
    `;
    uploadBtn.parentElement.insertBefore(progressDiv, uploadBtn.nextSibling);
    const progressBar = progressDiv.querySelector('#upload-progress');

    try {
      const xhr = new XMLHttpRequest();
      
      // ì§„í–‰ë¥  ëª¨ë‹ˆí„°ë§
      xhr.upload.addEventListener('progress', (e) => {
        if (e.lengthComputable) {
          const percentComplete = (e.loaded / e.total) * 100;
          progressBar.style.width = percentComplete + '%';
          progressBar.textContent = Math.round(percentComplete) + '%';
        }
      });
      
      xhr.addEventListener('load', function() {
        if (xhr.status === 200) {
          showToast('íŒŒì¼ì´ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
          setTimeout(() => location.reload(), 1000);
        } else {
          const data = JSON.parse(xhr.responseText);
          showToast('ì—…ë¡œë“œ ì‹¤íŒ¨: ' + (data.errors || ['ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜']).join(', '), 'error');
        }
      });
      
      xhr.addEventListener('error', function() {
        showToast('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
      });
      
      xhr.open('POST', '/admin/courses/<%= @course.id %>/upload_files');
      xhr.setRequestHeader('X-CSRF-Token', document.querySelector('meta[name="csrf-token"]').content);
      xhr.send(formData);
      
    } catch (error) {
      console.error('Error:', error);
      showToast('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
    } finally {
      setTimeout(() => {
        uploadBtn.disabled = false;
        uploadBtn.textContent = 'ğŸ“¤ ì—…ë¡œë“œ';
        if (progressDiv) progressDiv.remove();
      }, 2000);
    }
  });
  
  // Toast ì•Œë¦¼ ì‹œìŠ¤í…œ
  window.showToast = function(message, type = 'info') {
    const toastContainer = document.getElementById('toast-container') || createToastContainer();
    
    const toast = document.createElement('div');
    toast.className = `toast align-items-center text-white bg-${type === 'success' ? 'success' : type === 'error' ? 'danger' : type === 'warning' ? 'warning' : 'info'} border-0`;
    toast.setAttribute('role', 'alert');
    toast.innerHTML = `
      <div class="d-flex">
        <div class="toast-body">${message}</div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
      </div>
    `;
    
    toastContainer.appendChild(toast);
    const bsToast = new bootstrap.Toast(toast);
    bsToast.show();
    
    setTimeout(() => toast.remove(), 5000);
  };

  function createToastContainer() {
    const container = document.createElement('div');
    container.id = 'toast-container';
    container.className = 'toast-container position-fixed top-0 end-0 p-3';
    container.style.zIndex = '9999';
    document.body.appendChild(container);
    return container;
  }
});
</script>

<style>
.difficulty-selector {
  display: flex;
  gap: 0.5rem;
}

.difficulty-selector input[type="radio"] {
  display: none;
}

.difficulty-selector label {
  font-size: 1.5rem;
  cursor: pointer;
  opacity: 0.3;
}

.difficulty-selector input:checked ~ label,
.difficulty-selector input:checked + label {
  opacity: 1;
}

.file-upload-dropzone {
  border: 2px dashed #dee2e6;
  border-radius: 0.5rem;
  padding: 2rem;
  cursor: pointer;
  transition: all 0.3s;
}

.file-upload-dropzone.dragover {
  border-color: #0d6efd;
  background-color: #e7f1ff;
}

/* ëª¨ë°”ì¼ ë°˜ì‘í˜• */
@media (max-width: 768px) {
  .card-body {
    padding: 1rem;
  }
  
  .difficulty-selector label {
    font-size: 1.2rem;
  }
  
  .form-control, .form-select {
    font-size: 16px !important;
  }
}
</style>

<script>
// ë°ì´í„° ì†ì‹¤ ë°©ì§€
let isDirty = false;
let isSubmitting = false;

document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('input, textarea, select').forEach(el => {
    el.addEventListener('change', () => isDirty = true);
  });
  
  window.addEventListener('beforeunload', (e) => {
    if (isDirty && !isSubmitting) {
      e.preventDefault();
      e.returnValue = 'ìˆ˜ì • ì¤‘ì¸ ë‚´ìš©ì´ ì €ì¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì •ë§ ë‚˜ê°€ì‹œê² ìŠµë‹ˆê¹Œ?';
    }
  });
  
  // í¼ ì œì¶œ ì‹œ
  const form = document.querySelector('form');
  if (form) {
    form.addEventListener('submit', function() {
      isSubmitting = true;
      isDirty = false;
    });
  }
});
</script>
