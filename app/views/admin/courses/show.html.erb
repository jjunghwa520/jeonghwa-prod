<div class="container-fluid py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="mb-1"><%= @course.title %></h1>
      <% if @course.subtitle.present? %>
        <p class="text-muted mb-0"><%= @course.subtitle %></p>
      <% end %>
    </div>
    <div class="d-flex gap-2">
      <%= link_to 'âœï¸ í¸ì§‘', edit_admin_course_path(@course), class: 'btn btn-primary' %>
      <%= link_to 'ğŸ‘ï¸ ë¯¸ë¦¬ë³´ê¸°', course_path(@course), class: 'btn btn-info', target: '_blank' %>
      <%= link_to 'â† ëª©ë¡', admin_courses_path, class: 'btn btn-outline-secondary' %>
    </div>
  </div>

  <!-- ìƒíƒœ ì¹´ë“œ -->
  <div class="row g-3 mb-4">
    <div class="col-md-3">
      <div class="card bg-<%= @course.status == 'published' ? 'success' : @course.status == 'draft' ? 'warning' : 'secondary' %> text-white">
        <div class="card-body">
          <h6>ë°œí–‰ ìƒíƒœ</h6>
          <h3><%= @course.status == 'published' ? 'âœ… ë°œí–‰ë¨' : @course.status == 'draft' ? 'ğŸ“ ì„ì‹œì €ì¥' : 'ğŸ“¦ ë³´ê´€ë¨' %></h3>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-<%= @content_status[:status] == 'complete' ? 'success' : @content_status[:status] == 'partial' ? 'warning' : 'danger' %> text-white">
        <div class="card-body">
          <h6>ì½˜í…ì¸  ìƒíƒœ</h6>
          <h3>
            <% if @course.category.to_s.match?(/ì „ìë™í™”ì±…|ebook|ë™í™”ì±…/) %>
              <%= @content_status[:page_count] %>í˜ì´ì§€
            <% else %>
              <%= @content_status[:has_video] ? 'âœ… ìˆìŒ' : 'âŒ ì—†ìŒ' %>
            <% end %>
          </h3>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-info text-white">
        <div class="card-body">
          <h6>ìˆ˜ê°•ìƒ</h6>
          <h3>ğŸ‘¥ <%= @course.total_students %>ëª…</h3>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-primary text-white">
        <div class="card-body">
          <h6>í‰ì </h6>
          <h3>â­ <%= @course.average_rating %></h3>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-3">
    <!-- ê¸°ë³¸ ì •ë³´ -->
    <div class="col-lg-8">
      <div class="card mb-3">
        <div class="card-header bg-light">
          <h5 class="mb-0">ğŸ“‹ ê¸°ë³¸ ì •ë³´</h5>
        </div>
        <div class="card-body">
          <dl class="row mb-0">
            <dt class="col-sm-3">ì œëª©</dt>
            <dd class="col-sm-9"><strong><%= @course.title %></strong></dd>
            
            <% if @course.subtitle.present? %>
              <dt class="col-sm-3">ë¶€ì œëª©</dt>
              <dd class="col-sm-9"><%= @course.subtitle %></dd>
            <% end %>
            
            <dt class="col-sm-3">ì¹´í…Œê³ ë¦¬</dt>
            <dd class="col-sm-9">
              <span class="badge bg-info"><%= @course.category %></span>
            </dd>
            
            <% if @course.series_name.present? %>
              <dt class="col-sm-3">ì‹œë¦¬ì¦ˆ</dt>
              <dd class="col-sm-9">
                <span class="badge bg-secondary"><%= @course.series_name %> #<%= @course.series_order %></span>
              </dd>
            <% end %>
            
            <dt class="col-sm-3">ì—°ë ¹</dt>
            <dd class="col-sm-9"><%= @course.age %></dd>
            
            <dt class="col-sm-3">ë‚œì´ë„</dt>
            <dd class="col-sm-9">
              <% if @course.difficulty %>
                <%= 'â­' * @course.difficulty.to_i %>
              <% end %>
              (í•™ìŠµ ë‹¨ê³„: <%= @course.level %>)
            </dd>
            
            <dt class="col-sm-3">ê°€ê²©</dt>
            <dd class="col-sm-9">
              <strong><%= number_to_currency(@course.price, unit: 'â‚©', precision: 0) %></strong>
              <% if @course.discount_percentage.to_i > 0 %>
                <span class="badge bg-danger"><%= @course.discount_percentage %>% í• ì¸</span>
                <small class="text-muted">
                  (í• ì¸ê°€: <%= number_to_currency(@course.discounted_price, unit: 'â‚©', precision: 0) %>)
                </small>
              <% end %>
            </dd>
            
            <dt class="col-sm-3">ì†Œìš”ì‹œê°„</dt>
            <dd class="col-sm-9"><%= @course.duration %>ë¶„</dd>
            
            <% if @course.tags.present? %>
              <dt class="col-sm-3">íƒœê·¸</dt>
              <dd class="col-sm-9">
                <% @course.tag_list.each do |tag| %>
                  <span class="badge bg-light text-dark"><%= tag %></span>
                <% end %>
              </dd>
            <% end %>
            
            <% if @course.production_date.present? %>
              <dt class="col-sm-3">ì œì‘ì¼</dt>
              <dd class="col-sm-9"><%= @course.production_date.strftime('%Yë…„ %mì›” %dì¼') %></dd>
            <% end %>
            
            <dt class="col-sm-3">ì„¤ëª…</dt>
            <dd class="col-sm-9"><%= simple_format(@course.description) %></dd>
          </dl>
        </div>
      </div>

      <!-- ì œì‘ì§„ ì •ë³´ -->
      <div class="card mb-3">
        <div class="card-header bg-light">
          <h5 class="mb-0">ğŸ‘¥ ì œì‘ì§„</h5>
        </div>
        <div class="card-body">
          <div class="row">
            <% if @course.writer %>
              <div class="col-md-4">
                <div class="author-info">
                  <span class="badge bg-primary">ì‘ê°€</span>
                  <p class="mb-0 mt-1"><strong><%= @course.writer.name %></strong></p>
                  <% if @course.writer.bio.present? %>
                    <small class="text-muted"><%= @course.writer.bio.truncate(50) %></small>
                  <% end %>
                </div>
              </div>
            <% end %>
            
            <% if @course.illustrator %>
              <div class="col-md-4">
                <div class="author-info">
                  <span class="badge bg-success">ì¼ëŸ¬ìŠ¤íŠ¸ë ˆì´í„°</span>
                  <p class="mb-0 mt-1"><strong><%= @course.illustrator.name %></strong></p>
                  <% if @course.illustrator.bio.present? %>
                    <small class="text-muted"><%= @course.illustrator.bio.truncate(50) %></small>
                  <% end %>
                </div>
              </div>
            <% end %>
            
            <% if @course.narrator %>
              <div class="col-md-4">
                <div class="author-info">
                  <span class="badge bg-info">ì„±ìš°</span>
                  <p class="mb-0 mt-1"><strong><%= @course.narrator.name %></strong></p>
                  <% if @course.narrator.bio.present? %>
                    <small class="text-muted"><%= @course.narrator.bio.truncate(50) %></small>
                  <% end %>
                </div>
              </div>
            <% end %>
          </div>
          
          <% if !@course.writer && !@course.illustrator && !@course.narrator %>
            <p class="text-muted mb-0">ë“±ë¡ëœ ì œì‘ì§„ì´ ì—†ìŠµë‹ˆë‹¤</p>
          <% end %>
        </div>
      </div>

      <!-- íŒŒì¼ ëª©ë¡ -->
      <div class="card">
        <div class="card-header bg-light d-flex justify-content-between align-items-center">
          <h5 class="mb-0">ğŸ“ íŒŒì¼ ëª©ë¡</h5>
          <%= link_to 'â• íŒŒì¼ ì¶”ê°€', edit_admin_course_path(@course, anchor: 'files'), class: 'btn btn-sm btn-primary' %>
        </div>
        <div class="card-body">
          <% if @course.category.to_s.match?(/ì „ìë™í™”ì±…|ebook|ë™í™”ì±…/) %>
            <!-- ì „ìì±… íŒŒì¼ -->
            <h6>ğŸ“„ í˜ì´ì§€ ì´ë¯¸ì§€ (<%= @existing_files[:images].count %>ê°œ)</h6>
            <% if @existing_files[:images].any? %>
              <div class="file-grid mb-3">
                <% @existing_files[:images].first(12).each do |file| %>
                  <div class="file-thumbnail">
                    <%= image_tag file[:path], alt: file[:name], class: 'img-thumbnail' %>
                    <small><%= file[:name] %></small>
                  </div>
                <% end %>
                <% if @existing_files[:images].count > 12 %>
                  <div class="text-muted">
                    ... ì™¸ <%= @existing_files[:images].count - 12 %>ê°œ
                  </div>
                <% end %>
              </div>
            <% else %>
              <p class="text-muted">ì´ë¯¸ì§€ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤</p>
            <% end %>
            
            <h6 class="mt-3">ğŸ“ ìº¡ì…˜ (<%= @existing_files[:captions].count %>ê°œ)</h6>
            <% if @existing_files[:captions].any? %>
              <div class="list-group list-group-flush">
                <% @existing_files[:captions].first(5).each do |file| %>
                  <div class="list-group-item">
                    <i class="bi bi-file-text"></i> <%= file[:name] %>
                    <small class="text-muted">(<%= number_to_human_size(file[:size]) %>)</small>
                  </div>
                <% end %>
                <% if @existing_files[:captions].count > 5 %>
                  <div class="list-group-item text-muted">
                    ... ì™¸ <%= @existing_files[:captions].count - 5 %>ê°œ
                  </div>
                <% end %>
              </div>
            <% else %>
              <p class="text-muted">ìº¡ì…˜ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤</p>
            <% end %>
          <% else %>
            <!-- ë¹„ë””ì˜¤ íŒŒì¼ -->
            <h6>ğŸ¬ ë¹„ë””ì˜¤ (<%= @existing_files[:videos].count %>ê°œ)</h6>
            <% if @existing_files[:videos].any? %>
              <div class="list-group list-group-flush mb-3">
                <% @existing_files[:videos].each do |file| %>
                  <div class="list-group-item">
                    <i class="bi bi-file-play"></i> 
                    <strong><%= file[:name] %></strong>
                    <span class="badge bg-secondary"><%= number_to_human_size(file[:size]) %></span>
                  </div>
                <% end %>
              </div>
            <% else %>
              <p class="text-muted">ë¹„ë””ì˜¤ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤</p>
            <% end %>
            
            <h6>ğŸ“„ ìë§‰ (<%= @existing_files[:subtitles].count %>ê°œ)</h6>
            <% if @existing_files[:subtitles].any? %>
              <div class="list-group list-group-flush">
                <% @existing_files[:subtitles].each do |file| %>
                  <div class="list-group-item">
                    <i class="bi bi-file-earmark-text"></i> <%= file[:name] %>
                    <small class="text-muted">(<%= number_to_human_size(file[:size]) %>)</small>
                  </div>
                <% end %>
              </div>
            <% else %>
              <p class="text-muted">ìë§‰ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤</p>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>

    <!-- ì‚¬ì´ë“œë°” -->
    <div class="col-lg-4">
      <!-- ì¸ë„¤ì¼ -->
      <div class="card mb-3">
        <div class="card-header bg-light">
          <h6 class="mb-0">ğŸ–¼ï¸ ì¸ë„¤ì¼</h6>
        </div>
        <div class="card-body text-center">
          <% if @course.thumbnail.present? %>
            <%= image_tag @course.thumbnail, alt: @course.title, class: 'img-fluid rounded' %>
          <% else %>
            <div class="placeholder-thumbnail-large">
              <span>ğŸ“š</span>
              <p class="text-muted mt-2">ì¸ë„¤ì¼ ì—†ìŒ</p>
            </div>
          <% end %>
        </div>
      </div>

      <!-- ë¹ ë¥¸ ì‘ì—… -->
      <div class="card mb-3">
        <div class="card-header bg-light">
          <h6 class="mb-0">âš¡ ë¹ ë¥¸ ì‘ì—…</h6>
        </div>
        <div class="card-body">
          <div class="d-grid gap-2">
            <%= link_to 'âœï¸ ì½”ìŠ¤ ìˆ˜ì •', edit_admin_course_path(@course), class: 'btn btn-outline-primary' %>
            <%= link_to 'ğŸ‘ï¸ í”„ë¡ íŠ¸ ë¯¸ë¦¬ë³´ê¸°', course_path(@course), class: 'btn btn-outline-info', target: '_blank' %>
            <% if @course.category.to_s.match?(/ì „ìë™í™”ì±…|ebook|ë™í™”ì±…/) %>
              <%= link_to 'ğŸ“– ë¦¬ë” ë³´ê¸°', read_course_path(@course), class: 'btn btn-outline-secondary', target: '_blank' %>
            <% else %>
              <%= link_to 'ğŸ¬ í”Œë ˆì´ì–´ ë³´ê¸°', watch_course_path(@course), class: 'btn btn-outline-secondary', target: '_blank' %>
            <% end %>
            <%= link_to 'ğŸ—‘ï¸ ì‚­ì œ', admin_course_path(@course), 
                method: :delete,
                data: { turbo_method: :delete, turbo_confirm: 'ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.' },
                class: 'btn btn-outline-danger' %>
          </div>
        </div>
      </div>

      <!-- í†µê³„ -->
      <div class="card">
        <div class="card-header bg-light">
          <h6 class="mb-0">ğŸ“Š í†µê³„</h6>
        </div>
        <div class="card-body">
          <ul class="list-unstyled mb-0">
            <li class="mb-2">
              <strong>ID:</strong> #<%= @course.id %>
            </li>
            <li class="mb-2">
              <strong>ë“±ë¡ì¼:</strong> <%= @course.created_at.strftime('%Yë…„ %mì›” %dì¼') %>
            </li>
            <li class="mb-2">
              <strong>ìˆ˜ì •ì¼:</strong> <%= @course.updated_at.strftime('%Yë…„ %mì›” %dì¼') %>
            </li>
            <li class="mb-2">
              <strong>ê°•ì‚¬:</strong> <%= @course.instructor.name %>
            </li>
            <li class="mb-2">
              <strong>ìˆ˜ê°•ìƒ:</strong> <%= @course.total_students %>ëª…
            </li>
            <li class="mb-2">
              <strong>ë¦¬ë·°:</strong> <%= @course.reviews.count %>ê°œ
            </li>
            <li class="mb-2">
              <strong>í‰ê·  í‰ì :</strong> â­ <%= @course.average_rating %>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.placeholder-thumbnail-large {
  height: 200px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 0.5rem;
}

.placeholder-thumbnail-large span {
  font-size: 4rem;
}

.file-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
  gap: 1rem;
}

.file-thumbnail {
  text-align: center;
}

.file-thumbnail img {
  width: 100%;
  height: 80px;
  object-fit: cover;
}

.file-thumbnail small {
  display: block;
  margin-top: 0.25rem;
  font-size: 0.75rem;
}

.author-info {
  padding: 1rem;
  background-color: #f8f9fa;
  border-radius: 0.5rem;
  height: 100%;
}
</style>
