<div class="container-fluid py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1>ğŸ“ ì½”ìŠ¤ ê´€ë¦¬</h1>
      <p class="text-muted mb-0">
        <small>
          ğŸ’¡ ë‹¨ì¶•í‚¤: 
          <kbd>Ctrl/Cmd + N</kbd> ì‹ ê·œ ë“±ë¡ | 
          <kbd>Ctrl/Cmd + F</kbd> ê²€ìƒ‰
        </small>
      </p>
    </div>
    <div class="d-flex gap-2">
      <button type="button" class="btn btn-outline-danger" id="bulk-delete-btn" style="display: none;">
        ğŸ—‘ï¸ ì„ íƒ ì‚­ì œ (<span id="selected-count">0</span>)
      </button>
      <%= link_to 'â• ì‹ ê·œ ì½”ìŠ¤ ë“±ë¡', new_admin_course_path, class: 'btn btn-primary btn-lg' %>
    </div>
  </div>

  <!-- ê²€ìƒ‰ & í•„í„° -->
  <div class="card mb-4">
    <div class="card-header bg-light">
      <h6 class="mb-0">ğŸ” ê²€ìƒ‰ ë° í•„í„°</h6>
    </div>
    <div class="card-body">
      <form class="row g-3" id="filter-form">
        <!-- ê²€ìƒ‰ -->
        <div class="col-md-4">
          <label class="form-label">ê²€ìƒ‰</label>
          <input type="text" name="search" class="form-control" placeholder="ì œëª© ë˜ëŠ” ì„¤ëª… ê²€ìƒ‰..." value="<%= params[:search] %>">
        </div>
        
        <!-- ì¹´í…Œê³ ë¦¬ -->
        <div class="col-md-2">
          <label class="form-label">ì¹´í…Œê³ ë¦¬</label>
          <select name="category" class="form-select">
            <option value="">ì „ì²´</option>
            <option value="ì „ìë™í™”ì±…" <%= 'selected' if params[:category] == 'ì „ìë™í™”ì±…' %>>ğŸ“š ì „ìë™í™”ì±…</option>
            <option value="êµ¬ì—°ë™í™”" <%= 'selected' if params[:category] == 'êµ¬ì—°ë™í™”' %>>ğŸ¬ êµ¬ì—°ë™í™”</option>
            <option value="êµìœ¡ìë£Œ" <%= 'selected' if params[:category] == 'êµìœ¡ìë£Œ' %>>ğŸ“– êµìœ¡ìë£Œ</option>
            <option value="ì „ë˜ë™í™”" <%= 'selected' if params[:category] == 'ì „ë˜ë™í™”' %>>ì „ë˜ë™í™”</option>
            <option value="ëª…ì‘ë™í™”" <%= 'selected' if params[:category] == 'ëª…ì‘ë™í™”' %>>ëª…ì‘ë™í™”</option>
          </select>
        </div>
        
        <!-- ìƒíƒœ -->
        <div class="col-md-2">
          <label class="form-label">ë°œí–‰ ìƒíƒœ</label>
          <select name="status" class="form-select">
            <option value="">ì „ì²´</option>
            <option value="published" <%= 'selected' if params[:status] == 'published' %>>âœ… ë°œí–‰ë¨</option>
            <option value="draft" <%= 'selected' if params[:status] == 'draft' %>>ğŸ“ ì„ì‹œì €ì¥</option>
            <option value="archived" <%= 'selected' if params[:status] == 'archived' %>>ğŸ“¦ ë³´ê´€ë¨</option>
          </select>
        </div>
        
        <!-- ì½˜í…ì¸  ìƒíƒœ -->
        <div class="col-md-2">
          <label class="form-label">ì½˜í…ì¸  ìƒíƒœ</label>
          <select name="content_status" class="form-select">
            <option value="">ì „ì²´</option>
            <option value="complete" <%= 'selected' if params[:content_status] == 'complete' %>>âœ“ ì™„ì„±</option>
            <option value="partial" <%= 'selected' if params[:content_status] == 'partial' %>>âš  ë¶€ë¶„</option>
            <option value="missing" <%= 'selected' if params[:content_status] == 'missing' %>>âœ— ì—†ìŒ</option>
          </select>
        </div>
        
        <!-- ë²„íŠ¼ -->
        <div class="col-md-2">
          <label class="form-label">&nbsp;</label>
          <div class="d-grid gap-2">
            <button type="submit" class="btn btn-primary">ê²€ìƒ‰</button>
            <%= link_to 'ì´ˆê¸°í™”', admin_courses_path, class: 'btn btn-outline-secondary btn-sm' %>
          </div>
        </div>
      </form>
      
      <!-- ì •ë ¬ ì˜µì…˜ -->
      <div class="mt-3 d-flex justify-content-between align-items-center">
        <div class="text-muted">
          ì´ <strong><%= @courses.count %></strong>ê°œ ì½”ìŠ¤
        </div>
        <div class="btn-group btn-group-sm" role="group">
          <%= link_to 'ìµœì‹ ìˆœ', admin_courses_path(sort: 'recent', **params.except(:sort).permit!), 
              class: "btn btn-outline-secondary #{params[:sort] == 'recent' || params[:sort].blank? ? 'active' : ''}" %>
          <%= link_to 'ì¸ê¸°ìˆœ', admin_courses_path(sort: 'popular', **params.except(:sort).permit!), 
              class: "btn btn-outline-secondary #{params[:sort] == 'popular' ? 'active' : ''}" %>
          <%= link_to 'ê°€ê²©ìˆœ', admin_courses_path(sort: 'price', **params.except(:sort).permit!), 
              class: "btn btn-outline-secondary #{params[:sort] == 'price' ? 'active' : ''}" %>
        </div>
      </div>
    </div>
  </div>

  <!-- ì½”ìŠ¤ ëª©ë¡ -->
  <div class="row g-3">
    <% @courses.each do |course| %>
      <% status = @content_status[course.id] %>
      <div class="col-lg-6 col-xl-4">
        <div class="card course-card h-100 <%= 'border-success' if status[:status] == 'complete' %>" data-course-id="<%= course.id %>">
          <!-- ì„ íƒ ì²´í¬ë°•ìŠ¤ -->
          <div class="position-absolute top-0 start-0 m-2" style="z-index: 100;">
            <input type="checkbox" class="form-check-input course-checkbox" value="<%= course.id %>" style="width: 20px; height: 20px;">
          </div>
          <!-- ì¸ë„¤ì¼ -->
          <div class="course-thumbnail">
            <% if course.thumbnail.present? %>
              <%= image_tag course.thumbnail, alt: course.title, class: 'card-img-top' %>
            <% else %>
              <div class="placeholder-thumbnail">
                <span>ğŸ“š</span>
              </div>
            <% end %>
            
            <!-- ìƒíƒœ ë°°ì§€ -->
            <div class="status-badges">
              <span class="badge <%= course.status == 'published' ? 'bg-success' : 'bg-secondary' %>">
                <%= course.status == 'published' ? 'ë°œí–‰' : course.status == 'draft' ? 'ì„ì‹œ' : 'ë³´ê´€' %>
              </span>
              <span class="badge <%= status[:status] == 'complete' ? 'bg-success' : status[:status] == 'partial' ? 'bg-warning' : 'bg-danger' %>">
                <%= status[:status] == 'complete' ? 'âœ“ ì™„ì„±' : status[:status] == 'partial' ? 'âš  ë¶€ë¶„' : 'âœ— ì—†ìŒ' %>
              </span>
            </div>
          </div>

          <!-- ì¹´ë“œ ë³¸ë¬¸ -->
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start mb-2">
              <h5 class="card-title mb-0">
                <%= link_to course.title, admin_course_path(course), class: 'text-decoration-none text-dark' %>
              </h5>
              <small class="text-muted">#<%= course.id %></small>
            </div>
            
            <% if course.subtitle.present? %>
              <p class="text-muted small mb-2"><%= course.subtitle %></p>
            <% end %>

            <div class="mb-2">
              <span class="badge bg-info"><%= course.category %></span>
              <% if course.series_name.present? %>
                <span class="badge bg-secondary"><%= course.series_name %> #<%= course.series_order %></span>
              <% end %>
            </div>

            <!-- ì½˜í…ì¸  ìƒíƒœ -->
            <div class="content-status mb-2">
              <% if course.category.to_s.match?(/ì „ìë™í™”ì±…|ebook|ë™í™”ì±…/) %>
                <small class="text-muted">
                  ğŸ“„ í˜ì´ì§€: <strong><%= status[:page_count] %></strong>ê°œ
                </small>
              <% else %>
                <small class="text-muted">
                  ğŸ¬ ë¹„ë””ì˜¤: <strong><%= status[:has_video] ? 'ìˆìŒ' : 'ì—†ìŒ' %></strong>
                </small>
              <% end %>
            </div>

            <!-- í†µê³„ -->
            <div class="d-flex justify-content-between text-muted small">
              <span>ğŸ‘¥ <%= course.total_students %>ëª…</span>
              <span>â­ <%= course.average_rating %></span>
              <span>ğŸ’° <%= number_to_currency(course.price, unit: 'â‚©', precision: 0) %></span>
            </div>
          </div>

          <!-- ì•¡ì…˜ ë²„íŠ¼ -->
          <div class="card-footer bg-transparent">
            <div class="btn-group w-100" role="group">
              <%= link_to 'âœï¸', edit_admin_course_path(course), class: 'btn btn-sm btn-outline-primary', title: 'ìˆ˜ì •' %>
              <%= link_to 'ğŸ‘ï¸', course_path(course), class: 'btn btn-sm btn-outline-info', title: 'ë¯¸ë¦¬ë³´ê¸°', target: '_blank' %>
              <%= link_to 'ğŸ“', admin_course_path(course), class: 'btn btn-sm btn-outline-secondary', title: 'ìƒì„¸' %>
              <%= link_to 'ğŸ—‘ï¸', admin_course_path(course), method: :delete, 
                  data: { turbo_method: :delete, turbo_confirm: 'ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?' }, 
                  class: 'btn btn-sm btn-outline-danger', title: 'ì‚­ì œ' %>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>

  <% if @courses.empty? %>
    <div class="alert alert-info text-center my-5">
      <h4>ğŸ“š ì½”ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤</h4>
      <p>ìƒˆë¡œìš´ ì½”ìŠ¤ë¥¼ ë“±ë¡í•´ë³´ì„¸ìš”!</p>
      <%= link_to 'â• ì‹ ê·œ ì½”ìŠ¤ ë“±ë¡', new_admin_course_path, class: 'btn btn-primary' %>
    </div>
  <% end %>
</div>

<style>
.course-card {
  transition: all 0.3s;
  overflow: hidden;
}

.course-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 16px rgba(0,0,0,0.1);
}

.course-thumbnail {
  position: relative;
  height: 200px;
  overflow: hidden;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.course-thumbnail img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.placeholder-thumbnail {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100%;
  font-size: 5rem;
}

.status-badges {
  position: absolute;
  top: 10px;
  right: 10px;
  display: flex;
  gap: 0.5rem;
}

.content-status {
  padding: 0.5rem;
  background-color: #f8f9fa;
  border-radius: 0.25rem;
}

@media (max-width: 768px) {
  .course-thumbnail {
    height: 150px;
  }
  
  .course-card {
    margin-bottom: 1rem;
  }
  
  .btn-group {
    flex-wrap: wrap;
  }
}

@media (max-width: 576px) {
  .file-grid {
    grid-template-columns: repeat(3, 1fr);
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ (í†µí•©)
  document.addEventListener('keydown', function(e) {
    // Ctrl/Cmd + N: ì‹ ê·œ ì½”ìŠ¤ ë“±ë¡
    if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
      e.preventDefault();
      window.location.href = '<%= new_admin_course_path %>';
      return;
    }
    
    // Ctrl/Cmd + F: ê²€ìƒ‰ì°½ í¬ì»¤ìŠ¤
    if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
      e.preventDefault();
      const searchInput = document.querySelector('[name="search"]');
      if (searchInput) searchInput.focus();
      return;
    }
    
    // Ctrl/Cmd + A: ì „ì²´ ì„ íƒ/í•´ì œ
    const checkboxes = document.querySelectorAll('.course-checkbox');
    if ((e.ctrlKey || e.metaKey) && e.key === 'a' && e.target.tagName !== 'INPUT') {
      e.preventDefault();
      const allChecked = checkboxes.length > 0 && Array.from(checkboxes).every(cb => cb.checked);
      
      checkboxes.forEach(checkbox => {
        checkbox.checked = !allChecked;
        checkbox.dispatchEvent(new Event('change'));
      });
      return;
    }
  });
  
  // ì¹´ë“œ í˜¸ë²„ íš¨ê³¼
  document.querySelectorAll('.course-card').forEach(card => {
    card.addEventListener('mouseenter', function() {
      this.style.zIndex = '10';
    });
    
    card.addEventListener('mouseleave', function() {
      this.style.zIndex = '1';
    });
  });
  
  // ê²€ìƒ‰ ì‹¤ì‹œê°„ í•„í„°ë§
  const searchInput = document.querySelector('[name="search"]');
  if (searchInput) {
    let searchTimeout;
    searchInput.addEventListener('input', function() {
      clearTimeout(searchTimeout);
      const query = this.value.toLowerCase();
      
      searchTimeout = setTimeout(() => {
        document.querySelectorAll('.course-card').forEach(card => {
          const title = card.querySelector('.card-title')?.textContent.toLowerCase() || '';
          const shouldShow = !query || title.includes(query);
          
          card.closest('.col-lg-6, .col-xl-4').style.display = shouldShow ? '' : 'none';
        });
      }, 300);
    });
  }
  
  // ì¼ê´„ ì„ íƒ/ì‚­ì œ
  const checkboxes = document.querySelectorAll('.course-checkbox');
  const bulkDeleteBtn = document.getElementById('bulk-delete-btn');
  const selectedCountSpan = document.getElementById('selected-count');
  let selectedCourses = [];
  
  checkboxes.forEach(checkbox => {
    checkbox.addEventListener('change', function() {
      if (this.checked) {
        selectedCourses.push(this.value);
      } else {
        selectedCourses = selectedCourses.filter(id => id !== this.value);
      }
      
      selectedCountSpan.textContent = selectedCourses.length;
      bulkDeleteBtn.style.display = selectedCourses.length > 0 ? 'block' : 'none';
    });
  });
  
  if (bulkDeleteBtn) {
    bulkDeleteBtn.addEventListener('click', function() {
      if (!confirm(`ì„ íƒí•œ ${selectedCourses.length}ê°œì˜ ì½”ìŠ¤ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
        return;
      }
      
      // ì¼ê´„ ì‚­ì œ ì²˜ë¦¬ (ì¶”í›„ êµ¬í˜„)
      alert('ì¼ê´„ ì‚­ì œ ê¸°ëŠ¥ì€ ì¶”í›„ êµ¬í˜„ ì˜ˆì •ì…ë‹ˆë‹¤');
    });
  }

  // ë‹¨ì¶•í‚¤ ë„ì›€ë§
  console.log('%câŒ¨ï¸ ê´€ë¦¬ì í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤', 'font-size: 16px; font-weight: bold; color: #0d6efd;');
  console.log('Ctrl/Cmd + N: ì‹ ê·œ ì½”ìŠ¤ ë“±ë¡');
  console.log('Ctrl/Cmd + F: ê²€ìƒ‰');
  console.log('Ctrl/Cmd + A: ì „ì²´ ì„ íƒ/í•´ì œ');
});
</script>
