<!DOCTYPE html>
<html lang="ko">
  <head>
    <title><%= content_for?(:title) ? yield(:title) : "정화의 서재 - 동화책 세상의 마법" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta charset="UTF-8">
    <meta name="description" content="아이들을 위한 특별한 동화책 플랫폼">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🏰</text></svg>">
    
    <!-- Fonts -->
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <!-- AOS Animation (removed) -->
    
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_include_tag "application", "data-turbo-track": "reload", defer: true %>
  </head>

  <body>
    <a href="#main" class="skip-link">본문 바로가기</a>
    <!-- 모던 네비게이션 바 -->
    <nav class="navbar navbar-expand-lg nav-premium" id="mainNav">
      <div class="container">
        <!-- 브랜드 로고 -->
        <%= link_to root_path, class: "navbar-brand" do %>
          <div class="brand-wrapper">
            <div class="brand-info">
              <h1 class="brand-name" style="background:none;-webkit-text-fill-color:initial;">정화의 서재</h1>
              <p class="brand-tagline">동화책 플랫폼</p>
            </div>
          </div>
        <% end %>
        
        <!-- 모바일 토글 버튼 -->
        <button class="navbar-toggler custom-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
          <span class="toggler-icon"></span>
          <span class="toggler-icon"></span>
          <span class="toggler-icon"></span>
        </button>
        
        <!-- 네비게이션 메뉴 -->
        <div class="collapse navbar-collapse" id="navbarContent">
          <ul class="navbar-nav mx-auto">
            <li class="nav-item"><%= link_to "홈", root_path, class: "nav-premium-link #{current_page?(root_path) ? 'active' : ''}" %></li>
            <li class="nav-item"><%= link_to "전자동화책", courses_path(category: 'ebook'), class: "nav-premium-link #{params[:category] == 'ebook' ? 'active' : ''}" %></li>
            <li class="nav-item"><%= link_to "구연동화", courses_path(category: 'storytelling'), class: "nav-premium-link #{params[:category] == 'storytelling' ? 'active' : ''}" %></li>
            <li class="nav-item"><%= link_to "동화만들기", courses_path(category: 'education'), class: "nav-premium-link #{params[:category] == 'education' ? 'active' : ''}" %></li>
            <li class="nav-item"><%= link_to "청소년 콘텐츠", teen_content_path, class: "nav-premium-link #{current_page?(teen_content_path) ? 'active' : ''}" %></li>
          </ul>
          
          <!-- 우측 메뉴 -->
          <ul class="navbar-nav">
            <% if logged_in? %>
              <!-- 장바구니 -->
              <li class="nav-item"><%= link_to "보관함", cart_items_path, class: "nav-premium-link position-relative" %></li>
              
              <!-- 사용자 드롭다운 -->
              <li class="nav-item dropdown">
                <a class="nav-premium-link dropdown-toggle user-menu" href="#" data-bs-toggle="dropdown">
                  <span class="user-avatar">
                    <%= current_user.name.first.upcase %>
                  </span>
                  <span class="d-none d-lg-inline"><%= current_user.name %></span>
                </a>
                <ul class="dropdown-menu dropdown-menu-end">
                  <li class="dropdown-header">
                    <div class="user-info">
                      <strong><%= current_user.name %></strong>
                      <small class="text-muted"><%= current_user.email %></small>
                    </div>
                  </li>
                  <li><hr class="dropdown-divider"></li>
                  <li>
                    <%= link_to dashboard_user_path(current_user), class: "dropdown-item" do %>
                      <i class="bi bi-speedometer2 me-2"></i>대시보드
                    <% end %>
                  </li>
                  <li>
                    <%= link_to my_courses_user_path(current_user), class: "dropdown-item" do %>
                      <i class="bi bi-book me-2"></i>내 동화책
                    <% end %>
                  </li>
                  <% if current_user.instructor? %>
                    <li>
                      <%= link_to my_teachings_user_path(current_user), class: "dropdown-item" do %>
                        <i class="bi bi-mortarboard me-2"></i>작가 메뉴
                      <% end %>
                    </li>
                    <li>
                      <%= link_to new_course_path, class: "dropdown-item" do %>
                        <i class="bi bi-plus-circle me-2"></i>새 동화 등록
                      <% end %>
                    </li>
                  <% end %>
                  <li>
                    <%= link_to edit_user_path(current_user), class: "dropdown-item" do %>
                      <i class="bi bi-gear me-2"></i>설정
                    <% end %>
                  </li>
                  <li><hr class="dropdown-divider"></li>
                  <li>
                    <%= button_to logout_path, method: :delete, class: "dropdown-item text-danger" do %>
                      <i class="bi bi-box-arrow-right me-2"></i>로그아웃
                    <% end %>
                  </li>
                </ul>
              </li>
            <% else %>
              <li class="nav-item"><%= link_to "로그인", login_path, class: "btn-minimal btn-minimal-secondary me-2" %></li>
              <li class="nav-item"><%= link_to "회원가입", signup_path, class: "btn-minimal btn-minimal-primary" %></li>
            <% end %>
          </ul>
        </div>
      </div>
    </nav>

    <!-- 플래시 메시지 -->
    <% if flash.any? %>
      <div class="toast-container">
        <% flash.each do |type, message| %>
          <div class="toast-modern <%= type == 'notice' ? 'success' : 'warning' %> show">
            <div class="toast-header">
              <strong class="me-auto">
                <%= type == 'notice' ? '✅ 성공' : '⚠️ 알림' %>
              </strong>
              <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body">
              <%= message %>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>

    <!-- 메인 콘텐츠 -->
    <main id="main" class="main-content">
      <%= yield %>
    </main>

    <!-- 모던 푸터 -->
    <footer class="footer-modern">
      <div class="container">
        <div class="row">
          <div class="col-lg-4 mb-4">
            <div class="footer-brand">
              <h3 class="gradient-text mb-3">🏰 정화의 서재</h3>
              <p class="text-muted">
                아이들의 상상력을 키우는<br>
                특별한 동화책 플랫폼
              </p>
              <div class="social-links mt-3">
                <a href="#" class="social-link"><i class="bi bi-facebook"></i></a>
                <a href="#" class="social-link"><i class="bi bi-instagram"></i></a>
                <a href="#" class="social-link"><i class="bi bi-youtube"></i></a>
                <a href="#" class="social-link"><i class="bi bi-twitter"></i></a>
              </div>
            </div>
          </div>
          
          <div class="col-lg-2 col-md-4 mb-4">
            <h5 class="footer-title">서비스</h5>
            <ul class="footer-links">
              <li><%= link_to "전자동화책", courses_path(category: 'ebook') %></li>
              <li><%= link_to "구연동화", courses_path(category: 'storytelling') %></li>
              <li><%= link_to "동화만들기", courses_path(category: 'education') %></li>
              <li><%= link_to "청소년 콘텐츠", teen_content_path %></li>
              <li><%= link_to "전체 콘텐츠", courses_path %></li>
            </ul>
          </div>
          
          <div class="col-lg-2 col-md-4 mb-4">
            <h5 class="footer-title">고객지원</h5>
            <ul class="footer-links">
              <li><a href="#">자주 묻는 질문</a></li>
              <li><a href="#">이용 가이드</a></li>
              <li><a href="#">문의하기</a></li>
              <li><a href="#">공지사항</a></li>
            </ul>
          </div>
          
          <div class="col-lg-2 col-md-4 mb-4">
            <h5 class="footer-title">회사</h5>
            <ul class="footer-links">
              <li><a href="#">회사 소개</a></li>
              <li><a href="#">이용약관</a></li>
              <li><a href="#">개인정보처리방침</a></li>
              <li><a href="#">작가 모집</a></li>
            </ul>
          </div>
          
          <div class="col-lg-2 mb-4">
            <h5 class="footer-title">연락처</h5>
            <ul class="footer-contact">
              <li><i class="bi bi-envelope"></i> info@jeonghwa.com</li>
              <li><i class="bi bi-telephone"></i> 02-1234-5678</li>
              <li><i class="bi bi-clock"></i> 평일 09:00 - 18:00</li>
            </ul>
          </div>
        </div>
        
        <hr class="footer-divider">
        
        <div class="footer-bottom">
          <p class="mb-0">© 2024 정화의 서재. All rights reserved.</p>
          <p class="mb-0 small text-muted">Made with ❤️ for children's imagination</p>
        </div>
      </div>
    </footer>

    <!-- 스크롤 투 탑 버튼 -->
    <button id="scrollTop" class="scroll-top-btn">
      <i class="bi bi-arrow-up"></i>
    </button>

    <!-- AOS 초기화 -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
      AOS.init({
        duration: 800,
        once: true,
        offset: 100
      });
    </script>

    <!-- 커스텀 스크립트 -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // 네비게이션 스크롤 효과
        const navbar = document.getElementById('mainNav');
        window.addEventListener('scroll', function() {
          if (window.scrollY > 50) {
            navbar.classList.add('scrolled');
          } else {
            navbar.classList.remove('scrolled');
          }
        });
        
        // 스크롤 투 탑
        const scrollTopBtn = document.getElementById('scrollTop');
        window.addEventListener('scroll', function() {
          if (window.scrollY > 300) {
            scrollTopBtn.classList.add('show');
          } else {
            scrollTopBtn.classList.remove('show');
          }
        });
        
        scrollTopBtn.addEventListener('click', function() {
          window.scrollTo({
            top: 0,
            behavior: 'smooth'
          });
        });
        
        // 토스트 자동 숨김
        const toasts = document.querySelectorAll('.toast-modern');
        toasts.forEach(toast => {
          setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => toast.remove(), 300);
          }, 5000);
        });
      });
    </script>

    <style>
      /* 접근성 스킵링크 */
      .skip-link {
        position: absolute; left: -9999px; top: 0; padding: 8px 12px; background: #000; color: #fff; z-index: 10000; border-radius: 6px;
      }
      .skip-link:focus { left: 10px; top: 10px; outline: 3px solid #ffd60a; }

      /* 네비게이션 스타일 */
      .navbar-modern {
        padding: 1rem 0;
        transition: all 0.3s ease;
        background: rgba(255, 255, 255, 0.98);
        backdrop-filter: blur(10px);
        box-shadow: 0 2px 20px rgba(0, 0, 0, 0.05);
      }
      
      .navbar-modern.scrolled {
        padding: 0.5rem 0;
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
      }
      
      .brand-wrapper {
        display: flex;
        align-items: center;
        gap: 12px;
      }
      
      .brand-icon {
        font-size: 2rem;
        animation: float 3s ease-in-out infinite;
      }
      
      .brand-name {
        font-size: 1.5rem;
        font-weight: 800;
        margin: 0;
        line-height: 1;
      }
      
      .brand-tagline {
        font-size: 0.75rem;
        color: #718096;
        margin: 0;
      }
      
      .nav-link-modern {
        padding: 0.5rem 1rem;
        margin: 0 0.25rem;
        border-radius: 12px;
        font-weight: 500;
        color: #4a5568;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 6px;
      }
      
      .nav-link-modern:hover {
        background: rgba(102, 126, 234, 0.1);
        color: #667eea;
        transform: translateY(-2px);
      }
      
      .nav-link-modern.active {
        background: var(--primary-gradient);
        color: white;
      }
      
      
      .nav-icon {
        font-size: 1.2rem;
      }
      
      .cart-badge {
        position: absolute;
        top: -5px;
        right: -5px;
        background: #f56565;
        color: white;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.75rem;
        font-weight: bold;
      }
      
      .user-avatar {
        width: 32px;
        height: 32px;
        background: var(--primary-gradient);
        color: white;
        border-radius: 50%;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        margin-right: 8px;
      }
      
      .dropdown-menu-modern {
        border: none;
        border-radius: 16px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
        padding: 0.5rem;
        margin-top: 0.5rem;
      }
      
      .dropdown-item {
        border-radius: 8px;
        padding: 0.5rem 1rem;
        transition: all 0.2s ease;
      }
      
      .dropdown-item:hover {
        background: rgba(102, 126, 234, 0.1);
        transform: translateX(4px);
      }
      
      /* 커스텀 토글러 */
      .custom-toggler {
        border: none;
        padding: 4px 8px;
      }
      
      .toggler-icon {
        display: block;
        width: 25px;
        height: 3px;
        background: #4a5568;
        margin: 5px 0;
        transition: all 0.3s ease;
        border-radius: 2px;
      }
      
      .navbar-toggler:focus {
        box-shadow: none;
      }
      
      /* 메인 콘텐츠 */
      .main-content {
        min-height: calc(100vh - 80px);
        padding-top: 80px;
      }
      
      /* 푸터 */
      .footer-modern {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 60px 0 30px;
        margin-top: 80px;
      }
      
      .footer-title {
        font-weight: 700;
        margin-bottom: 1rem;
      }
      
      .footer-links {
        list-style: none;
        padding: 0;
      }
      
      .footer-links li {
        margin-bottom: 0.5rem;
      }
      
      .footer-links a {
        color: rgba(255, 255, 255, 0.8);
        text-decoration: none;
        transition: all 0.3s ease;
      }
      
      .footer-links a:hover {
        color: white;
        transform: translateX(4px);
        display: inline-block;
      }
      
      .footer-contact {
        list-style: none;
        padding: 0;
      }
      
      .footer-contact li {
        margin-bottom: 0.5rem;
        color: rgba(255, 255, 255, 0.9);
      }
      
      .footer-contact i {
        margin-right: 8px;
      }
      
      .social-links {
        display: flex;
        gap: 12px;
      }
      
      .social-link {
        width: 40px;
        height: 40px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        text-decoration: none;
        transition: all 0.3s ease;
      }
      
      .social-link:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: translateY(-4px);
      }
      
      .footer-divider {
        border-color: rgba(255, 255, 255, 0.2);
        margin: 40px 0 20px;
      }
      
      .footer-bottom {
        text-align: center;
      }
      
      /* 스크롤 투 탑 */
      .scroll-top-btn {
        position: fixed;
        bottom: 30px;
        right: 30px;
        width: 50px;
        height: 50px;
        background: var(--primary-gradient);
        color: white;
        border: none;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        cursor: pointer;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
        z-index: 1000;
      }
      
      .scroll-top-btn.show {
        opacity: 1;
        visibility: visible;
      }
      
      .scroll-top-btn:hover {
        transform: translateY(-4px);
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
      }
      
      /* 토스트 컨테이너 */
      .toast-container {
        position: fixed;
        top: 100px;
        right: 20px;
        z-index: 10000;
      }
      
      /* 반응형 */
      @media (max-width: 768px) {
        .main-content {
          padding-top: 70px;
        }
        
        .brand-name {
          font-size: 1.2rem;
        }
        
        .brand-tagline {
          display: none;
        }
        
        .nav-link-modern {
          padding: 0.75rem;
        }
      }
    </style>
  </body>
</html>