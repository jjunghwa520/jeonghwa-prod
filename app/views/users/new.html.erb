<% content_for :title, "회원가입 - 정화의 서재" %>

<div class="modern-signup-container">
  <!-- 연령대 선택 섹션 -->
  <div id="age-selection-section" class="age-selection-wrapper">
    <div class="signup-header">
      <div class="brand-logo">
        <i class="bi bi-book-half"></i>
        <span>정화의 서재</span>
      </div>
      <h1 class="signup-title">회원가입</h1>
      <p class="signup-subtitle">어떤 분을 위한 계정을 만드시나요?</p>
    </div>
    
    <div class="age-options">
      <!-- 성인 선택 옵션 -->
      <div class="age-option adult-option" data-age="adult">
        <div class="option-icon">
          <i class="bi bi-person-badge"></i>
        </div>
        <div class="option-content">
          <h3>성인 회원</h3>
          <p>18세 이상</p>
          <div class="option-features">
            <span>전문 강의</span>
            <span>도서 대여</span>
            <span>수료증</span>
          </div>
        </div>
        <div class="option-arrow">
          <i class="bi bi-arrow-right"></i>
        </div>
      </div>
      
      <!-- 키즈 선택 옵션 -->
      <div class="age-option kids-option" data-age="kids">
        <div class="option-icon">
          <i class="bi bi-emoji-smile"></i>
        </div>
        <div class="option-content">
          <h3>키즈 회원</h3>
          <p>3-17세</p>
          <div class="option-features">
            <span>교육 강의</span>
            <span>동화/만화</span>
            <span>부모 통제</span>
          </div>
        </div>
        <div class="option-arrow">
          <i class="bi bi-arrow-right"></i>
        </div>
      </div>
    </div>
  </div>
      
  <!-- 회원가입 폼 섹션 -->
  <div id="signup-form-section" class="signup-form-wrapper" style="display: none;">
    <div class="form-container">
      <!-- 폼 헤더 -->
      <div class="form-header">
        <button type="button" id="back-to-selection" class="back-button">
          <i class="bi bi-arrow-left"></i>
        </button>
        <div id="selected-age-indicator" class="age-indicator">
          <!-- 동적으로 생성됨 -->
        </div>
          </div>

          <%= form_with model: @user, local: true, class: "needs-validation", novalidate: true do |f| %>
              <!-- 숨겨진 연령대 필드 -->
              <%= f.hidden_field :age_category, id: "age_category_field" %>
              
            <% if @user.errors.any? %>
              <div class="alert alert-danger" role="alert">
                <h6>다음 오류를 확인해주세요:</h6>
                <ul class="mb-0">
                  <% @user.errors.full_messages.each do |message| %>
                    <li><%= message %></li>
                  <% end %>
                </ul>
              </div>
            <% end %>

              <!-- 키즈 전용: 부모님 정보 섹션 -->
              <div id="parent-info-section" style="display: none;">
                <div class="info-section-header">
                  <h5><i class="bi bi-person-hearts me-2"></i>부모님 정보</h5>
                  <p class="text-muted">자녀의 안전한 학습과 맞춤 서비스 제공을 위해 필요합니다.</p>
                </div>
                
                <div class="form-grid">
                  <!-- 부모님 기본 정보 -->
                  <div class="form-row">
                    <div class="form-group">
                      <label class="form-label">👨‍👩‍👧‍👦 부모님 성함</label>
                      <%= f.text_field :parent_name, class: "form-control", 
                                      placeholder: "성함을 입력해주세요", id: "parent_name_field" %>
                    </div>
                    <div class="form-group">
                      <label class="form-label">📧 부모님 이메일</label>
                      <%= f.email_field :parent_email, class: "form-control", 
                                       placeholder: "이메일 주소", id: "parent_email_field" %>
                    </div>
                  </div>
                  
                  <!-- 부모님 연락처 및 생일 -->
                  <div class="form-row">
                    <div class="form-group">
                      <label class="form-label">📱 연락처</label>
                      <%= f.text_field :parent_phone, class: "form-control", 
                                      placeholder: "010-1234-5678", id: "parent_phone_field",
                                      type: "tel" %>
                    </div>
                    <div class="form-group">
                      <label class="form-label">🎂 부모님 생년월일</label>
                      <%= f.date_field :parent_birthday, class: "form-control", 
                                      id: "parent_birthday_field" %>
                    </div>
                  </div>
                  
                  <!-- 관계 및 직업 -->
                  <div class="form-row">
                    <div class="form-group">
                      <label class="form-label">👥 자녀와의 관계</label>
                      <%= f.select :parent_relationship, 
                                  options_for_select([
                                    ['아버지', 'father'],
                                    ['어머니', 'mother'],
                                    ['조부모', 'grandparent'],
                                    ['기타 보호자', 'guardian']
                                  ]), 
                                  { prompt: "관계를 선택해주세요" },
                                  { class: "form-select", id: "parent_relationship_field" } %>
                    </div>
                    <div class="form-group">
                      <label class="form-label">💼 직업 (선택사항)</label>
                      <%= f.text_field :parent_job, class: "form-control", 
                                      placeholder: "예: 회사원, 자영업 등", id: "parent_job_field" %>
                    </div>
                  </div>
                </div>
              </div>

              <!-- 키즈 전용: 자녀 정보 섹션 -->
              <div id="child-info-section" style="display: none;">
                <div class="info-section-header">
                  <h5><i class="bi bi-emoji-smile me-2"></i>자녀 정보</h5>
                  <p class="text-muted">맞춤형 콘텐츠 추천과 생일 이벤트 안내를 위해 필요합니다.</p>
                </div>
                
                <div class="form-grid">
                  <!-- 자녀 기본 정보 -->
                  <div class="form-row">
                    <div class="form-group">
                      <label class="form-label">👶 자녀 이름</label>
                      <%= f.text_field :child_name, class: "form-control", 
                                      placeholder: "자녀의 이름", id: "child_name_field" %>
                    </div>
                    <div class="form-group">
                      <label class="form-label">⚥ 성별</label>
                      <%= f.select :child_gender, 
                                  options_for_select([
                                    ['남자아이', 'male'],
                                    ['여자아이', 'female']
                                  ]), 
                                  { prompt: "성별을 선택해주세요" },
                                  { class: "form-select", id: "child_gender_field" } %>
                    </div>
                  </div>
                  
                  <!-- 자녀 생년월일 -->
                  <div class="form-row">
                    <div class="form-group full-width">
                      <label class="form-label">🎂 자녀 생년월일</label>
                      <div class="birthday-inputs">
                        <%= f.select :child_birth_year, 
                                    options_for_select((2007..Date.current.year).map { |year| [year, year] }), 
                                    { prompt: "년도" }, 
                                    { class: "form-select", id: "child_birth_year_field" } %>
                        <%= f.select :child_birth_month, 
                                    options_for_select((1..12).map { |month| ["#{month}월", month] }), 
                                    { prompt: "월" }, 
                                    { class: "form-select", id: "child_birth_month_field" } %>
                        <%= f.select :child_birth_day, 
                                    options_for_select((1..31).map { |day| ["#{day}일", day] }), 
                                    { prompt: "일" }, 
                                    { class: "form-select", id: "child_birth_day_field" } %>
                      </div>
                      <small class="form-text">생일 이벤트와 연령별 맞춤 콘텐츠 제공에 활용됩니다.</small>
                    </div>
                  </div>
                  
                  <!-- 자녀 학년 및 관심사 -->
                  <div class="form-row">
                    <div class="form-group">
                      <label class="form-label">🏫 학년</label>
                      <%= f.select :child_grade, 
                                  options_for_select([
                                    ['미취학', 'preschool'],
                                    ['초등 1학년', 'elementary_1'],
                                    ['초등 2학년', 'elementary_2'],
                                    ['초등 3학년', 'elementary_3'],
                                    ['초등 4학년', 'elementary_4'],
                                    ['초등 5학년', 'elementary_5'],
                                    ['초등 6학년', 'elementary_6'],
                                    ['중등 1학년', 'middle_1'],
                                    ['중등 2학년', 'middle_2'],
                                    ['중등 3학년', 'middle_3'],
                                    ['고등 1학년', 'high_1'],
                                    ['고등 2학년', 'high_2'],
                                    ['고등 3학년', 'high_3']
                                  ]), 
                                  { prompt: "학년을 선택해주세요" },
                                  { class: "form-select", id: "child_grade_field" } %>
                    </div>
                    <div class="form-group">
                      <label class="form-label">🎨 관심 분야</label>
                      <%= f.select :child_interests, 
                                  options_for_select([
                                    ['수학/과학', 'math_science'],
                                    ['언어/문학', 'language_literature'],
                                    ['예술/음악', 'art_music'],
                                    ['체육/스포츠', 'sports'],
                                    ['코딩/IT', 'coding_it'],
                                    ['역사/사회', 'history_social'],
                                    ['기타', 'other']
                                  ]), 
                                  { prompt: "관심 분야를 선택해주세요" },
                                  { class: "form-select", id: "child_interests_field" } %>
                    </div>
                  </div>
                </div>
              </div>

              <!-- 공통 정보 -->
            <div class="mb-3">
                <label class="form-label fw-semibold">
                  <span id="name-label">이름</span>
                </label>
              <%= f.text_field :name, class: "form-control form-control-lg", 
                                id: "name-field", required: true %>
              <div class="invalid-feedback">
                이름을 입력해주세요.
              </div>
            </div>

            <div class="mb-3">
                <label class="form-label fw-semibold">
                  <span id="email-label">이메일</span>
                </label>
              <%= f.email_field :email, class: "form-control form-control-lg", 
                                  id: "email-field", required: true %>
              <div class="invalid-feedback">
                올바른 이메일을 입력해주세요.
                </div>
                <div id="email-help" class="form-text"></div>
              </div>

              <!-- 키즈 전용: 생년월일 -->
              <div id="birthdate-section" class="mb-3" style="display: none;">
                <label class="form-label fw-semibold">생년월일</label>
                <div class="row g-2">
                  <div class="col-4">
                    <%= f.select :birth_year, 
                                options_for_select((2007..2021).map { |year| [year, year] }), 
                                { prompt: "년도" }, 
                                { class: "form-select", id: "birth_year_field" } %>
                  </div>
                  <div class="col-4">
                    <%= f.select :birth_month, 
                                options_for_select((1..12).map { |month| [month, month] }), 
                                { prompt: "월" }, 
                                { class: "form-select", id: "birth_month_field" } %>
                  </div>
                  <div class="col-4">
                    <%= f.select :birth_day, 
                                options_for_select((1..31).map { |day| [day, day] }), 
                                { prompt: "일" }, 
                                { class: "form-select", id: "birth_day_field" } %>
                  </div>
                </div>
                <div class="form-text">안전한 서비스 제공을 위해 필요합니다.</div>
            </div>

            <div class="mb-3">
                <label class="form-label fw-semibold">비밀번호</label>
              <%= f.password_field :password, class: "form-control form-control-lg", 
                                     id: "password-field", required: true, minlength: 6 %>
              <div class="invalid-feedback">
                비밀번호는 6자 이상이어야 합니다.
                </div>
                <div id="password-help" class="form-text"></div>
            </div>

            <div class="mb-3">
                <label class="form-label fw-semibold">비밀번호 확인</label>
              <%= f.password_field :password_confirmation, class: "form-control form-control-lg", 
                                     id: "password-confirmation-field", required: true %>
              <div class="invalid-feedback">
                  비밀번호가 일치하지 않습니다.
                </div>
            </div>

              <!-- 성인 전용: 역할 선택 -->
              <div id="role-section" class="mb-3">
                <label class="form-label fw-semibold">역할</label>
              <%= f.select :role, 
                          options_for_select([
                              ['학습자', 'student'], 
                            ['강사', 'instructor']
                          ], @user.role), 
                          {}, 
                            { class: "form-select form-select-lg", id: "role-field" } %>
                <div id="role-help" class="form-text"></div>
              </div>

              <!-- 자기소개 -->
              <div class="mb-4">
                <label class="form-label fw-semibold">
                  <span id="bio-label">자기소개</span>
                  <span class="text-muted">(선택사항)</span>
                </label>
                <%= f.text_area :bio, class: "form-control", rows: 3, 
                                id: "bio-field" %>
                <div id="bio-help" class="form-text"></div>
              </div>

              <!-- 약관 동의 -->
              <div id="terms-section" class="mb-4">
                <!-- 성인용 약관 -->
                <div id="adult-terms" style="display: none;">
                  <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" id="adult-terms-check" required>
                    <label class="form-check-label" for="adult-terms-check">
                      <strong>이용약관</strong>에 동의합니다. <a href="#" class="text-primary">전문 보기</a>
                    </label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="adult-privacy-check" required>
                    <label class="form-check-label" for="adult-privacy-check">
                      <strong>개인정보 처리방침</strong>에 동의합니다. <a href="#" class="text-primary">전문 보기</a>
                    </label>
                  </div>
                </div>
                
                <!-- 키즈용 부모 동의 -->
                <div id="kids-consent" style="display: none;">
                  <div class="consent-section">
                    <div class="consent-header">
                      <h6><i class="bi bi-shield-check me-2"></i>부모님 동의</h6>
                      <p class="text-muted small">만 14세 미만 아동의 개인정보 수집·이용을 위해 부모님의 동의가 필요합니다.</p>
                    </div>
                    
                    <div class="consent-items">
                      <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="kids-terms-check" required>
                        <label class="form-check-label" for="kids-terms-check">
                          <div class="consent-item">
                            <strong>아동 이용약관</strong>에 동의합니다.
                            <div class="consent-details">
                              <small class="text-muted">• 서비스 이용 규칙 및 제한사항</small><br>
                              <small class="text-muted">• 콘텐츠 이용 가이드라인</small>
                            </div>
                            <a href="#" class="consent-link">전문 보기</a>
                          </div>
                        </label>
                      </div>
                      
                      <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="kids-privacy-check" required>
                        <label class="form-check-label" for="kids-privacy-check">
                          <div class="consent-item">
                            <strong>아동 개인정보 수집·이용</strong>에 동의합니다.
                            <div class="consent-details">
                              <small class="text-muted">• 수집항목: 이름, 생년월일, 학년, 관심분야</small><br>
                              <small class="text-muted">• 이용목적: 맞춤 콘텐츠 제공, 학습 관리</small><br>
                              <small class="text-muted">• 보유기간: 회원탈퇴 시까지</small>
                            </div>
                            <a href="#" class="consent-link">전문 보기</a>
                          </div>
                        </label>
                      </div>
                      
                      <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="parent-info-consent-check" required>
                        <label class="form-check-label" for="parent-info-consent-check">
                          <div class="consent-item">
                            <strong>부모님 개인정보 수집·이용</strong>에 동의합니다.
                            <div class="consent-details">
                              <small class="text-muted">• 수집항목: 이름, 이메일, 연락처, 생년월일</small><br>
                              <small class="text-muted">• 이용목적: 자녀 계정 관리, 학습 현황 안내</small><br>
                              <small class="text-muted">• 보유기간: 자녀 회원탈퇴 시까지</small>
                            </div>
                            <a href="#" class="consent-link">전문 보기</a>
                          </div>
                        </label>
                      </div>
                      
                      <!-- 선택적 동의 -->
                      <div class="optional-consent">
                        <h6 class="text-muted">선택적 동의 (거부 시에도 서비스 이용 가능)</h6>
                        
                        <div class="form-check mb-2">
                          <input class="form-check-input" type="checkbox" id="marketing-consent-check">
                          <label class="form-check-label" for="marketing-consent-check">
                            <div class="consent-item">
                              <strong>마케팅 정보 수신</strong>에 동의합니다.
                              <div class="consent-details">
                                <small class="text-muted">• 생일 축하 메시지 및 이벤트 안내</small><br>
                                <small class="text-muted">• 맞춤형 강의 및 도서 추천</small><br>
                                <small class="text-muted">• 교육 관련 유용한 정보 제공</small>
                              </div>
                            </div>
                          </label>
                        </div>
                        
                        <div class="form-check mb-2">
                          <input class="form-check-input" type="checkbox" id="third-party-consent-check">
                          <label class="form-check-label" for="third-party-consent-check">
                            <div class="consent-item">
                              <strong>제3자 제공</strong>에 동의합니다.
                              <div class="consent-details">
                                <small class="text-muted">• 제공받는 자: 교육 콘텐츠 제공업체</small><br>
                                <small class="text-muted">• 제공 목적: 맞춤형 교육 서비스 제공</small><br>
                                <small class="text-muted">• 제공 항목: 연령, 학년, 관심분야</small>
                              </div>
                            </div>
                          </label>
                        </div>
              </div>
            </div>

                    <!-- 부모 확인 -->
                    <div class="parent-verification">
                      <div class="alert alert-warning" role="alert">
                        <h6><i class="bi bi-exclamation-triangle me-2"></i>부모님 확인</h6>
                        <p class="mb-2">위 내용을 충분히 읽고 이해했으며, 자녀의 회원가입에 동의합니다.</p>
                        <div class="form-check">
                          <input class="form-check-input" type="checkbox" id="parent-verification-check" required>
                          <label class="form-check-label" for="parent-verification-check">
                            <strong>본인은 위 아동의 법정대리인으로서 개인정보 수집·이용에 동의합니다.</strong>
                          </label>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                
                <div class="invalid-feedback">
                  필수 약관에 모두 동의해주세요.
                </div>
            </div>

            <div class="d-grid mb-4">
                <%= f.submit "회원가입", class: "btn btn-lg", id: "submit-btn" %>
            </div>
          <% end %>

      <!-- 로그인 링크 -->
      <div class="login-link">
        <span>이미 계정이 있으신가요?</span>
        <%= link_to "로그인", login_path %>
      </div>
    </div>
  </div>
</div>

<style>
/* 현대적 한국 웹사이트 스타일 - 미니멀 디자인 */

/* 전체 컨테이너 */
.modern-signup-container {
  min-height: 100vh;
  background: #fafafa;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
}

/* 연령대 선택 래퍼 */
.age-selection-wrapper {
  max-width: 480px;
  width: 100%;
  background: white;
  border-radius: 12px;
  padding: 40px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
}

/* 브랜드 로고 */
.brand-logo {
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 32px;
  color: #333;
}

.brand-logo i {
  font-size: 2rem;
  margin-right: 8px;
  color: #4f46e5;
}

.brand-logo span {
  font-size: 1.5rem;
  font-weight: 700;
  color: #111;
}

/* 회원가입 헤더 */
.signup-header {
  text-align: center;
  margin-bottom: 40px;
}

.signup-title {
  font-size: 1.75rem;
  font-weight: 700;
  color: #111;
  margin-bottom: 8px;
}

.signup-subtitle {
  font-size: 1rem;
  color: #6b7280;
  margin: 0;
}

/* 연령대 옵션들 */
.age-options {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.age-option {
  display: flex;
  align-items: center;
  padding: 20px;
  border: 2px solid #e5e7eb;
  border-radius: 12px;
  background: white;
  cursor: pointer;
  transition: all 0.2s ease;
  position: relative;
}

.age-option:hover {
  border-color: #4f46e5;
  background: #f8faff;
}

.age-option.selected {
  border-color: #4f46e5;
  background: #f0f9ff;
}

/* 옵션 아이콘 */
.option-icon {
  width: 48px;
  height: 48px;
  border-radius: 12px;
  background: #f3f4f6;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 16px;
  flex-shrink: 0;
}

.adult-option .option-icon {
  background: #eff6ff;
  color: #3b82f6;
}

.kids-option .option-icon {
  background: #fef3c7;
  color: #f59e0b;
}

.option-icon i {
  font-size: 1.5rem;
}

/* 옵션 콘텐츠 */
.option-content {
  flex: 1;
}

.option-content h3 {
  font-size: 1.125rem;
  font-weight: 600;
  color: #111;
  margin: 0 0 4px 0;
}

.option-content p {
  font-size: 0.875rem;
  color: #6b7280;
  margin: 0 0 8px 0;
}

.option-features {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

.option-features span {
  font-size: 0.75rem;
  padding: 2px 8px;
  background: #f3f4f6;
  color: #6b7280;
  border-radius: 12px;
}

.adult-option .option-features span {
  background: #dbeafe;
  color: #1d4ed8;
}

.kids-option .option-features span {
  background: #fef3c7;
  color: #92400e;
}

/* 옵션 화살표 */
.option-arrow {
  color: #9ca3af;
  margin-left: 16px;
}

.age-option:hover .option-arrow {
  color: #4f46e5;
  transform: translateX(4px);
}

/* 회원가입 폼 래퍼 */
.signup-form-wrapper {
  max-width: 480px;
  width: 100%;
  background: white;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  animation: slideIn 0.3s ease;
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* 폼 컨테이너 */
.form-container {
  padding: 40px;
}

/* 폼 헤더 */
.form-header {
  display: flex;
  align-items: center;
  margin-bottom: 32px;
  padding-bottom: 20px;
  border-bottom: 1px solid #e5e7eb;
}

.back-button {
  background: none;
  border: none;
  color: #6b7280;
  font-size: 1.25rem;
  cursor: pointer;
  padding: 8px;
  border-radius: 8px;
  transition: all 0.2s ease;
  margin-right: 16px;
}

.back-button:hover {
  background: #f3f4f6;
  color: #374151;
}

.age-indicator {
  font-size: 1rem;
  font-weight: 600;
  color: #111;
}

/* 폼 스타일 */
.form-label {
  font-weight: 600 !important;
  color: #374151 !important;
  margin-bottom: 8px !important;
}

.form-control, .form-select {
  border: 2px solid #e5e7eb !important;
  border-radius: 8px !important;
  padding: 12px 16px !important;
  font-size: 1rem !important;
  transition: border-color 0.2s ease !important;
}

.form-control:focus, .form-select:focus {
  border-color: #4f46e5 !important;
  box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1) !important;
}

/* 제출 버튼 */
#submit-btn {
  background: #4f46e5 !important;
  border: none !important;
  border-radius: 8px !important;
  padding: 14px !important;
  font-weight: 600 !important;
  font-size: 1rem !important;
  transition: background 0.2s ease !important;
}

#submit-btn:hover {
  background: #4338ca !important;
}

/* 키즈 테마 */
.kids-theme #submit-btn {
  background: #f59e0b !important;
}

.kids-theme #submit-btn:hover {
  background: #d97706 !important;
}

/* 로그인 링크 */
.login-link {
  text-align: center;
  margin-top: 32px;
  padding-top: 20px;
  border-top: 1px solid #e5e7eb;
  color: #6b7280;
}

.login-link a {
  color: #4f46e5;
  text-decoration: none;
  font-weight: 600;
  margin-left: 4px;
}

.login-link a:hover {
  text-decoration: underline;
}

/* 알림 스타일 */
.alert-info {
  background: #f0f9ff !important;
  border: 1px solid #bae6fd !important;
  color: #0c4a6e !important;
  border-radius: 8px !important;
}

/* 반응형 */
@media (max-width: 640px) {
  .modern-signup-container {
    padding: 16px;
  }
  
  .age-selection-wrapper,
  .form-container {
    padding: 24px;
  }
  
  .signup-title {
    font-size: 1.5rem;
  }
  
  .age-option {
    padding: 16px;
  }
  
  .option-content h3 {
    font-size: 1rem;
  }
}

/* 부모님 동의 섹션 스타일 */
.consent-section {
  background: #f8f9fa;
  border-radius: 12px;
  padding: 24px;
  margin-top: 20px;
}

.consent-header {
  margin-bottom: 20px;
  padding-bottom: 16px;
  border-bottom: 1px solid #e9ecef;
}

.consent-header h6 {
  color: #495057;
  margin-bottom: 8px;
}

.consent-items .form-check {
  background: white;
  border-radius: 8px;
  padding: 16px;
  border: 1px solid #e9ecef;
  transition: all 0.2s ease;
}

.consent-items .form-check:hover {
  border-color: #4f46e5;
  box-shadow: 0 2px 8px rgba(79, 70, 229, 0.1);
}

.consent-item {
  margin-left: 8px;
}

.consent-details {
  margin: 8px 0;
  padding-left: 12px;
  border-left: 3px solid #e9ecef;
}

.consent-link {
  font-size: 0.875rem;
  color: #4f46e5;
  text-decoration: none;
  font-weight: 500;
}

.consent-link:hover {
  text-decoration: underline;
}

.optional-consent {
  margin-top: 24px;
  padding-top: 20px;
  border-top: 1px solid #e9ecef;
}

.optional-consent h6 {
  font-size: 0.9rem;
  margin-bottom: 16px;
}

.parent-verification {
  margin-top: 24px;
}

.parent-verification .alert {
  border-left: 4px solid #ffc107;
}

.parent-verification .form-check {
  background: rgba(255, 193, 7, 0.1);
  border-radius: 8px;
  padding: 12px;
  margin-top: 12px;
}

/* 폼 그리드 레이아웃 */
.form-grid {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
}

.form-row .form-group.full-width {
  grid-column: 1 / -1;
}

.form-group {
  display: flex;
  flex-direction: column;
}

.form-group label {
  margin-bottom: 8px;
  font-weight: 600;
  color: #374151;
}

.info-section-header {
  margin-bottom: 20px;
  padding: 16px;
  background: #f8f9fa;
  border-radius: 8px;
  border-left: 4px solid #4f46e5;
}

.info-section-header h5 {
  color: #374151;
  margin-bottom: 8px;
}

.birthday-inputs {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 12px;
}

/* 반응형 */
@media (max-width: 768px) {
  .form-row {
    grid-template-columns: 1fr;
  }
  
  .birthday-inputs {
    grid-template-columns: 2fr 1fr 1fr;
  }
  
  .consent-section {
    padding: 16px;
  }
  
  .consent-items .form-check {
    padding: 12px;
  }
}

/* 디버그 패널 숨김 */
#debug-panel {
  display: none;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  console.log('🚀 회원가입 페이지 JavaScript 로드됨');
  let selectedAge = null;
  
  // 디버깅: DOM 요소 확인
  const ageOptions = document.querySelectorAll('.age-option');
  const backButton = document.getElementById('back-to-selection');
  const ageSection = document.getElementById('age-selection-section');
  const formSection = document.getElementById('signup-form-section');
  
  console.log('📋 DOM 요소 확인:', {
    ageOptions: ageOptions.length,
    backButton: !!backButton,
    ageSection: !!ageSection,
    formSection: !!formSection
  });
  
  // 연령대 선택 이벤트
  document.querySelectorAll('.age-option').forEach(option => {
    console.log('🎯 옵션 이벤트 리스너 추가:', option.dataset.age);
    
    // 옵션 클릭 이벤트
    option.addEventListener('click', function(e) {
      console.log('🖱️ 옵션 클릭됨:', this.dataset.age);
      
      // 선택 상태 표시
      document.querySelectorAll('.age-option').forEach(opt => opt.classList.remove('selected'));
      this.classList.add('selected');
      
      selectedAge = this.dataset.age;
      
      // 약간의 지연 후 폼 표시 (선택 피드백을 위해)
      setTimeout(() => {
        showSignupForm(selectedAge);
      }, 200);
    });
  });
  
  // 뒤로가기 버튼
  const backToSelectionBtn = document.getElementById('back-to-selection');
  if (backToSelectionBtn) {
    backToSelectionBtn.addEventListener('click', function() {
      console.log('⬅️ 뒤로가기 버튼 클릭됨');
      showAgeSelection();
    });
  }
  
  // 연령대 선택 화면 표시
  function showAgeSelection() {
    console.log('📄 연령대 선택 화면 표시');
    const ageSection = document.getElementById('age-selection-section');
    const formSection = document.getElementById('signup-form-section');
    
    if (ageSection) ageSection.style.display = 'block';
    if (formSection) formSection.style.display = 'none';
    document.body.className = '';
  }
  
  // 회원가입 폼 표시
  function showSignupForm(ageCategory) {
    console.log('📝 회원가입 폼 표시:', ageCategory);
    
    const ageSection = document.getElementById('age-selection-section');
    const formSection = document.getElementById('signup-form-section');
    
    if (ageSection) {
      ageSection.style.display = 'none';
    } else {
      console.error('❌ age-selection-section을 찾을 수 없습니다');
    }
    
    if (formSection) {
      formSection.style.display = 'block';
    } else {
      console.error('❌ signup-form-section을 찾을 수 없습니다');
      return;
    }
    
    // 연령대별 테마 적용
    document.body.className = ageCategory + '-theme';
    console.log('🎨 테마 적용:', ageCategory + '-theme');
    
    // 선택된 연령대 표시
    const indicator = document.getElementById('selected-age-indicator');
    if (indicator) {
      if (ageCategory === 'adult') {
        indicator.innerHTML = `
          <span><i class="bi bi-person-badge me-2"></i>성인 회원가입</span>
        `;
      } else {
        indicator.innerHTML = `
          <span><i class="bi bi-emoji-smile me-2"></i>키즈 회원가입</span>
        `;
      }
    } else {
      console.error('❌ selected-age-indicator를 찾을 수 없습니다');
    }
    
    // 숨겨진 필드에 연령대 설정
    const ageCategoryField = document.getElementById('age_category_field');
    if (ageCategoryField) {
      ageCategoryField.value = ageCategory;
      console.log('✅ 연령대 필드 설정:', ageCategory);
    } else {
      console.error('❌ age_category_field를 찾을 수 없습니다');
    }
    
    // 연령대별 폼 커스터마이징
    try {
      customizeFormForAge(ageCategory);
      console.log('✅ 폼 커스터마이징 완료');
    } catch (error) {
      console.error('❌ 폼 커스터마이징 오류:', error);
    }
  }
  
  // 연령대별 폼 커스터마이징
  function customizeFormForAge(ageCategory) {
    console.log('🔧 폼 커스터마이징 시작:', ageCategory);
    
    // DOM 요소 안전하게 가져오기
    const parentInfoSection = document.getElementById('parent-info-section');
    const birthdateSection = document.getElementById('birthdate-section');
    const roleSection = document.getElementById('role-section');
    
    if (ageCategory === 'adult') {
      console.log('👨‍💼 성인 폼 설정');
      // 성인 폼 설정
      if (parentInfoSection) parentInfoSection.style.display = 'none';
      if (birthdateSection) birthdateSection.style.display = 'none';
      if (roleSection) roleSection.style.display = 'block';
      
      // 자녀 정보 섹션 숨김
      const childInfoSection = document.getElementById('child-info-section');
      if (childInfoSection) childInfoSection.style.display = 'none';
      
      // 성인 동의 섹션 표시
      const adultTerms = document.getElementById('adult-terms');
      const kidsConsent = document.getElementById('kids-consent');
      if (adultTerms) adultTerms.style.display = 'block';
      if (kidsConsent) kidsConsent.style.display = 'none';
      
      // 라벨 및 플레이스홀더 설정 (안전하게)
      const nameLabel = document.getElementById('name-label');
      const emailLabel = document.getElementById('email-label');
      const nameField = document.getElementById('name-field');
      const emailField = document.getElementById('email-field');
      const passwordField = document.getElementById('password-field');
      const passwordConfirmationField = document.getElementById('password-confirmation-field');
      const bioLabel = document.getElementById('bio-label');
      const bioField = document.getElementById('bio-field');
      
      if (nameLabel) nameLabel.textContent = '이름';
      if (emailLabel) emailLabel.textContent = '이메일';
      if (nameField) nameField.placeholder = '성함을 입력하세요';
      if (emailField) emailField.placeholder = '이메일 주소를 입력하세요';
      if (passwordField) passwordField.placeholder = '비밀번호를 입력하세요';
      if (passwordConfirmationField) passwordConfirmationField.placeholder = '비밀번호를 다시 입력하세요';
      if (bioLabel) bioLabel.textContent = '자기소개';
      if (bioField) bioField.placeholder = '간단한 자기소개를 작성해주세요';
      
      // 도움말 텍스트 (안전하게)
      const emailHelp = document.getElementById('email-help');
      const passwordHelp = document.getElementById('password-help');
      const roleHelp = document.getElementById('role-help');
      const bioHelp = document.getElementById('bio-help');
      const termsText = document.getElementById('terms-text');
      
      if (emailHelp) emailHelp.textContent = '강의 알림과 중요 공지를 받을 이메일입니다.';
      if (passwordHelp) passwordHelp.textContent = '안전한 비밀번호를 사용하세요 (최소 6자).';
      if (roleHelp) roleHelp.innerHTML = '<strong>학습자:</strong> 강의 수강 및 도서 대여 &nbsp; <strong>강사:</strong> 강의 제작 및 판매';
      if (bioHelp) bioHelp.textContent = '전문 분야나 관심사를 간단히 소개해주세요.';
      if (termsText) termsText.textContent = '성인 이용약관 및 개인정보처리방침';
      
    } else {
      console.log('👶 키즈 폼 설정');
      // 키즈 폼 설정
      if (parentInfoSection) parentInfoSection.style.display = 'block';
      if (birthdateSection) birthdateSection.style.display = 'block';
      if (roleSection) roleSection.style.display = 'none';
      
      // 자녀 정보 섹션 표시
      const childInfoSection = document.getElementById('child-info-section');
      if (childInfoSection) childInfoSection.style.display = 'block';
      
      // 키즈 동의 섹션 표시
      const adultTerms = document.getElementById('adult-terms');
      const kidsConsent = document.getElementById('kids-consent');
      if (adultTerms) adultTerms.style.display = 'none';
      if (kidsConsent) kidsConsent.style.display = 'block';
      
      // 라벨 및 플레이스홀더 설정 (안전하게)
      const nameLabel = document.getElementById('name-label');
      const emailLabel = document.getElementById('email-label');
      const nameField = document.getElementById('name-field');
      const emailField = document.getElementById('email-field');
      const passwordField = document.getElementById('password-field');
      const passwordConfirmationField = document.getElementById('password-confirmation-field');
      const bioLabel = document.getElementById('bio-label');
      const bioField = document.getElementById('bio-field');
      
      if (nameLabel) nameLabel.textContent = '계정 아이디';
      if (emailLabel) emailLabel.textContent = '계정 이메일';
      if (nameField) nameField.placeholder = '자녀가 사용할 아이디를 입력하세요';
      if (emailField) emailField.placeholder = '계정용 이메일 주소';
      if (passwordField) passwordField.placeholder = '자녀가 기억할 수 있는 비밀번호';
      if (passwordConfirmationField) passwordConfirmationField.placeholder = '비밀번호를 다시 입력하세요';
      if (bioLabel) bioLabel.textContent = '자녀 소개';
      if (bioField) bioField.placeholder = '자녀에 대한 간단한 소개를 작성해주세요';
      
      // 도움말 텍스트 (안전하게)
      const emailHelp = document.getElementById('email-help');
      const passwordHelp = document.getElementById('password-help');
      const bioHelp = document.getElementById('bio-help');
      
      if (emailHelp) emailHelp.textContent = '자녀의 학습 현황과 알림을 받을 이메일입니다.';
      if (passwordHelp) passwordHelp.textContent = '자녀가 쉽게 기억할 수 있는 비밀번호를 만들어주세요.';
      if (bioHelp) bioHelp.textContent = '자녀의 특성이나 학습 목표를 간단히 적어주세요.';
      
      // 부모 정보 필수 설정 (안전하게)
      const parentNameField = document.getElementById('parent_name_field');
      const parentEmailField = document.getElementById('parent_email_field');
      const parentPhoneField = document.getElementById('parent_phone_field');
      const parentBirthdayField = document.getElementById('parent_birthday_field');
      const parentRelationshipField = document.getElementById('parent_relationship_field');
      
      // 자녀 정보 필수 설정
      const childNameField = document.getElementById('child_name_field');
      const childGenderField = document.getElementById('child_gender_field');
      const childBirthYearField = document.getElementById('child_birth_year_field');
      const childBirthMonthField = document.getElementById('child_birth_month_field');
      const childBirthDayField = document.getElementById('child_birth_day_field');
      const childGradeField = document.getElementById('child_grade_field');
      
      // 필수 필드 설정
      if (parentNameField) parentNameField.required = true;
      if (parentEmailField) parentEmailField.required = true;
      if (parentPhoneField) parentPhoneField.required = true;
      if (parentBirthdayField) parentBirthdayField.required = true;
      if (parentRelationshipField) parentRelationshipField.required = true;
      
      if (childNameField) childNameField.required = true;
      if (childGenderField) childGenderField.required = true;
      if (childBirthYearField) childBirthYearField.required = true;
      if (childBirthMonthField) childBirthMonthField.required = true;
      if (childBirthDayField) childBirthDayField.required = true;
      if (childGradeField) childGradeField.required = true;
    }
  }
  
// Bootstrap 폼 검증
(function() {
  'use strict';
  window.addEventListener('load', function() {
    var forms = document.getElementsByClassName('needs-validation');
    var validation = Array.prototype.filter.call(forms, function(form) {
      form.addEventListener('submit', function(event) {
        if (form.checkValidity() === false) {
          event.preventDefault();
          event.stopPropagation();
        }
        form.classList.add('was-validated');
      }, false);
    });
  }, false);
})();

  // 비밀번호 확인 검증 (안전하게)
  function setupPasswordValidation() {
    const passwordField = document.getElementById('password-field');
    const passwordConfirmationField = document.getElementById('password-confirmation-field');
  
  function validatePassword() {
      if (passwordField && passwordConfirmationField) {
        if (passwordField.value !== passwordConfirmationField.value) {
          passwordConfirmationField.setCustomValidity('비밀번호가 일치하지 않습니다.');
        } else {
          passwordConfirmationField.setCustomValidity('');
        }
      }
    }
    
    if (passwordField && passwordConfirmationField) {
      console.log('✅ 비밀번호 검증 설정 완료');
      passwordField.addEventListener('change', validatePassword);
      passwordConfirmationField.addEventListener('keyup', validatePassword);
    } else {
      console.log('⚠️ 비밀번호 필드를 찾을 수 없습니다');
    }
  }
  
  // 비밀번호 검증 초기화
  setupPasswordValidation();
  
  console.log('✅ 모든 JavaScript 초기화 완료');
});
</script>
