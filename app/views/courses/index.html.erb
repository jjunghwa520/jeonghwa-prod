<% content_for :title, "#{@page_title || 'ë™í™” ì½˜í…ì¸ '} - ì •í™”ì˜ ì„œì¬" %>

<!-- ë™í™” ì½˜í…ì¸  íˆì–´ë¡œ ì„¹ì…˜ -->
<% if @current_category == 'teen_content' || @current_category == 'teen_education' %>
  <!-- ì²­ì†Œë…„ ì „ìš© íˆì–´ë¡œ ì„¹ì…˜ -->
  <section class="teen-courses-hero">
    <div class="hero-background">
      <div class="hero-pattern"></div>
      <div class="hero-gradient"></div>
    </div>
    
    <div class="container">
      <div class="row">
        <div class="col-12 text-center">
          <div class="hero-badge">
            <span class="badge-icon">ğŸ¯</span>
            <span class="badge-text">14-16ì„¸ ì „ìš©</span>
          </div>
          
          <h1 class="hero-title"><%= @page_title || "ğŸª ì²­ì†Œë…„ ì½˜í…ì¸ " %></h1>
          <p class="hero-description"><%= @page_description || "ì²­ì†Œë…„ì„ ìœ„í•œ íŠ¹ë³„í•œ ì½˜í…ì¸ ë¥¼ ë§Œë‚˜ë³´ì„¸ìš”" %></p>
          
          <!-- ì²­ì†Œë…„ ì „ìš© ì¹´í…Œê³ ë¦¬ íƒ­ -->
          <div class="teen-category-tabs">
            <%= link_to courses_path(category: 'teen_content'), class: "btn-teen-tab #{ @current_category == 'teen_content' ? 'active' : ''}" do %>
              <span class="tab-icon">ğŸ“±</span>
              <span class="tab-text">ì—”í„°í…Œì¸ë¨¼íŠ¸</span>
            <% end %>
            <%= link_to courses_path(category: 'teen_education'), class: "btn-teen-tab #{ @current_category == 'teen_education' ? 'active' : ''}" do %>
              <span class="tab-icon">ğŸ“</span>
              <span class="tab-text">êµìœ¡ ê³¼ì •</span>
            <% end %>
          </div>
          
          <!-- ì—”í„°í…Œì¸ë¨¼íŠ¸ ì„¸ë¶€ ì¹´í…Œê³ ë¦¬ í•„í„° -->
          <% if @current_category == 'teen_content' %>
            <div class="teen-subcategory-filters">
              <div class="filter-label">ì„¸ë¶€ ì¹´í…Œê³ ë¦¬:</div>
              <div class="filter-buttons">
                <%= link_to "ì „ì²´", courses_path(category: 'teen_content'), 
                    class: "btn-filter #{ params[:subcategory].blank? ? 'active' : '' }" %>
                <%= link_to "ğŸ“± ë§Œí™” & ì›¹íˆ°", courses_path(category: 'teen_content', subcategory: 'webtoon'), 
                    class: "btn-filter #{ params[:subcategory] == 'webtoon' ? 'active' : '' }" %>
                <%= link_to "ğŸ¬ ì• ë‹ˆë©”ì´ì…˜ & ì˜ìƒ", courses_path(category: 'teen_content', subcategory: 'animation'), 
                    class: "btn-filter #{ params[:subcategory] == 'animation' ? 'active' : '' }" %>
                <%= link_to "ğŸ“š ë¼ì´íŠ¸ë…¸ë²¨ & ì†Œì„¤", courses_path(category: 'teen_content', subcategory: 'novel'), 
                    class: "btn-filter #{ params[:subcategory] == 'novel' ? 'active' : '' }" %>
                <%= link_to "ğŸµ K-POP & ëŒ„ìŠ¤", courses_path(category: 'teen_content', subcategory: 'dance'), 
                    class: "btn-filter #{ params[:subcategory] == 'dance' ? 'active' : '' }" %>
              </div>
            </div>
          <% end %>
          
          <!-- êµìœ¡ ê³¼ì • ì„¸ë¶€ ì¹´í…Œê³ ë¦¬ í•„í„° -->
          <% if @current_category == 'teen_education' %>
            <div class="teen-subcategory-filters">
              <div class="filter-label">ì„¸ë¶€ ì¹´í…Œê³ ë¦¬:</div>
              <div class="filter-buttons">
                <%= link_to "ì „ì²´", courses_path(category: 'teen_education'), 
                    class: "btn-filter #{ params[:subcategory].blank? ? 'active' : '' }" %>
                <%= link_to "ğŸ¨ ì°½ì‘ & ë””ìì¸", courses_path(category: 'teen_education', subcategory: 'creative'), 
                    class: "btn-filter #{ params[:subcategory] == 'creative' ? 'active' : '' }" %>
                <%= link_to "ğŸ® ê²Œì„ ê°œë°œ & ì½”ë”©", courses_path(category: 'teen_education', subcategory: 'game'), 
                    class: "btn-filter #{ params[:subcategory] == 'game' ? 'active' : '' }" %>
                <%= link_to "ğŸŒŸ ì§„ë¡œ íƒìƒ‰ & ìê¸°ê³„ë°œ", courses_path(category: 'teen_education', subcategory: 'career'), 
                    class: "btn-filter #{ params[:subcategory] == 'career' ? 'active' : '' }" %>
                <%= link_to "ğŸ“¸ í¬ë¦¬ì—ì´í„° & ë¯¸ë””ì–´", courses_path(category: 'teen_education', subcategory: 'creator'), 
                    class: "btn-filter #{ params[:subcategory] == 'creator' ? 'active' : '' }" %>
              </div>
            </div>
          <% end %>
          
          <!-- í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸° ë§í¬ -->
          <div class="back-to-home">
            <%= link_to "â† ì „ì²´ ì½˜í…ì¸  ë³´ê¸°", courses_path, class: "btn-back-home" %>
          </div>
        </div>
      </div>
    </div>
  </section>
<% else %>
  <!-- ì¼ë°˜ ë™í™” ì½˜í…ì¸  íˆì–´ë¡œ ì„¹ì…˜ -->
  <section class="hero-section-small <%=
      case @current_category
      when 'ebook' then 'hero-section-small--ebook'
      when 'storytelling' then 'hero-section-small--storytelling'
      when 'education' then 'hero-section-small--education'
      else ''
      end
    %>">
    <div class="container">
      <div class="row">
        <div class="col-12 text-center">
          <!-- ë§¤ë ¥ì ì¸ ë°°ì§€ ì¶”ê°€ -->
          <div class="hero-badge-general mb-3">
            <span class="badge-icon">ğŸª</span>
            <span class="badge-text">ëª¨ë“  ì—°ë ¹ëŒ€</span>
          </div>
          
          <h1 class="hero-title-general mb-3"><%= @page_title || "ë§ˆë²• ê°™ì€ ë™í™”ì˜ ì„¸ê³„" %></h1>
          <p class="hero-description-general mb-4"><%= @page_description || "ì •í™”ì˜ ì„œì¬ì—ì„œ ì¤€ë¹„í•œ íŠ¹ë³„í•œ ì´ì•¼ê¸°ë“¤ì„ ë§Œë‚˜ë³´ì„¸ìš” âœ¨" %></p>
          
          <!-- íŠ¹ì§• ì•„ì´ì½˜ë“¤ ì¶”ê°€ -->
          <div class="hero-features-general mb-4">
            <div class="feature-item-general">
              <span class="feature-icon">ğŸ“š</span>
              <span>1000+ ë™í™”ì±…</span>
            </div>
            <div class="feature-item-general">
              <span class="feature-icon">ğŸµ</span>
              <span>ì „ë¬¸ ì„±ìš°</span>
            </div>
            <div class="feature-item-general">
              <span class="feature-icon">ğŸ¨</span>
              <span>ê³ í’ˆì§ˆ ì¼ëŸ¬ìŠ¤íŠ¸</span>
            </div>
          </div>
          
          <!-- ì¹´í…Œê³ ë¦¬ íƒ­ (ë¯¸ë‹ˆë©€) -->
          <div class="d-flex justify-content-center gap-2 flex-wrap mb-3">
            <%= link_to "ì „ì²´", courses_path, class: "btn-minimal #{ @current_category.blank? ? 'btn-minimal-primary' : 'btn-minimal-secondary'} btn-minimal-lg" %>
            <%= link_to "ì „ìë™í™”ì±…", courses_path(category: 'ebook'), class: "btn-minimal #{ @current_category == 'ebook' ? 'btn-minimal-primary' : 'btn-minimal-secondary'} btn-minimal-lg" %>
            <%= link_to "êµ¬ì—°ë™í™”", courses_path(category: 'storytelling'), class: "btn-minimal #{ @current_category == 'storytelling' ? 'btn-minimal-primary' : 'btn-minimal-secondary'} btn-minimal-lg" %>
            <%= link_to "ë™í™”ë§Œë“¤ê¸°", courses_path(category: 'education'), class: "btn-minimal #{ @current_category == 'education' ? 'btn-minimal-primary' : 'btn-minimal-secondary'} btn-minimal-lg" %>
          </div>
          
          <!-- ì²­ì†Œë…„ ì½˜í…ì¸ ë¡œ ì´ë™ ë§í¬ -->
          <div class="d-flex justify-content-center gap-2 flex-wrap">
            <small class="text-muted me-3 align-self-center">ì²­ì†Œë…„ ì „ìš©:</small>
            <%= link_to "ğŸ“± ì½˜í…ì¸ ", teen_content_path, class: "btn-minimal btn-minimal-secondary btn-minimal-sm" %>
            <%= link_to "ğŸ“ êµìœ¡", courses_path(category: 'teen_education'), class: "btn-minimal btn-minimal-secondary btn-minimal-sm" %>
          </div>
        </div>
      </div>
    </div>
</section>
<% end %>

<div class="container-fluid py-5">
  <div class="container">
  
  <!-- ì¹´í…Œê³ ë¦¬ë³„ ì•ˆë‚´ ë°°ë„ˆ -->
  <% if @current_category == 'ebook' %>
    <div class="alert alert-primary d-flex align-items-center mb-4" role="alert">
      <span class="fs-2 me-3">ğŸ“–</span>
      <div>
        <h5 class="alert-heading mb-1">ì „ìë™í™”ì±… êµ¬ë§¤ ì•ˆë‚´</h5>
        <p class="mb-0">í•œ ë²ˆ êµ¬ë§¤í•˜ë©´ í‰ìƒ ì†Œì¥! í„°ì¹˜í•˜ê³  ë“£ê³  ì½ëŠ” ì¸í„°ë™í‹°ë¸Œ ë™í™”ì±…ì…ë‹ˆë‹¤.</p>
      </div>
    </div>
  <% elsif @current_category == 'storytelling' %>
    <div class="alert alert-warning d-flex align-items-center mb-4" role="alert">
      <span class="fs-2 me-3">ğŸ­</span>
      <div>
        <h5 class="alert-heading mb-1">êµ¬ì—°ë™í™” êµ¬ë… ì•ˆë‚´</h5>
        <p class="mb-0">ì›” 9,900ì›ìœ¼ë¡œ ëª¨ë“  êµ¬ì—°ë™í™”ë¥¼ ë¬´ì œí•œ ì‹œì²­! ë§¤ë‹¬ ìƒˆë¡œìš´ ì´ì•¼ê¸°ê°€ ì¶”ê°€ë©ë‹ˆë‹¤.</p>
      </div>
    </div>
  <% elsif @current_category == 'education' %>
    <div class="alert alert-success d-flex align-items-center mb-4" role="alert">
      <span class="fs-2 me-3">âœï¸</span>
      <div>
        <h5 class="alert-heading mb-1">ë™í™”ë§Œë“¤ê¸° êµìœ¡ ì•ˆë‚´</h5>
        <p class="mb-0">ì „ë¬¸ ì‘ê°€ì™€ í•¨ê»˜ ë‚˜ë§Œì˜ ë™í™”ì±…ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”. ì™„ì„± í›„ ì „ì‹œíšŒ ê¸°íšŒë„ ì œê³µë©ë‹ˆë‹¤!</p>
      </div>ã…—
    </div>
  <!-- ì²­ì†Œë…„ ì „ìš© ì¹´í…Œê³ ë¦¬ ì•ˆë‚´ (ë‹¨ìˆœí™”) -->
  <% elsif @current_category == 'teen_content' %>
    <div class="alert alert-info d-flex align-items-center mb-4" role="alert">
      <span class="fs-2 me-3">ğŸ“±</span>
      <div>
        <h5 class="alert-heading mb-1">ì²­ì†Œë…„ ì½˜í…ì¸ </h5>
        <p class="mb-0">ë§Œí™”, ì• ë‹ˆë©”ì´ì…˜, ì›¹íˆ°, ë¼ì´íŠ¸ë…¸ë²¨ ë“± ì²­ì†Œë…„ì´ ì¦ê¸°ëŠ” ë‹¤ì–‘í•œ ì—”í„°í…Œì¸ë¨¼íŠ¸ ì½˜í…ì¸ ë¥¼ ë§Œë‚˜ë³´ì„¸ìš”!</p>
      </div>
    </div>
  <% elsif @current_category == 'teen_education' %>
    <div class="alert alert-success d-flex align-items-center mb-4" role="alert">
      <span class="fs-2 me-3">ğŸ“</span>
      <div>
        <h5 class="alert-heading mb-1">ì²­ì†Œë…„ êµìœ¡</h5>
        <p class="mb-0">ì°½ì‘, ê²Œì„ ê°œë°œ, ì§„ë¡œ íƒìƒ‰, ìê¸°ê³„ë°œ ë“± ì²­ì†Œë…„ ì„±ì¥ì„ ìœ„í•œ ì‹¤ìš©ì ì¸ êµìœ¡ ê³¼ì •ì…ë‹ˆë‹¤!</p>
      </div>
    </div>
  <% end %>

  <!-- ê°•ì˜ ëª©ë¡ -->
  <div class="content-grid">
    <% if @courses.any? %>
      <% @courses.each do |course| %>
        <%= link_to course_path(course), class: "content-card" do %>
          <!-- ì¸ë„¤ì¼ ì˜ì—­ -->
          <div class="content-thumbnail">
            <% 
              # ì œëª©ë³„ ë§ì¶¤ Vertex AI ì´ë¯¸ì§€ ìµœìš°ì„  ì ìš©
              clean_title = course.title.gsub(/[^\w\sê°€-í£]/, '').strip.gsub(/\s+/, '_')
              
              # ì²­ì†Œë…„ ì½˜í…ì¸ ëŠ” teen_title_specific_vertex ìš°ì„  ì‚¬ìš©
              teen_title_specific_path = "generated/teen_title_specific_vertex/#{clean_title}_#{course.id}.jpg"
              title_specific_vertex_path = "generated/title_specific_vertex/#{clean_title}_#{course.id}.jpg"
              title_matched_path = ThumbnailMatcherHelper.get_title_specific_thumbnail(course.title, course.id) if defined?(ThumbnailMatcherHelper)
              
              category = course.category&.downcase || 'ebook'
              index = course.id % 6 + 1
              thumbnail_path = "generated/thumbnails/#{category}_#{index}.svg"
              
              # ì²­ì†Œë…„ ì½˜í…ì¸  ìš°ì„  ì²˜ë¦¬
              if course.age == 'teen' && Rails.application.assets && Rails.application.assets.find_asset(teen_title_specific_path)
                final_thumb = teen_title_specific_path
              elsif Rails.application.assets && Rails.application.assets.find_asset(title_specific_vertex_path)
                final_thumb = title_specific_vertex_path
              elsif title_matched_path && Rails.application.assets && Rails.application.assets.find_asset(title_matched_path)
                final_thumb = title_matched_path
              elsif Rails.application.assets && Rails.application.assets.find_asset(thumbnail_path)
                final_thumb = thumbnail_path
              elsif course.thumbnail.present?
                final_thumb = course.thumbnail
              else
                final_thumb = nil
              end
            %>
            
            <% if final_thumb %>
              <%= image_tag final_thumb, alt: course.title, class: "thumbnail-image" %>
            <% else %>
              <div class="thumbnail-placeholder">
                <span class="thumbnail-icon">
                  <%= course.category == "education" ? "âœï¸" : (course.category == "storytelling" ? "ğŸ­" : "ğŸ“–") %>
                </span>
              </div>
            <% end %>
            
            <!-- ì¹´í…Œê³ ë¦¬ ë°°ì§€ -->
            <div class="thumbnail-badge <%= 
              if course.category == "ì „ìë™í™”ì±…" || course.category == "ebook"
                'ebook'
              elsif course.category == "êµ¬ì—°ë™í™”" || course.category == "storytelling"
                'storytelling'
              else
                'education'
              end
            %>">
              <%= 
                if course.category == "ì „ìë™í™”ì±…" || course.category == "ebook"
                  'ì „ìì±…'
                elsif course.category == "êµ¬ì—°ë™í™”" || course.category == "storytelling"
                  'êµ¬ì—°ë™í™”'
                else
                  'êµìœ¡'
                end
              %>
            </div>
          </div>
          
          <!-- ì¹´ë“œ ì •ë³´ -->
          <div class="content-info">
            <h4><%= course.title.truncate(20) %></h4>
            <p class="content-author"><%= course.instructor.name %></p>
            <div class="content-footer">
              <span class="content-rating">
                <% if course.reviews.any? %>
                  â­ <%= course.reviews.average(:rating).round(1) %>
                <% else %>
                  <span class="text-muted">í‰ê°€ ì—†ìŒ</span>
                <% end %>
              </span>
              <span class="content-price">
                <% if course.price == 0 %>
                  ë¬´ë£Œ
                <% else %>
                  <%= number_to_currency(course.price, unit: "", precision: 0) %>ì›
                <% end %>
              </span>
            </div>
            <div class="content-chips">
              <span class="chip age">
                <%= 
                  case course.age
                  when 'baby' then '0-3ì„¸'
                  when 'toddler' then '4-7ì„¸'
                  when 'elementary' then '8-12ì„¸'
                  when 'teen' then '14-16ì„¸'
                  else 'ì „ì²´'
                  end
                %>
              </span>
              <span class="chip length">
                <%= 
                  if course.duration.to_i < 3
                    '<3ë¶„'
                  elsif course.duration.to_i <= 7
                    '3-7ë¶„'
                  elsif course.duration.to_i <= 15
                    '8-15ë¶„'
                  else
                    '>15ë¶„'
                  end
                %>
              </span>
              <% if course.price.to_i == 0 %>
                <span class="chip free">ë¬´ë£Œ</span>
              <% end %>
              <% if course.reviews.count.to_i >= 5 %>
                <span class="chip popular">ì¸ê¸°</span>
              <% end %>
            </div>
          </div>
        <% end %>
      <% end %>
    <% else %>
      <div class="col-12">
        <div class="text-center py-5">
          <i class="bi bi-inbox fs-1 text-muted mb-3 d-block"></i>
          <h4 class="text-muted">ì•„ì§ ë“±ë¡ëœ ì½˜í…ì¸ ê°€ ì—†ìŠµë‹ˆë‹¤</h4>
          <p class="text-muted">ê³§ ìƒˆë¡œìš´ ë™í™”ì±… ì½˜í…ì¸ ê°€ ì¶”ê°€ë  ì˜ˆì •ì…ë‹ˆë‹¤!</p>
        </div>
      </div>
    <% end %>
  </div>
  </div>
</div>

<!-- ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ ì œê±°: hero-section-small ë°°ê²½/íš¨ê³¼ëŠ” unified_hero_design.scssì—ì„œ ê´€ë¦¬ -->

<!-- ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€ ìŠ¤í¬ë¦½íŠ¸ -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€ í¼ ì²˜ë¦¬
  document.querySelectorAll('.add-to-cart-form').forEach(form => {
    form.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const courseId = this.dataset.courseId;
      const button = this.querySelector('button');
      const originalContent = button.innerHTML;
      
      // ë¡œë”© ìƒíƒœ í‘œì‹œ
      button.innerHTML = '<span class="spinner-border spinner-border-sm"></span>';
      button.disabled = true;
      
      try {
        const response = await fetch('/cart_items', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-CSRF-Token': document.querySelector('[name="authenticity_token"]').value,
            'Accept': 'application/json'
          },
          body: JSON.stringify({ course_id: courseId })
        });
        
        const data = await response.json();
        
        if (response.ok) {
          // ë²„íŠ¼ì„ "ë‹´ê¹€" ìƒíƒœë¡œ ë³€ê²½
          button.innerHTML = '<i class="bi bi-cart-check"></i>';
          button.classList.remove('btn-outline-primary');
          button.classList.add('btn-success');
          
          // í† ìŠ¤íŠ¸ ì•Œë¦¼ í‘œì‹œ
          showToast('âœ… ë™í™”ì±… ë³´ê´€í•¨ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!', data.course_title || '');
        } else {
          throw new Error(data.error || 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
        }
      } catch (error) {
        console.error('Error:', error);
        button.innerHTML = originalContent;
        showToast('âŒ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', error.message, 'error');
      } finally {
        button.disabled = false;
      }
    });
  });
  
  // í† ìŠ¤íŠ¸ ì•Œë¦¼ í•¨ìˆ˜
  function showToast(title, message, type = 'success') {
    const toastHtml = `
      <div class="toast-notification ${type}">
        <div class="toast-header">
          <strong>${title}</strong>
          <button class="toast-close">&times;</button>
        </div>
        ${message ? `<div class="toast-body">${message}</div>` : ''}
      </div>
    `;
    
    const toastContainer = document.getElementById('toast-container') || createToastContainer();
    toastContainer.insertAdjacentHTML('beforeend', toastHtml);
    
    const toast = toastContainer.lastElementChild;
    setTimeout(() => toast.classList.add('show'), 10);
    
    // ë‹«ê¸° ë²„íŠ¼
    toast.querySelector('.toast-close').addEventListener('click', () => {
      toast.classList.remove('show');
      setTimeout(() => toast.remove(), 300);
    });
    
    // ìë™ ì œê±°
    setTimeout(() => {
      toast.classList.remove('show');
      setTimeout(() => toast.remove(), 300);
    }, 4000);
  }
  
  function createToastContainer() {
    const container = document.createElement('div');
    container.id = 'toast-container';
    container.style.cssText = 'position: fixed; top: 20px; right: 20px; z-index: 9999;';
    document.body.appendChild(container);
    return container;
  }
});
</script>

<style>
.toast-notification {
  background: white;
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  margin-bottom: 10px;
  min-width: 300px;
  opacity: 0;
  transform: translateX(100%);
  transition: all 0.3s ease;
}

.toast-notification.show {
  opacity: 1;
  transform: translateX(0);
}

.toast-notification.success {
  border-left: 4px solid #28a745;
}

.toast-notification.error {
  border-left: 4px solid #dc3545;
}

.toast-header {
  padding: 12px;
  border-bottom: 1px solid #f0f0f0;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.toast-body {
  padding: 12px;
  color: #666;
}

.toast-close {
  background: none;
  border: none;
  font-size: 20px;
  cursor: pointer;
  color: #999;
  padding: 0;
  margin-left: 20px;
}

.toast-close:hover {
  color: #333;
}
</style>